(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{601:()=>{},4242:(e,n,t)=>{"use strict";t.d(n,{default:()=>G});var r=t(5917),o=t(4928),i=t(4021),a=t(7027),s=t(2185),l=t(8738),c=t(1436);t(4435),t(7257);let u=()=>{let{variables:e,zMeta:n,setVariable:t}=(0,l.on)((0,c.k)(e=>({variables:e.variables,zMeta:e.zMeta,setVariable:e.setVariable}))),[o,i]=(0,s.useState)(Math.floor(e.length/2)),[a,u]=(0,s.useState)(null),[m,d]=(0,s.useState)(82),f=(0,s.useRef)(null),p=(0,s.useRef)(0);function h(){let e=window.innerWidth;e<=480?d(42):e<=570?d(54):d(82)}return(0,s.useEffect)(()=>{let e=e=>{e.cancelable&&e.preventDefault()};return document.addEventListener("touchmove",e,{passive:!1}),()=>{document.removeEventListener("touchmove",e)}},[]),(0,s.useEffect)(()=>{if(e&&n){let t=e[o];u(n.find(e=>e.name===t))}},[o,e]),(0,s.useEffect)(()=>{let e=window.innerWidth;return e<=480?d(42):e<=570?d(54):d(82),window.addEventListener("resize",h)},[]),(0,r.jsx)("div",{className:"scroll-container",onWheel:n=>{let t=o+(n.deltaY>0?1:-1);t>=0&&t<e.length&&i(t)},onTouchMove:n=>{let t=n.touches[0].clientY,r=f.current?f.current:t;if(f.current=t,p.current+=r-t,Math.abs(p.current)>=m){let n=o+(p.current>0?1:-1);n>=0&&n<e.length&&(i(n),p.current=0)}},onTouchEnd:()=>{f.current=null,p.current=0},children:(0,r.jsx)("div",{className:"scroll-element",style:{transform:"translateY(calc(40% + ".concat(-o*m,"px))")},children:e.map((e,n)=>{let a=Math.abs(o-n);return(0,r.jsx)("div",{className:"scroll-item",style:{opacity:1-.3*a,fontWeight:o===n?"bold":"normal"},onClick:()=>i(n),onDoubleClick:()=>t(e),children:e},n)})})})},m=" // by Jeran Poehls\r\n\r\nout vec3 vOrigin;\r\nout vec3 vDirection;\r\nout vec3 aPosition;\r\n\r\nout vec2 Vuv;\r\n\r\nvoid main() {\r\n    vec4 worldPos = modelViewMatrix * vec4( position, 1.0 );\r\n\r\n    aPosition = position; //Pass out position for sphere frag\r\n    vOrigin = vec3( inverse( modelMatrix ) * vec4( cameraPosition, 1.0 ) ).xyz;\r\n    vDirection = position - vOrigin;\r\n    Vuv = uv;\r\n    gl_Position = projectionMatrix * worldPos;\r\n}",d=e=>{let{volTexture:n}=e,{shape:t,colormap:i,flipY:a}=(0,l.on)((0,c.k)(e=>({shape:e.shape,colormap:e.colormap,flipY:e.flipY}))),{valueRange:u,xRange:d,yRange:f,zRange:p,quality:h,animate:v,animProg:x,resetAnim:g,cScale:w,cOffset:y,useFragOpt:S}=(0,l.Ws)((0,c.k)(e=>({valueRange:e.valueRange,xRange:e.xRange,yRange:e.yRange,zRange:e.zRange,quality:e.quality,animate:e.animate,animProg:e.animProg,resetAnim:e.resetAnim,cScale:e.cScale,cOffset:e.cOffset,useFragOpt:e.useFragOpt}))),b=(0,s.useMemo)(()=>new o.BKk({glslVersion:o.Wdf,uniforms:{map:{value:n},cmap:{value:i},cOffset:{value:y},cScale:{value:w},cameraPos:{value:new o.Pq0},threshold:{value:new o.I9Y(u[0],u[1])},scale:{value:t},flatBounds:{value:new o.IUQ(d[0],d[1],p[0],p[1])},vertBounds:{value:new o.I9Y(f[0]/t.x,f[1]/t.x)},steps:{value:h},animateProg:{value:x}},vertexShader:m,fragmentShader:S?"// by Jeran Poehls\r\nprecision highp float;\r\nprecision highp sampler3D;\r\n\r\nin vec3 vOrigin;\r\nin vec3 vDirection;\r\n\r\nout vec4 color;\r\n\r\nuniform sampler3D map;\r\nuniform sampler2D cmap;\r\n\r\nuniform float cOffset;\r\nuniform float cScale;\r\nuniform vec3 scale;\r\nuniform vec2 threshold;\r\nuniform float steps;\r\nuniform vec4 flatBounds;\r\nuniform vec2 vertBounds;\r\nuniform float animateProg;\r\n\r\nvec2 hitBox(vec3 orig, vec3 dir) {\r\n    vec3 box_min = vec3(-(scale * 0.5));\r\n    vec3 box_max = vec3(scale * 0.5);\r\n    vec3 inv_dir = 1.0 / dir;\r\n    vec3 tmin_tmp = (box_min - orig) * inv_dir;\r\n    vec3 tmax_tmp = (box_max - orig) * inv_dir;\r\n    vec3 tmin = min(tmin_tmp, tmax_tmp);\r\n    vec3 tmax = max(tmin_tmp, tmax_tmp);\r\n    float t0 = max(tmin.x, max(tmin.y, tmin.z));\r\n    float t1 = min(tmax.x, min(tmax.y, tmax.z));\r\n    return vec2(t0, t1);\r\n}\r\n\r\nfloat sample1( vec3 p ) {\r\n    return texture( map, p ).r;\r\n}\r\n\r\n#define epsilon 0.0001\r\n\r\nvoid main() {\r\n    vec3 rayDir = normalize(vDirection);\r\n    vec2 bounds = hitBox(vOrigin, rayDir);\r\n\r\n    if (bounds.x > bounds.y) discard;\r\n\r\n    bounds.x = max(bounds.x, 0.0);\r\n\r\n    vec3 p = vOrigin + bounds.x * rayDir;\r\n    vec3 inc = 1.0 / abs(rayDir);\r\n\r\n    //Step Sizes\r\n    float fineDelta = min(inc.x, min(inc.y, inc.z)) / steps;\r\n\r\n    float coarseDelta = min(inc.x, min(inc.y, inc.z))/50.;\r\n\r\n    float delta = fineDelta;\r\n\r\n    vec4 accumColor = vec4(0.0);\r\n    float alphaAcc = 0.0;\r\n\r\n    float t = bounds.x;\r\n    int countdown = 0;\r\n    bool useCoarseStep = false;\r\n\r\n    while (t < bounds.y) {\r\n        vec3 p = vOrigin + rayDir * t;\r\n        \r\n        // --- Boundary checks ---\r\n        if (p.x < flatBounds.x || p.x > flatBounds.y ||\r\n            p.z < flatBounds.z || p.z > flatBounds.w ||\r\n            p.y < vertBounds.x || p.y > vertBounds.y) {\r\n\r\n            t += useCoarseStep ? coarseDelta : fineDelta;\r\n            continue;\r\n        }\r\n\r\n        vec3 texCoord = p / scale + 0.5;\r\n        texCoord.z = mod(texCoord.z + animateProg, 1.0001);\r\n        float d = sample1(texCoord);\r\n\r\n        bool cond = (d > threshold.x) && (d < threshold.y);\r\n        \r\n        if (cond) {\r\n            // Hit something interesting - switch to fine stepping\r\n            if (useCoarseStep) {\r\n                useCoarseStep = false;\r\n                countdown = 40;\r\n                // Step back to ensure we don't miss the boundary\r\n                t -= coarseDelta;\r\n                continue;\r\n            }\r\n            float sampLoc = d == 1. ? d : (d - 0.5)*cScale + 0.5;\r\n            sampLoc = d == 1. ? d : min(sampLoc+cOffset,0.99);\r\n            vec4 col = texture(cmap, vec2(sampLoc, 0.5));\r\n            float alpha = float(col.a > 0.);\r\n\r\n            accumColor.rgb += (1.0 - alphaAcc) * alpha * col.rgb;\r\n            alphaAcc += alpha * (1.0 - alphaAcc);\r\n\r\n            if (alphaAcc >= 1.0) break;\r\n            \r\n            t += fineDelta;\r\n        }\r\n        else {\r\n            // Nothing interesting here\r\n            if (countdown > 0) {\r\n                countdown--;\r\n                t += fineDelta; // Continue with fine steps while countdown > 0\r\n            } else {\r\n                useCoarseStep = true;\r\n                t += coarseDelta; // Switch to coarse steps\r\n            }\r\n        }\r\n    }\r\n    accumColor.a = alphaAcc; // Set the final accumulated alpha\r\n    color = accumColor;\r\n    if (color.a == 0.0) discard;\r\n}\r\n":"// by Jeran Poehls\r\nprecision highp float;\r\nprecision highp sampler3D;\r\n\r\nin vec3 vOrigin;\r\nin vec3 vDirection;\r\n\r\nout vec4 color;\r\n\r\nuniform sampler3D map;\r\nuniform sampler2D cmap;\r\n\r\nuniform float cOffset;\r\nuniform float cScale;\r\nuniform vec3 scale;\r\nuniform vec2 threshold;\r\nuniform float steps;\r\nuniform vec4 flatBounds;\r\nuniform vec2 vertBounds;\r\nuniform float animateProg;\r\n\r\nvec2 hitBox(vec3 orig, vec3 dir) {\r\n    vec3 box_min = vec3(-(scale * 0.5));\r\n    vec3 box_max = vec3(scale * 0.5);\r\n    vec3 inv_dir = 1.0 / dir;\r\n    vec3 tmin_tmp = (box_min - orig) * inv_dir;\r\n    vec3 tmax_tmp = (box_max - orig) * inv_dir;\r\n    vec3 tmin = min(tmin_tmp, tmax_tmp);\r\n    vec3 tmax = max(tmin_tmp, tmax_tmp);\r\n    float t0 = max(tmin.x, max(tmin.y, tmin.z));\r\n    float t1 = min(tmax.x, min(tmax.y, tmax.z));\r\n    return vec2(t0, t1);\r\n}\r\n\r\nfloat sample1( vec3 p ) {\r\n    return texture( map, p ).r;\r\n}\r\n\r\n#define epsilon 0.0001\r\n\r\nvoid main() {\r\n    vec3 rayDir = normalize(vDirection);\r\n    vec2 bounds = hitBox(vOrigin, rayDir);\r\n\r\n    if (bounds.x > bounds.y) discard;\r\n\r\n    bounds.x = max(bounds.x, 0.0);\r\n\r\n    vec3 p = vOrigin + bounds.x * rayDir;\r\n    vec3 inc = 1.0 / abs(rayDir);\r\n    float delta = min(inc.x, min(inc.y, inc.z));\r\n    delta /= steps;\r\n    vec4 accumColor = vec4(0.0);\r\n    float alphaAcc = 0.0;\r\n\r\n    for (float t = bounds.x; t < bounds.y; t += delta) {\r\n        p = vOrigin + rayDir * t;\r\n        if (p.x > -flatBounds.x || p.x < -flatBounds.y) { \r\n            continue;\r\n        }\r\n        if (-p.z > -flatBounds.z || -p.z < -flatBounds.w) {\r\n            continue;\r\n        }\r\n        if (p.y < vertBounds.x || p.y > vertBounds.y) {\r\n            continue;\r\n        }\r\n\r\n        vec3 texCoord = p / scale + 0.5;\r\n        texCoord.z = mod(texCoord.z + animateProg, 1.0001);\r\n        float d = sample1(texCoord);\r\n\r\n        bool cond = (d > threshold.x) && (d < threshold.y);\r\n        \r\n        if (cond) {\r\n            float sampLoc = d == 1. ? d : (d - 0.5)*cScale + 0.5;\r\n            sampLoc = d == 1. ? d : min(sampLoc+cOffset,0.99);\r\n            vec4 col = texture(cmap, vec2(sampLoc, 0.5));\r\n            // Change this later back to use intensity then delete comment. Or maybe we don't need intensity\r\n            float alpha = float(col.a > 0.);\r\n\r\n            accumColor.rgb += (1.0 - alphaAcc) * alpha * col.rgb;\r\n            alphaAcc += alpha * (1.0 - alphaAcc);\r\n\r\n            if (alphaAcc >= 1.0) break;\r\n        }\r\n    }\r\n\r\n    accumColor.a = alphaAcc; // Set the final accumulated alpha\r\n    color = accumColor;\r\n    if (color.a == 0.0) discard;\r\n}\r\n",transparent:!0,blending:o.NTi,depthWrite:!1,side:o.hsX}),[n,i,y,w,u,d,f,p,h,x,S]),j=(0,s.useMemo)(()=>new o.WBB(2,4),[]);return(0,s.useEffect)(()=>()=>{j.dispose()},[]),(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("mesh",{geometry:j,scale:[1,a?-1:1,1],children:(0,r.jsx)("primitive",{attach:"material",object:b})})})};var f=t(8042);let p=e=>{let{ZarrDS:n}=e,[t,i]=(0,s.useState)(null),{setTimeSeries:a,setPlotDim:u,setDimCoords:m,updateTimeSeries:d,updateDimCoords:p}=(0,l.on)((0,c.k)(e=>({setTimeSeries:e.setTimeSeries,setPlotDim:e.setPlotDim,setDimCoords:e.setDimCoords,updateTimeSeries:e.updateTimeSeries,updateDimCoords:e.updateDimCoords}))),{shape:h,dimArrays:v,dimNames:x,dimUnits:g}=(0,l.on)((0,c.k)(e=>({shape:e.shape,dimArrays:e.dimArrays,dimNames:e.dimNames,dimUnits:e.dimUnits}))),w=(0,l.Ws)(e=>e.selectTS),y=(0,s.useRef)(null),S=(0,s.useMemo)(()=>new o.iNn(1,1,1),[]);return(0,s.useEffect)(()=>()=>{S.dispose()},[]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("mesh",{geometry:S,scale:h,onClick:e=>{e.stopPropagation(),e.intersections.length>0&&w&&function(e){let t=e.point,r=e.uv,o=e.normal,s=(0,f.getUnitAxis)(o);if(s!=y.current&&(a({}),m({})),y.current=s,n){var l,c;let e=n.GetTimeSeries({uv:r,normal:o}),t=o.toArray().map((e,n)=>Math.abs(e)>0?n:null).filter(e=>null!==e);u(2-t[0]);let i=(0,f.parseUVCoords)({normal:o,uv:r}).map((e,n)=>e?v[n][Math.round(e*v[n].length)]:null),a=x.filter((e,n)=>null!==i[n]),s=g.filter((e,n)=>null!==i[n]);i=i.filter(e=>null!==e);let m="".concat(i[0],"_").concat(i[1]);d({[m]:e}),p({[m]:{first:{name:a[0],loc:null!=(l=i[0])?l:0,units:s[0]},second:{name:a[1],loc:null!=(c=i[1])?c:0,units:s[1]},plot:{units:g[2-t[0]]}}})}i(t)}(e.intersections[0])},children:(0,r.jsx)("meshBasicMaterial",{transparent:!0,opacity:0})}),t&&(0,r.jsxs)("mesh",{position:t,scale:.01,children:[(0,r.jsx)("boxGeometry",{}),(0,r.jsx)("meshBasicMaterial",{color:"#ff0000"})]})]})},h=e=>{let{dimensions:n,ZarrDS:t,setters:o}=e,{width:i,height:a,depth:u}=n,{setPointIDs:m,setStride:d,setDimWidth:p}=o,h=(0,l.Ws)(e=>e.selectTS),v=i/a,x=u/a,{dimArrays:g,dimUnits:w,dimNames:y,strides:S,setPlotDim:b,setTimeSeries:j,updateTimeSeries:C,setDimCoords:P,updateDimCoords:M}=(0,l.on)((0,c.k)(e=>({dimArrays:e.dimArrays,dimUnits:e.dimUnits,dimNames:e.dimNames,strides:e.strides,setPlotDim:e.setPlotDim,setTimeSeries:e.setTimeSeries,updateTimeSeries:e.updateTimeSeries,setDimCoords:e.setDimCoords,updateDimCoords:e.updateDimCoords}))),z=(0,s.useRef)(null),D=(0,l.Ws)(e=>e.timeScale);return(0,r.jsxs)("mesh",{scale:[2*v,2,2*x*D],onClick:function(e){if(!h)return;let n=e.uv,r=e.normal,o=(0,f.getUnitAxis)(r);if(o!=z.current&&(j({}),P({}),m(Array(10).fill(-1))),z.current=o,t){var s,l;let e=t.GetTimeSeries({uv:n,normal:r}),o=r.toArray().map((e,n)=>Math.abs(e)>0?n:null).filter(e=>null!==e);b(2-o[0]);let c=(0,f.parseUVCoords)({normal:r,uv:n}),h=c.map((e,n)=>e?g[n][Math.round(e*g[n].length-.5)]:null),v=y.filter((e,n)=>null!==h[n]),x=w.filter((e,n)=>null!==h[n]);h=h.filter(e=>null!==e);let j="".concat(h[0],"_").concat(h[1]);C({[j]:e}),M({[j]:{first:{name:v[0],loc:null!=(s=h[0])?s:0,units:x[0]},second:{name:v[1],loc:null!=(l=h[1])?l:0,units:x[1]},plot:{units:w[2-o[0]]}}});let P=[u,a,i].filter((e,n)=>null!=c[n]),z=[u,a,i].filter((e,n)=>null==c[n]),D=c.filter(e=>null!=e),k=S.filter((e,n)=>null!=c[n]),A=Math.round(D[0]*P[0]-.5),V=Math.round(D[1]*P[1]-.5),B=A*k[0]+V*k[1],O=S.filter((e,n)=>null==c[n]);p(z[0]),m(e=>[B,...e].slice(0,10)),d(O[0])}},children:[(0,r.jsx)("boxGeometry",{}),(0,r.jsx)("meshBasicMaterial",{transparent:!0,opacity:0})]})},v=e=>{let{textures:n,ZarrDS:t}=e,{texture:i,colormap:a}=n,u=(0,l.on)(e=>e.flipY),{scalePoints:m,scaleIntensity:d,pointSize:f,cScale:p,cOffset:v,valueRange:x,animProg:g,selectTS:w,timeScale:y,xRange:S,yRange:b,zRange:j}=(0,l.Ws)((0,c.k)(e=>({scalePoints:e.scalePoints,scaleIntensity:e.scaleIntensity,pointSize:e.pointSize,cScale:e.cScale,cOffset:e.cOffset,valueRange:e.valueRange,animProg:e.animProg,selectTS:e.selectTS,timeScale:e.timeScale,xRange:e.xRange,yRange:e.yRange,zRange:e.zRange}))),C=(0,l.$U)(e=>e.setOom),[P,M]=(0,s.useState)(Array(10).fill(-1)),[z,D]=(0,s.useState)(1),[k,A]=(0,s.useState)(0),{data:V,width:B,height:O,depth:L}=(0,s.useMemo)(()=>i instanceof o.dYF?{data:i.image.data,width:i.image.width,height:i.image.height,depth:i.image.depth}:(console.warn("Provided texture is not a Data3DTexture"),{data:[],width:0,height:0,depth:0}),[i]),W=(0,s.useMemo)(()=>B/O,[B,O]),N=(0,s.useMemo)(()=>L/O,[L,O]),{positions:F,values:R}=(0,s.useMemo)(()=>{let e;try{e=new Float32Array(L*O*B*3)}catch(e){return C(!0),{positions:[],values:[]}}let n=new Uint8Array(L*O*B);for(let t=0;t<L;t++)for(let r=0;r<O;r++)for(let o=0;o<B;o++){let i=o+r*B+t*B*O,a=V[i]||0,s=(o/(B-1)-.5)*W,l=r/(O-1)-.5,c=(t/(L-1)-.5)*N,u=3*i;e[u]=2*s,e[u+1]=2*l,e[u+2]=2*c,n[i]=a}return{positions:e,values:n}},[V,B,O,L]),_=(0,s.useMemo)(()=>{let e=new o.LoY;return e.setAttribute("position",new o.qtW(F,3)),e.setAttribute("value",new o.qtW(R,1)),e},[F,R]),T=(0,s.useMemo)(()=>new o.BKk({glslVersion:o.Wdf,uniforms:{pointSize:{value:f},cmap:{value:a},cOffset:{value:v},cScale:{value:p},valueRange:{value:new o.I9Y(x[0],x[1])},scalePoints:{value:m},scaleIntensity:{value:d},startIDs:{value:P},stride:{value:z},showTransect:{value:w},dimWidth:{value:k},timeScale:{value:y},animateProg:{value:g},depthRatio:{value:N},flatBounds:{value:new o.IUQ(S[0]*W,S[1]*W,j[0]*N,j[1]*N)},vertBounds:{value:new o.I9Y(b[0],b[1])}},vertexShader:"attribute float value;\r\nout float vValue;\r\n\r\nflat out int highlight;\r\n\r\nuniform float pointSize;\r\nuniform bool scalePoints;\r\nuniform float scaleIntensity;\r\nuniform vec2 valueRange;\r\nuniform int[10] startIDs;\r\nuniform int stride;\r\nuniform int dimWidth;\r\nuniform bool showTransect;\r\nuniform float timeScale;\r\nuniform float animateProg;\r\nuniform float depthRatio;\r\nuniform vec4 flatBounds;\r\nuniform vec2 vertBounds;\r\n\r\nbool isValidPoint(){\r\n    for (int i = 0; i < 10; i++){\r\n        if (startIDs[i] == -1){\r\n            return false;\r\n        }\r\n        int rePos = gl_VertexID - startIDs[i];\r\n        bool isValid = rePos % stride == 0;\r\n        bool secondary = gl_VertexID < (startIDs[i] + dimWidth*stride) && gl_VertexID > startIDs[i];\r\n        isValid = isValid && secondary;\r\n        if (isValid){\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nvoid main() {\r\n    vValue = value/255.;\r\n    vec3 scaledPos = position;\r\n    scaledPos.z += depthRatio;\r\n    scaledPos.z = mod(scaledPos.z + animateProg*2.*depthRatio, 2.*depthRatio);\r\n    scaledPos.z -= depthRatio;\r\n\r\n    scaledPos.z *= timeScale;\r\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(scaledPos, 1.0);\r\n    //If it is nan we just yeet it tf out of the screen space. LMAO I love this solution\r\n    float pointScale = pointSize/gl_Position.w;\r\n    pointScale = scalePoints ? pointScale*pow(vValue,scaleIntensity) : pointScale;\r\n\r\n    bool isValid = isValidPoint();\r\n    highlight = isValid ? 1 : 0;\r\n    \r\n    if (value == 255. || (pointScale*gl_Position.w < 0.75 && scalePoints)){ //Hide points that are invisible or get too small when scalled\r\n        gl_Position = vec4(2.0, 2.0, 2.0, 1.0);\r\n    }\r\n\r\n    if (vValue < valueRange.x || vValue > valueRange.y){ //Hide points that are outside of value range\r\n        gl_Position = vec4(2.0, 2.0, 2.0, 1.0);\r\n    }\r\n\r\n    vec2 scaledZBounds = vec2(flatBounds.z,  flatBounds.w) * vec2(timeScale);\r\n    bool xCheck = scaledPos.x < flatBounds.x || scaledPos.x > flatBounds.y;\r\n    bool zCheck = scaledPos.z < scaledZBounds.x || scaledPos.z > scaledZBounds.y;\r\n    bool yCheck = scaledPos.y < vertBounds.x || scaledPos.y> vertBounds.y;\r\n\r\n    if (xCheck || zCheck || yCheck){ //Hide points that are clipped\r\n        gl_Position = vec4(2.0, 2.0, 2.0, 1.0);\r\n    }\r\n    \r\n    if (showTransect){\r\n        gl_PointSize = isValid ? max(pointScale*5. , pointScale+80./gl_Position.w) : pointScale;\r\n    }\r\n    else{\r\n        gl_PointSize =  pointScale;\r\n    }\r\n\r\n}\r\n",fragmentShader:"out vec4 Color;\r\n\r\nin float vValue;\r\nflat in int highlight;\r\n\r\n\r\nuniform sampler2D cmap;\r\nuniform float cScale;\r\nuniform float cOffset;\r\nuniform bool showTransect;\r\n\r\nvoid main() {\r\n\r\n    float sampLoc = vValue == 1. ? vValue : (vValue - 0.5)*cScale + 0.5;\r\n    sampLoc = vValue == 1. ? vValue : min(sampLoc+cOffset,0.99);\r\n    vec4 color = texture(cmap, vec2(sampLoc, 0.5));\r\n    color.a = 1.;\r\n    Color = color;\r\n    if (showTransect){\r\n        Color = highlight == 1 ? color : color * vec4(vec3(0.4),1.);\r\n    }\r\n    else{\r\n        Color = color;\r\n    }\r\n\r\n}\r\n",depthWrite:!0,transparent:!0,blending:o.NTi,side:o.$EB}),[f,a,v,p,x,m,d,P,z,w,g,y,N,W,S,b,j]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("mesh",{scale:[1,u?-1:1,1],children:(0,r.jsx)("points",{geometry:_,material:T})}),(0,r.jsx)(h,{dimensions:{width:B,height:O,depth:L},ZarrDS:t,setters:{setPointIDs:M,setStride:D,setDimWidth:A}})]})};var x=t(3758),g=t(5496);t(7619);var w=t(5461);t(6720);var y=t(4860),S=t(7010);function b(e){let{...n}=e;return(0,r.jsx)(y.Root,{"data-slot":"dropdown-menu",...n})}function j(e){let{...n}=e;return(0,r.jsx)(y.Trigger,{"data-slot":"dropdown-menu-trigger",...n})}function C(e){let{className:n,sideOffset:t=4,...o}=e;return(0,r.jsx)(y.Portal,{children:(0,r.jsx)(y.Content,{"data-slot":"dropdown-menu-content",sideOffset:t,className:(0,S.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",n),...o})})}function P(e){let{...n}=e;return(0,r.jsx)(y.Group,{"data-slot":"dropdown-menu-group",...n})}function M(e){let{className:n,inset:t,variant:o="default",...i}=e;return(0,r.jsx)(y.Item,{"data-slot":"dropdown-menu-item","data-inset":t,"data-variant":o,className:(0,S.cn)("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",n),...i})}function z(e){let{className:n,...t}=e;return(0,r.jsx)(y.Separator,{"data-slot":"dropdown-menu-separator",className:(0,S.cn)("bg-border -mx-1 my-1 h-px",n),...t})}let D=s.memo(function(){let{showPoints:e,linePointSize:n,pointColor:t,useCustomPointColor:o,setLinePointSize:i,setPointColor:a,setUseCustomPointColor:s}=(0,l.Ws)((0,c.k)(e=>({showPoints:e.showPoints,linePointSize:e.linePointSize,pointColor:e.pointColor,useCustomPointColor:e.useCustomPointColor,setLinePointSize:e.setLinePointSize,setPointColor:e.setPointColor,setUseCustomPointColor:e.setUseCustomPointColor})));return e?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"w-full flex items-center",children:[(0,r.jsx)("div",{className:"w-[40%]",children:(0,r.jsx)("b",{children:"Point Size"})}),(0,r.jsx)("input",{type:"range",min:1,max:10,step:.1,value:n,onChange:e=>i(parseFloat(e.target.value))})]}),(0,r.jsxs)("div",{className:"w-full flex items-center",children:[(0,r.jsx)("div",{className:"w-[40%]",children:(0,r.jsx)("b",{children:"Point Color"})}),o&&(0,r.jsx)("input",{type:"color",title:"Point Color",value:t,onChange:e=>a(e.target.value)}),(0,r.jsxs)(w.$,{className:"h-8 px-2 py-1",variant:"outline",onClick:()=>s(!o),children:["Use",o?" Browzarr Color":" Custom Color"]})]})]}):null}),k=s.memo(function(){let{lineWidth:e,lineColor:n,useLineColor:t,lineResolution:o,useCustomColor:i,setLineWidth:a,setLineColor:s,setUseLineColor:u,setLineResolution:m,setUseCustomColor:d}=(0,l.Ws)((0,c.k)(e=>({lineWidth:e.lineWidth,lineColor:e.lineColor,useLineColor:e.useLineColor,lineResolution:e.lineResolution,useCustomColor:e.useCustomColor,setLineWidth:e.setLineWidth,setLineColor:e.setLineColor,setUseLineColor:e.setUseLineColor,setLineResolution:e.setLineResolution,setUseCustomColor:e.setUseCustomColor})));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"w-full flex items-center",children:[(0,r.jsx)("div",{className:"w-[40%]",children:(0,r.jsx)("b",{children:"Line Width"})}),(0,r.jsx)("input",{type:"range",min:1,max:10,step:.2,value:e,onChange:e=>a(parseFloat(e.target.value))})]}),(0,r.jsxs)("div",{className:"w-full flex items-center",children:[(0,r.jsx)("div",{className:"w-[40%]",children:(0,r.jsx)("b",{children:"Line Resolution"})}),(0,r.jsx)("input",{type:"range",min:1,max:10,step:1,value:o,onChange:e=>m(parseFloat(e.target.value))})]}),(0,r.jsxs)("div",{className:"w-full flex items-center",children:[(0,r.jsx)("div",{className:"w-[40%]",children:(0,r.jsx)("b",{children:"Line Color"})}),i&&(0,r.jsx)("input",{type:"color",title:"Line Color",value:n,onChange:e=>s(e.target.value)}),!i&&(0,r.jsxs)(w.$,{className:"h-8 px-2 py-5",variant:"outline",onClick:()=>u(!t),children:["Use ",(0,r.jsx)("br",{}),t?"Individual Color":"Plot Color"]}),(0,r.jsxs)(w.$,{className:"h-8 px-2 py-5",variant:"outline",onClick:()=>d(!i),children:["Use ",(0,r.jsx)("br",{}),i?"Browzarr Color":"Custom Color"]})]})]})}),A=s.memo(function(){let{showPoints:e,setShowPoints:n}=(0,l.Ws)((0,c.k)(e=>({showPoints:e.showPoints,setShowPoints:e.setShowPoints})));return(0,r.jsx)("div",{className:"plotline-options",children:(0,r.jsxs)(b,{children:[(0,r.jsx)(j,{asChild:!0,children:(0,r.jsx)(w.$,{className:"cursor-pointer",variant:"outline",children:"Line Options"})}),(0,r.jsxs)(C,{className:"w-80 items-center",align:"center",children:[(0,r.jsx)(P,{onClick:e=>e.preventDefault(),children:(0,r.jsx)(M,{children:(0,r.jsx)(w.$,{variant:"outline",onClick:t=>{t.preventDefault(),n(!e)},children:e?"Hide Points":"Show Points"})})}),(0,r.jsx)(D,{}),(0,r.jsx)(z,{}),(0,r.jsx)(k,{})]})]})})});var V=t(958),B=t(3135);function O(e){let{pointID:n,pointLoc:t,showPointInfo:o,plotUnits:i}=e,{plotDim:a,dimArrays:u,dimNames:m,dimUnits:d,timeSeries:p}=(0,l.on)((0,c.k)(e=>({plotDim:e.plotDim,dimArrays:e.dimArrays,dimNames:e.dimNames,dimUnits:e.dimUnits,timeSeries:e.timeSeries}))),h=0,v=0;if(Object.entries(n).length>0&&Object.entries(p).length>0){let[e,t]=Object.entries(n)[0];h=p[e][t],v=u[a][t]}let[x,g]=t,[w,y]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{if(!o){let e=setTimeout(()=>{y(!1)},100);return()=>clearTimeout(e)}y(!0)},[o]),(0,r.jsx)(r.Fragment,{children:w&&(0,r.jsxs)("div",{className:"point-info",style:{left:"".concat(x,"px"),top:"".concat(g,"px")},children:["".concat(h.toFixed(2)).concat(i),(0,r.jsx)("br",{}),"".concat(m[a],": ").concat((0,f.parseLoc)(v,d[a]),"       \n        ")]})})}function L(){let{coords:e,timeSeries:n,setDimCoords:t,setTimeSeries:o}=(0,l.on)((0,c.k)(e=>({coords:e.dimCoords,timeSeries:e.timeSeries,setDimCoords:e.setDimCoords,setTimeSeries:e.setTimeSeries}))),[i,a]=(0,s.useState)(!1),u=(0,s.useRef)([0,Math.round(.255*window.innerHeight)]),m=(0,s.useRef)([0,Math.round(.255*window.innerHeight)]),[d,p]=(0,s.useState)([0,Math.round(.255*window.innerHeight)]);function h(e){if(i){let n=u.current[0]-e.clientX,t=u.current[1]-e.clientY,r=Math.min(Math.max(m.current[0]-n,10),window.innerWidth-120),o=Math.max(m.current[1]+t,0);p([Math.min(r,window.innerWidth-100),Math.min(o,window.innerHeight-100)])}}function v(){a(!1)}return(0,s.useEffect)(()=>(i&&(document.addEventListener("mousemove",h),document.addEventListener("mouseup",v)),()=>{document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",v)}),[i]),(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{className:"coord-container",onPointerDown:function(e){u.current=[e.clientX,e.clientY],m.current=[...d],a(!0)},onPointerMove:h,onPointerUp:()=>a(!1),style:{left:"".concat(d[0],"px"),bottom:"".concat(d[1],"px")},children:Object.keys(e).length>0&&Object.keys(e).reverse().map((i,a)=>(0,r.jsxs)("div",{className:"plot-coords",style:{background:"rgb(".concat((0,V.md)(a/10,"Paired"),")"),justifyContent:"space-between"},children:[(0,r.jsx)("b",{children:"".concat(e[i].first.name,": ")}),"".concat((0,f.parseLoc)(e[i].first.loc,e[i].first.units)),(0,r.jsx)("br",{}),(0,r.jsx)("b",{children:"".concat(e[i].second.name,": ")}),"".concat((0,f.parseLoc)(e[i].second.loc,e[i].second.units)),(0,r.jsx)(B.Xr4,{onClick:()=>(function(r){let{[r]:i,...a}=e;t(a);let{[r]:s,...l}=n;o(l)})(i),color:"red",style:{cursor:"pointer",zIndex:3}})]},i))})})}function W(){let[e,n]=(0,s.useState)({}),[t,o]=(0,s.useState)([0,0]),[i,a]=(0,s.useState)(!1),[c,u]=(0,s.useState)(Math.round(window.innerHeight-.25*window.innerHeight)),m=(0,l.on)(e=>e.metadata),d=m?m.units:"Default",[f,p]=(0,s.useState)(1),[h,v]=(0,s.useState)(1);(0,s.useEffect)(()=>{let e=()=>{let e=Math.round(window.innerHeight-.25*window.innerHeight);u(e),document.documentElement.style.setProperty("--plot-height","".concat(e,"px"))};return window.addEventListener("orientationchange",e),window.addEventListener("resize",e),()=>{window.removeEventListener("orientationchange",e),window.removeEventListener("resize",e)}},[]),(0,s.useEffect)(()=>{document.documentElement.style.setProperty("--plot-height","".concat(c,"px"))},[c]);let w=window.innerHeight-c>=10;return(0,r.jsxs)(r.Fragment,{children:[!w&&(0,r.jsx)(g.de,{onClick:()=>{u(window.innerHeight-60)}}),w&&(0,r.jsxs)("div",{className:"plot-canvas",children:[(0,r.jsx)(A,{}),i&&(0,r.jsx)(O,{pointID:e,pointLoc:t,showPointInfo:i,plotUnits:d}),(0,r.jsx)(g.A,{height:c,setHeight:u}),(0,r.jsx)(g.gj,{scale:f,setScale:p}),(0,r.jsx)(g.LC,{scale:h,setScale:v}),(0,r.jsxs)(x.Hl,{orthographic:!0,camera:{position:[0,0,100]},frameloop:"demand",children:[(0,r.jsx)(H,{height:c,yScale:f,pointSetters:{setPointID:n,setPointLoc:o,setShowPointInfo:a},xScale:h}),(0,r.jsx)(_,{height:c,yScale:f,xScale:h})]}),(0,r.jsx)(L,{})]})]})}var N=t(5106),F=t(8340),R=t(6290);function _(e){let{colorTicks:n="grey",tickSize:t=4,fontSize:o=14,showGrid:i=!0,gridOpacity:a=.5,height:u,yScale:m=1,xScale:d=1}=e,{camera:p}=(0,R.C)(),[h,v]=(0,s.useState)({left:0,right:0,top:0,bottom:0}),{dimCoords:x,dimArrays:g,plotDim:w,valueScales:y}=(0,l.on)((0,c.k)(e=>({dimCoords:e.dimCoords,dimArrays:e.dimArrays,plotDim:e.plotDim,valueScales:e.valueScales}))),S=g[w],b=S.length,j=y.maxVal-y.minVal,C=(0,s.useMemo)(()=>{let e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(S){if(S.every(e=>"bigint"==typeof e)){let n=Object.keys(x).length>0?Object.keys(x)[0]:null,t=n?(0,f.parseTimeUnit)(x[n].plot.units):1,r=[];for(let n=0;n<S.length;n++){let o=new Date(Number(S[n])*t),i="".concat(o.getDate().toString().padStart(2,"0")," ").concat(e[o.getMonth()],"\n").concat(o.getFullYear());r.push(i)}return r}return S.map(e=>String(e))}},[S,x]),P=(0,s.useMemo)(()=>{let e=window.innerWidth,n=window.innerHeight-u;return{left:-e/2+p.position.x,right:e/2+p.position.x,top:n/2+p.position.y,bottom:-n/2+p.position.y}},[]),[M,z]=(0,s.useState)(p.zoom),D=(0,s.useMemo)(()=>{let e=1/p.zoom;return{tickSize:t*e,fontSize:o/e,labelOffset:t*e}},[p.zoom,t,o]);(0,R.D)(()=>{p.zoom!==M&&z(p.zoom);let e=window.innerWidth/p.zoom,n=(window.innerHeight-u)/p.zoom,t={left:-e/2+p.position.x,right:e/2+p.position.x,top:n/2+p.position.y,bottom:-n/2+p.position.y};JSON.stringify(h)!=JSON.stringify(t)&&v(t)});let k=(0,s.useRef)(null),A=(0,s.useRef)(null);(0,s.useEffect)(()=>(k.current&&clearTimeout(k.current),A.current&&(k.current=setTimeout(()=>{A.current&&A.current.reset()},100)),()=>{null!==k.current&&clearTimeout(k.current)}),[u]);let V=(h.top+h.bottom)/2,B=(h.left+h.right)/2;return(0,r.jsxs)("group",{children:[i&&(0,r.jsxs)(r.Fragment,{children:[Array.from({length:10},(e,t)=>{var o;if(0===t||9===t)return null;let i=+Math.round(h.left/1)+(Math.round(h.right/1)-Math.round(h.left/1))*(t/9),l=i/d/(P.right-P.left)+.5;return(0,r.jsxs)(s.Fragment,{children:[(0,r.jsx)("group",{position:[i,V,0],children:(0,r.jsxs)("line",{children:[(0,r.jsx)("bufferGeometry",{children:(0,r.jsx)("float32BufferAttribute",{attach:"attributes-position",args:[new Float32Array([0,h.top-V,0,0,h.bottom-V,0]),3]})}),(0,r.jsx)("lineDashedMaterial",{color:n,opacity:a,transparent:!0,dashSize:.5,gapSize:.5})]},"vgrid-".concat(t))}),(0,r.jsxs)("group",{position:[i,h.top,0],children:[(0,r.jsxs)("line",{children:[(0,r.jsx)("bufferGeometry",{children:(0,r.jsx)("float32BufferAttribute",{attach:"attributes-position",args:[new Float32Array([0,0,0,0,-D.tickSize,0]),3]})}),(0,r.jsx)("lineBasicMaterial",{color:n})]}),0!==t&&9!==t&&(0,r.jsx)(N.E,{position:[0,D.tickSize/4-D.labelOffset,0],fontSize:D.fontSize/M**2,color:n,anchorX:"center",anchorY:"top",children:null!=(o=null==C?void 0:C[Math.round(l*b-.5)])?o:""})]},"top-tick-".concat(t))]},"vert-group-".concat(t))}),Array.from({length:8},(e,t)=>{if(0===t||7===t)return null;let o=h.bottom+(h.top-h.bottom)*(t/7),i=o/m/(h.top-h.bottom)/M+.5;return(0,r.jsxs)(s.Fragment,{children:[(0,r.jsx)("group",{position:[B,o,0],children:(0,r.jsxs)("line",{children:[(0,r.jsx)("bufferGeometry",{children:(0,r.jsx)("float32BufferAttribute",{attach:"attributes-position",args:[new Float32Array([h.left-B,0,0,h.right-B,0,0]),3]})}),(0,r.jsx)("lineDashedMaterial",{color:n,opacity:a,transparent:!0,dashSize:0,gapSize:.5,linewidth:1})]})},"hgrid-".concat(t)),(0,r.jsxs)("group",{position:[h.right,o,0],children:[(0,r.jsxs)("line",{children:[(0,r.jsx)("bufferGeometry",{children:(0,r.jsx)("float32BufferAttribute",{attach:"attributes-position",args:[new Float32Array([0,0,0,-D.tickSize,0,0]),3]})}),(0,r.jsx)("lineBasicMaterial",{color:n})]}),0!==t&&7!==t&&(0,r.jsx)(N.E,{position:[-D.tickSize-D.labelOffset,0,0],fontSize:D.fontSize/M**2,color:n,anchorX:"right",anchorY:"middle",children:(y.minVal+i*j).toFixed(1)})]},"right-tick-".concat(t))]},"vert-group-".concat(t))})]}),(0,r.jsx)(F.N,{ref:A,enableRotate:!1,enablePan:!0,enableZoom:!0,zoomSpeed:.85,maxDistance:500,maxZoom:20,minZoom:.5})]})}var T=t(7410);t(601);let U=e=>{let{loc:n,show:t,info:o}=e,{dimNames:i,dimUnits:a}=(0,l.on)((0,c.k)(e=>({dimNames:e.dimNames,dimUnits:e.dimUnits}))),u=(0,l.r2)(e=>e.axis),m=(0,s.useMemo)(()=>i.length<3?[i[0],i[1]]:i.filter((e,n)=>n!=u),[i,u]),d=(0,s.useMemo)(()=>i.length<3?[a[0],a[1]]:a.filter((e,n)=>n!=u),[a,u]);return(0,r.jsxs)("div",{className:"analysis-info",style:{left:"".concat(n[0]+10,"px"),top:"".concat(n[1]+10,"px"),display:t?"":"none"},children:["".concat(m[0],": ").concat(t&&(0,f.parseLoc)(o[0],d[0])),(0,r.jsx)("br",{}),"".concat(m[1],": ").concat(t&&(0,f.parseLoc)(o[1],d[1])),(0,r.jsx)("br",{}),"Value: ".concat(Math.round(100*o[2])/100)]})},E=e=>{let{isFlat:n}=e,{resetCamera:t}=(0,l.Ws)((0,c.k)(e=>({resetCamera:e.resetCamera}))),i=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(i.current){let e,t=i.current,r=performance.now(),a=t.object.position.clone(),s=t.position0.clone(),l=t.target.clone(),c=t.target0.clone(),u=t.object.zoom,m=i=>{(0,R.m)();let d=Math.min((i-r)/1e3,1);t.object.position.lerpVectors(a,s,d),t.target.lerpVectors(l,c,d),n&&(t.object.zoom=o.cj9.lerp(u,1e3,d),t.object.updateProjectionMatrix(),t.update()),d<1&&(e=requestAnimationFrame(m))};return e=requestAnimationFrame(m),()=>cancelAnimationFrame(e)}},[t]),(0,r.jsxs)(r.Fragment,{children:[n&&(0,r.jsx)(F.N,{ref:i,enableRotate:!1,enablePan:!0,maxDistance:50,minZoom:50,maxZoom:3e3}),!n&&(0,r.jsx)(F.N,{ref:i,enableRotate:!0,enablePan:!0,maxDistance:50})]})},I=e=>{let{ZarrDS:n,setShowLoading:t}=e,{setShape:i,setFlipY:a,setValueScales:u,setMetadata:m,setDimArrays:f,setDimNames:h,setDimUnits:w,setPlotOn:y}=(0,l.on)((0,c.k)(e=>({setShape:e.setShape,setFlipY:e.setFlipY,setValueScales:e.setValueScales,setMetadata:e.setMetadata,setDimArrays:e.setDimArrays,setDimNames:e.setDimNames,setDimUnits:e.setDimUnits,setPlotOn:e.setPlotOn}))),{colormap:S,variable:b,isFlat:j,metadata:C,valueScales:P,setIsFlat:M,setDataArray:z}=(0,l.on)((0,c.k)(e=>({colormap:e.colormap,variable:e.variable,isFlat:e.isFlat,metadata:e.metadata,valueScales:e.valueScales,setIsFlat:e.setIsFlat,setDataArray:e.setDataArray}))),{plotType:D}=(0,l.Ws)((0,c.k)(e=>({plotType:e.plotType}))),k=(0,l.SZ)(e=>e.slice),A=(0,s.useRef)([0,0]),V=(0,s.useRef)(0),[B,O]=(0,s.useState)(!1),[L,W]=(0,s.useState)([0,0]),[N,F]=(0,s.useState)(null),[R,_]=(0,s.useState)(!0);(0,s.useEffect)(()=>{let e=new MutationObserver(e=>{e.forEach(e=>{e.attributeName})});return e.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>e.disconnect()},[]),(0,s.useEffect)(()=>{if("Default"!=b){t(!0),_(!1);try{n.GetArray(b,k).then(e=>{let[n,r]=(0,T.oW)({data:e.data,shape:e.shape});n instanceof o.GYF||n instanceof o.dYF?F(n):(console.error("Invalid texture type returned from ArrayToTexture"),F(null)),"object"==typeof r&&"maxVal"in r&&"minVal"in r&&u(r),2==e.shape.length?M(!0):M(!1),z(e.data);let a=e.shape[1]/e.shape[2]*2;i(new o.Pq0(2,a,2)),t(!1),_(!0),y(!0)})}catch(e){t(!1);return}n.GetAttributes(b).then(e=>{m(e);let[t,r,o]=n.GetDimArrays();f(t),h(o),t.length>2?t[1][1]<t[1][0]?a(!0):a(!1):t[0][1]<t[0][0]?a(!0):a(!1);let i=[];for(let e of r)i.push(e.units);w(i)})}else m(null)},[b]);let I=(0,s.useMemo)(()=>({setLoc:W,setShowInfo:O,coords:A,val:V}),[]),Y=(0,s.useMemo)(()=>g.Fp,[]);return(0,r.jsxs)("div",{className:"main-canvas",style:{width:"100vw"},children:[R&&(0,r.jsx)(g.PL,{units:null==C?void 0:C.units,valueScales:P}),(0,r.jsx)(Y,{}),(j||"flat"==D)&&(0,r.jsx)(U,{loc:L,show:B,info:[...A.current,V.current]}),(!j&&"flat"!=D||j&&"sphere"===D)&&(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(x.Hl,{id:"main-canvas",camera:{position:j?[0,0,5]:[-4.5,3,4.5],fov:50},frameloop:"demand",children:["volume"==D&&R&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d,{volTexture:N}),(0,r.jsx)(p,{ZarrDS:n})]}),"point-cloud"==D&&R&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(v,{textures:{texture:N,colormap:S},ZarrDS:n})}),"sphere"==D&&R&&(0,r.jsx)(q,{texture:N,ZarrDS:n}),(0,r.jsx)(E,{isFlat:!1})]})}),(j||"flat"==D)&&(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(x.Hl,{id:"main-canvas",camera:{position:[0,0,5],zoom:1e3},orthographic:!0,frameloop:"demand",children:[(0,r.jsx)(Z,{texture:N,infoSetters:I}),(0,r.jsx)(E,{isFlat:!0})]})})]})};function Y(e){let{points:n,tsID:t,pointSetters:i,colIDX:a,scalers:u}=e,m=(0,s.useRef)(null),d=n.length,f=(0,s.useRef)(null),[p,h]=(0,s.useState)(!1),{setPointID:v,setPointLoc:x,setShowPointInfo:g}=i,[w,y]=(0,s.useState)(1),{pointColor:S,pointSize:b,useCustomPointColor:j}=(0,l.Ws)((0,c.k)(e=>({pointColor:e.pointColor,pointSize:e.linePointSize,showPoints:e.showPoints,useCustomPointColor:e.useCustomPointColor}))),{xScale:C,yScale:P}=u,[M,z,D]=(0,s.useMemo)(()=>(0,V.md)(a/10,"Paired"),[a]),k=(0,s.useMemo)(()=>new o.Gu$(b),[b]),A=(0,s.useMemo)(()=>new o.V9B({color:j?S:new o.Q1f().setRGB(M/500,z/500,D/500)}),[S,j]);return(0,s.useEffect)(()=>{if(m.current){let e=new o.B69;for(let t=0;t<d;t++){let r=n[t].toArray();e.position.set(r[0]*(C/2),r[1]*P,1),e.scale.set(b/w,b/w,b/w),e.updateMatrix(),m.current.setMatrixAt(t,e.matrix)}m.current.instanceMatrix.needsUpdate=!0}},[n,w,k,A,C,P,b]),(0,R.D)(e=>{let{camera:n}=e;n.zoom!==w&&y(n.zoom)}),(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("mesh",{position:[0,0,5],onPointerEnter:function(e){if(m.current){let n=e.instanceId,r=new o.B69,i=new o.kn4,a=new o.Pq0;n!=f.current&&f.current&&(m.current.getMatrixAt(f.current,i),a.setFromMatrixPosition(i),r.scale.set(b/w,b/w,b/w),r.position.copy(a),r.updateMatrix(),m.current.setMatrixAt(f.current,r.matrix)),f.current=n,m.current.getMatrixAt(n,i),a.setFromMatrixPosition(i),r.scale.set(3*b/w,3*b/w,3/w),r.position.copy(a),r.updateMatrix(),m.current.setMatrixAt(e.instanceId,r.matrix),m.current.instanceMatrix.needsUpdate=!0,h(e=>!e),v({[t]:e.instanceId}),x([e.clientX,e.clientY]),g(!0)}},onPointerLeave:function(e){let n=e.instanceId;if(m.current){let e=new o.B69,t=new o.kn4,r=new o.Pq0;f.current&&(m.current.getMatrixAt(n,t),r.setFromMatrixPosition(t),e.scale.set(b/w,b/w,b/w),e.position.copy(r),e.updateMatrix(),m.current.setMatrixAt(n,e.matrix),m.current.instanceMatrix.needsUpdate=!0,h(e=>!e),g(n!=f.current))}},children:(0,r.jsx)("instancedMesh",{ref:m,args:[k,A,d]})})})}let H=e=>{let{height:n,xScale:t,yScale:i,pointSetters:a}=e,{valueScales:u,timeSeries:m,colormap:d}=(0,l.on)((0,c.k)(e=>({valueScales:e.valueScales,timeSeries:e.timeSeries,colormap:e.colormap}))),{lineWidth:f,useLineColor:p,lineColor:h,showPoints:v,lineResolution:x,useCustomColor:g}=(0,l.Ws)((0,c.k)(e=>({lineWidth:e.lineWidth,linePointSize:e.linePointSize,showPoints:e.showPoints,useLineColor:e.useLineColor,lineColor:e.lineColor,lineResolution:e.lineResolution,useCustomColor:e.useCustomColor})));(0,s.useRef)([]);let{camera:w}=(0,R.C)(),{maxVal:y,minVal:S}=u,b=(0,s.useMemo)(()=>{let e={};return Object.keys(m).reverse().map((n,r)=>{let[a,s,l]=(0,V.md)(r/10,"Paired");e[n]=new o.BKk({glslVersion:o.Wdf,uniforms:{cmap:{value:d},xScale:{value:t},yScale:{value:i},aspect:{value:window.innerWidth/window.innerHeight},thickness:{value:f},miter:{value:1},useLineColor:{value:g},useMapColors:{value:p},lineColor:{value:new o.Q1f().setRGB(a/255,s/255,l/255)},userColor:{value:new o.Q1f(h)},zoom:{value:w.zoom}},vertexShader:"attribute float direction; \nattribute vec3 next;\nattribute vec3 previous;\nattribute float normed;\n\nvarying float vNormed;\n\nuniform float zoom;\nuniform float thickness;\nuniform int miter;\nuniform float xScale; \nuniform float yScale;\n\nfloat getOrthographicZoom(mat4 projectionMatrix, float referenceWidth) {\n    float m0 = projectionMatrix[0][0]; // Scaling factor: 2/(right-left)\n    float viewWidth = 2.0 / m0; // Viewable width\n    return referenceWidth / viewWidth; // Zoom level\n}\n\nvoid main() {\n    vec3 pos = position;\n    vec3 prev = previous;\n    vec3 nex = next;\n    pos.x *= xScale/2.0;\n    pos.y *= yScale;\n    prev.x *= xScale/2.0;\n    prev.y *= yScale;\n    nex.x *= xScale/2.0;\n    nex.y *= yScale;\n\n    // Transform positions to view space (before projection)\n    float zoom = getOrthographicZoom(projectionMatrix, 2.);\n    float zoomLevel = 2. / projectionMatrix[0][0]; // Extract vertical scale\n    vec4 currentView = modelViewMatrix * vec4(pos, 1.0);\n    vec4 prevView = modelViewMatrix * vec4(prev, 1.0);\n    vec4 nextView = modelViewMatrix * vec4(nex, 1.0);\n\n    // Compute directions in view space\n    vec3 dir = vec3(0.0);\n    if (currentView.xyz == prevView.xyz) {\n        dir = normalize(nextView.xyz - currentView.xyz);\n    } else if (currentView.xyz == nextView.xyz) {\n        dir = normalize(currentView.xyz - prevView.xyz);\n    } else {\n        vec3 dirA = normalize(currentView.xyz - prevView.xyz);\n        if (miter == 1) {\n            vec3 dirB = normalize(nextView.xyz - currentView.xyz);\n            vec3 tangent = normalize(dirA + dirB);\n            vec3 perp = vec3(-dirA.y, dirA.x, 0.0); // Perpendicular in view space\n            vec3 miterVec = vec3(-tangent.y, tangent.x, 0.0);\n            float miterLen = dot(miterVec, perp);\n            miterLen = max(miterLen, 0.5); // Avoid division by zero\n            dir = tangent;\n        } else {\n            dir = dirA;\n        }\n    }\n\n    // Compute normal in view space\n    vec3 normal = vec3(-dir.y, dir.x, 0.0); // Perpendicular to direction\n    float len = thickness / zoom/500.; // Thickness in world/view space units\n    normal *= 0.5 * len * direction; // Apply thickness and direction\n\n    // Apply offset in view space\n    currentView.xyz += normal;\n\n    // Project to clip space\n    gl_Position = projectionMatrix * currentView;\n\n\n    vNormed = normed;\n    gl_PointSize = 1.0;\n}",fragmentShader:"\n                out vec4 Color;\n                uniform sampler2D cmap;\n                uniform bool useLineColor;\n                uniform bool useMapColors;\n                uniform vec3 lineColor;\n                uniform vec3 userColor;\n                varying float vNormed;\n\n                void main() {\n                    vec4 texColor = texture(cmap, vec2(vNormed, 0.1));\n                    texColor.a = 1.;\n                    Color = useLineColor ? vec4(userColor, 1.0) : useMapColors ? texColor : vec4(lineColor, 1.0) ;\n                }\n                ",depthWrite:!1})}),e},[d,f,t,i,window.innerWidth,window.innerHeight,p,h,w.zoom,g,m]),j=(0,s.useMemo)(()=>window.innerWidth,[window.innerWidth]),C=(0,s.useMemo)(()=>window.innerHeight-n,[window.innerWidth,n]),[P,M]=(0,s.useState)({}),z=(0,s.useMemo)(()=>{let e={},n={};return Object.keys(m).map((t,r)=>{let i=m[t],a=i.map(e=>(e-S)/(y-S)),s=function(e,n,t){let r=(n-e)/(t-1);return Array.from({length:t},(n,t)=>e+r*t)}(-j,j,i.length),l=a.map((e,n)=>new o.Pq0(s[n],(e-.5)*C,5));n[t]=l;let c=new o.B6O(l).getPoints(l.length*x-1),u=[];for(let e=0;e<c.length;e++){let n=e/(c.length-1)*(a.length-1),t=Math.floor(n),r=Math.min(a.length-1,Math.ceil(n)),o=n-t;u.push(a[t]*(1-o)+a[r]*o)}let d=c.length,f=[],p=[],h=[],v=[],g=[],w=[];for(let e=0;e<d;e++){let n=c[e],t=c[Math.max(0,e-1)],r=c[Math.min(d-1,e+1)];f.push(...n,...n),p.push(1,-1),h.push(...t,...t),v.push(...r,...r),g.push(u[e],u[e])}for(let e=0;e<d-1;e++){let n=2*e,t=n+1,r=n+2,o=n+3;w.push(n,t,r),w.push(t,o,r)}let b=new o.LoY;b.setAttribute("position",new o.qtW(f,3)),b.setAttribute("direction",new o.qtW(p,1)),b.setAttribute("previous",new o.qtW(h,3)),b.setAttribute("next",new o.qtW(v,3)),b.setAttribute("normed",new o.qtW(g,1)),b.setIndex(new o.A$4(w,1)),e[t]=b}),M(n),e},[m,x]);return(0,s.useEffect)(()=>{(0,R.m)()},[v]),(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("group",{children:[Object.keys(m).map((e,n)=>(0,r.jsx)("mesh",{geometry:z[e],material:b[e]},"lineMesh_".concat(n))),v&&Object.keys(m).map((e,n)=>(0,r.jsx)(Y,{points:P[e],tsID:e,colIDX:n,pointSetters:a,scalers:{xScale:t,yScale:i}},"plotPoints_".concat(n)))]})})},Z=e=>{let{texture:n,infoSetters:t}=e,{setLoc:i,setShowInfo:a,val:u,coords:m}=t,{shape:d,flipY:f,colormap:p,dataArray:h,valueScales:v,dimArrays:x,isFlat:g}=(0,l.on)((0,c.k)(e=>({shape:e.shape,flipY:e.flipY,colormap:e.colormap,dataArray:e.dataArray,valueScales:e.valueScales,dimArrays:e.dimArrays,isFlat:e.isFlat}))),{cScale:w,cOffset:y,animProg:S}=(0,l.Ws)((0,c.k)(e=>({cOffset:e.cOffset,cScale:e.cScale,resetAnim:e.resetAnim,animate:e.animate,animProg:e.animProg}))),b=(0,s.useMemo)(()=>d.x/d.z,[d]),j=(0,s.useMemo)(()=>new o.bdM(2,b),[b]),C=(0,s.useRef)(!1),P=(0,s.useRef)(new o.I9Y(0,0)),M=(0,s.useMemo)(()=>new o.BKk({glslVersion:o.Wdf,uniforms:{cScale:{value:w},cOffset:{value:y},data:{value:n},cmap:{value:p},animateProg:{value:S}},vertexShader:" // by Jeran Poehls\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n    vUv = uv;\r\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n}",fragmentShader:g?"uniform sampler2D data;\r\nuniform sampler2D cmap;\r\n\r\nuniform float cOffset;\r\nuniform float cScale;\r\n\r\nvarying vec2 vUv;\r\nout vec4 Color;\r\n\r\nvoid main() {\r\n    vec4 val = texture(data,vUv);\r\n    float d = val.x;\r\n    float sampLoc = d == 1. ? d : (d - 0.5)*cScale + 0.5;\r\n    sampLoc = d == 1. ? d : min(sampLoc+cOffset,0.99);\r\n    vec4 color = texture(cmap, vec2(sampLoc,0.5));\r\n    color.a = val.x > 0.999 ? 0. : 1.;\r\n\r\n    Color = color;\r\n}":"uniform sampler3D data;\r\nuniform sampler2D cmap;\r\n\r\nuniform float cOffset;\r\nuniform float cScale;\r\nuniform float animateProg;\r\n\r\nvarying vec2 vUv;\r\nout vec4 Color;\r\n\r\nvoid main() {\r\n    vec4 val = texture(data,vec3(vUv, animateProg));\r\n    float d = val.x;\r\n    float sampLoc = d == 1. ? d : (d - 0.5)*cScale + 0.5;\r\n    sampLoc = d == 1. ? d : min(sampLoc+cOffset,0.99);\r\n    vec4 color = texture(cmap, vec2(sampLoc,0.5));\r\n    color.a = val.x > 0.999 ? 0. : 1.;\r\n\r\n    Color = color;\r\n}",side:o.$EB}),[w,y,n,p,S]);(0,s.useEffect)(()=>{j.dispose()},[j]);let z=(0,s.useRef)(null),D=(0,s.useCallback)(e=>{if(C.current&&e.uv){z.current=e,i([e.clientX,e.clientY]),P.current=e.uv;let{x:n,y:t}=e.uv,r=g?x[1].length:x[2].length,o=g?x[0].length:x[1].length,a=Math.round(n*r-.5),s=Math.round(t*o-.5),l=r*s+a;l+=g?0:Math.round(x[0].length*S)*r*o;let c=h?h[l]:0;u.current=g?function(e,n){return e*(n.maxVal-n.minVal)+n.minVal}(c,v):c,m.current=g?[x[0][s],x[1][a]]:[x[1][s],x[2][a]]}},[h,d,x,S]);return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("mesh",{material:M,geometry:j,scale:[1,f?-1:1,1],onPointerEnter:()=>{a(!0),C.current=!0},onPointerLeave:()=>{a(!1),C.current=!1},onPointerMove:D})})},q=e=>{let{texture:n,ZarrDS:t}=e,{colormap:i,flipY:a,isFlat:u}=(0,l.on)((0,c.k)(e=>({colormap:e.colormap,flipY:e.flipY,isFlat:e.isFlat}))),{setPlotDim:d,updateDimCoords:p,updateTimeSeries:h}=(0,l.on)((0,c.k)(e=>({setPlotDim:e.setPlotDim,updateDimCoords:e.updateDimCoords,updateTimeSeries:e.updateTimeSeries}))),{dimArrays:v,dimNames:x,dimUnits:g}=(0,l.on)((0,c.k)(e=>({shape:e.shape,dimArrays:e.dimArrays,dimNames:e.dimNames,dimUnits:e.dimUnits}))),{animate:w,animProg:y,cOffset:S,cScale:b,selectTS:j}=(0,l.Ws)((0,c.k)(e=>({animate:e.animate,animProg:e.animProg,cOffset:e.cOffset,cScale:e.cScale,selectTS:e.selectTS}))),[C,P]=(0,s.useState)(Array(10).fill(new o.IUQ(-1,-1,-1,-1))),{height:M,width:z}=(0,s.useMemo)(()=>null==n?void 0:n.source.data,[n]),D=(0,s.useMemo)(()=>new o.WBB(1,9),[]),k=(0,s.useMemo)(()=>new o.BKk({glslVersion:o.Wdf,uniforms:{map:{value:n},selectTS:{value:j},selectBounds:{value:C},cmap:{value:i},cOffset:{value:S},cScale:{value:b},animateProg:{value:y}},vertexShader:m,fragmentShader:u?" // by Jeran Poehls\nprecision highp float;\nprecision highp sampler2D;\n\nout vec4 color;\n\nin vec3 aPosition;\n\nuniform sampler2D map;\nuniform sampler2D cmap;\n\nuniform float cOffset;\nuniform float cScale;\nuniform float animateProg;\nuniform bool selectTS;\n\n#define pi 3.141592653\n\nvec2 giveUV(vec3 position){\n    vec3 n = normalize(position);\n    float latitude = asin(n.y);\n    float longitude = atan(n.z, n.x);\n    vec2 uv = vec2(-longitude/(pi), latitude/(pi/2.0));\n    uv /= 2.;\n    uv += 0.5;\n    return uv;\n}\n\n\nvoid main(){\n    vec2 sampleCoord = giveUV(aPosition);\n    float strength = texture(map, sampleCoord).r;\n    strength = strength == 1. ? strength : (strength - 0.5)*cScale + 0.5;\n    strength = strength == 1. ? strength : min(strength+cOffset,0.99);\n    color = texture(cmap, vec2(strength, 0.5));\n    color.a = 1.;\n    // color = vec4(sampleCoord, 0., 1.0);\n\n}":" // by Jeran Poehls\nprecision highp float;\nprecision highp sampler3D;\n\nout vec4 color;\n\nin vec3 aPosition;\n\nuniform sampler3D map;\nuniform sampler2D cmap;\n\nuniform float cOffset;\nuniform float cScale;\nuniform float animateProg;\nuniform vec4[10] selectBounds; \nuniform bool selectTS;\n\n#define pi 3.141592653\n\nvec2 giveUV(vec3 position){\n    vec3 n = normalize(position);\n    float latitude = asin(n.y);\n    float longitude = atan(n.z, n.x);\n    vec2 uv = vec2(-longitude/(pi), latitude/(pi/2.0));\n    uv /= 2.;\n    uv += 0.5;\n    return uv;\n}\n\nbool isValid(vec2 sampleCoord){\n    for (int i = 0; i < 10; i++){\n        vec4 thisBound = selectBounds[i];\n        if (thisBound.x == -1.){\n            return false;\n        }\n        bool cond = (sampleCoord.x < thisBound.r || sampleCoord.x > thisBound.g || sampleCoord.y < thisBound.b ||  sampleCoord.y > thisBound.a);\n        if (!cond){\n            return true;\n        }\n    }\n    return false;\n}\n\nvoid main(){\n    vec2 sampleCoord = giveUV(aPosition);\n    float strength = texture(map, vec3(sampleCoord, animateProg)).r;\n    strength = strength == 1. ? strength : (strength - 0.5)*cScale + 0.5;\n    strength = strength == 1. ? strength : min(strength+cOffset,0.99);\n    color = texture(cmap, vec2(strength, 0.5));\n    bool cond = isValid(sampleCoord);\n    if (!cond && selectTS){\n        color.rgb *= 0.65;\n    }\n    color.a = 1.;\n    // color = vec4(sampleCoord, 0., 1.0);\n\n}",blending:o.NTi}),[n,y,i,S,b,w,C,j]);return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("mesh",{geometry:D,material:k,scale:[1,a?-1:1,1],onClick:e=>j&&function(e){let r=function(e,n,t){let r=Math.atan2(e.z,e.x),i=Math.asin(e.y),a=(r+Math.PI)/(2*Math.PI),s=(i+Math.PI/2)/Math.PI;return a=Math.round((a=1-a)*n-.5)/n,s=Math.round(s*t-.5)/t,new o.I9Y(a,s)}(e.point.normalize(),null==n?void 0:n.source.data.width,null==n?void 0:n.source.data.height),i=new o.Pq0(0,0,1);if(t){var s,l;let e=t.GetTimeSeries({uv:r,normal:i}),n=i.toArray().map((e,n)=>Math.abs(e)>0?n:null).filter(e=>null!==e);d(2-n[0]);let o=(0,f.parseUVCoords)({normal:i,uv:r}).map((e,n)=>e?v[n][Math.round(e*v[n].length)]:null),a=x.filter((e,n)=>null!==o[n]),c=g.filter((e,n)=>null!==o[n]);o=o.filter(e=>null!==e);let u="".concat(o[0],"_").concat(o[1]);h({[u]:e}),p({[u]:{first:{name:a[0],loc:null!=(s=o[0])?s:0,units:c[0]},second:{name:a[1],loc:null!=(l=o[1])?l:0,units:c[1]},plot:{units:g[2-n[0]]}}})}!function(e){let n=Math.round(e.x*z)+.5,t=a?Math.round((1-e.y)*M)-.5:Math.round(e.y*M)+.5,r=1/z,i=1/M,s=new o.IUQ(...[n/z-r/2,n/z+r/2],...[t/M-i/2,t/M+i/2]);P(e=>[s,...e].slice(0,10))}(r)}(e)})})};o.l2R.enabled=!0;let G=function(){let{initStore:e,setZMeta:n}=(0,l.on)((0,c.k)(e=>({initStore:e.initStore,setZMeta:e.setZMeta}))),{currentStore:t,setCurrentStore:o}=(0,l.SZ)((0,c.k)(e=>({currentStore:e.currentStore,setCurrentStore:e.setCurrentStore})));(0,s.useEffect)(()=>{o((0,a.Oe)(e))},[e]);let m=(0,s.useMemo)(()=>new a.Y5(t),[t]),[d,f]=(0,s.useState)({});(0,s.useEffect)(()=>{let e=!0;(0,i.tz)(t).then(n=>{e&&f(n)});let r=(0,i.Tk)(t),o=(0,i.Bi)(r);return r.then(e=>n(e)),o.then(e=>{p(e)}),()=>{e=!1}},[t]);let{setVariables:p,setPlotOn:h,timeSeries:v,variable:x,metadata:w,plotOn:y}=(0,l.on)((0,c.k)(e=>({setVariables:e.setVariables,setPlotOn:e.setPlotOn,timeSeries:e.timeSeries,variable:e.variable,metadata:e.metadata,plotOn:e.plotOn}))),[S,b]=(0,s.useState)(!1),[j,C]=(0,s.useState)(window.innerWidth);return(0,s.useEffect)(()=>{let e=()=>C(window.innerWidth);return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,s.useEffect)(()=>{"Default"===x&&h(!1)},[x]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.oU,{}),(0,r.jsx)(g.$D,{}),!y&&(0,r.jsx)(g.Fp,{}),(0,r.jsx)(g.Rh,{showLoading:S}),"Default"===x&&(0,r.jsx)(u,{}),"Default"!=x&&(0,r.jsx)(I,{ZarrDS:m,setShowLoading:b}),w&&(0,r.jsx)(g.OS,{data:w}),Object.keys(v).length>=1&&(0,r.jsx)(W,{})]})}},4435:()=>{},6720:()=>{},7619:()=>{},8968:(e,n,t)=>{Promise.resolve().then(t.bind(t,4242))}},e=>{e.O(0,[546,112,989,197,669,813,755,858,56,667,645,451,812,152,195,970,800,984,65,542,707,496,540,240,358],()=>e(e.s=8968)),_N_E=e.O()}]);