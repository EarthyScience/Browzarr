(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1143:()=>{},1794:(e,t,r)=>{Promise.resolve().then(r.bind(r,5591))},5591:(e,t,r)=>{"use strict";r.d(t,{default:()=>eh});var n=r(2207),a=r(3612),i=r(3677),o=r(9773),s=r(6198),l=r(1514),u=r(199),c=r(9501);function m(e){if("Default"===e)return console.log("Aborting?"),1;if(!e||"string"!=typeof e||""===e.trim())return 1;let t=e.match(/^(\w+)\s+since\s+(.+)$/i);if(!t)throw Error('Invalid time unit format: expected "<unit> since <date>", got "'.concat(e,'"'));let[r,n,a]=t,i=n.toLowerCase(),o={millisecond:1,milliseconds:1,second:1e3,seconds:1e3,minute:6e4,minutes:6e4,hour:36e5,hours:36e5,day:864e5,days:864e5},s=i.endsWith("s")?i.slice(0,-1):i,l=void 0!==o[i]?i:s;if(!(l in o))throw Error('Unsupported time unit: "'.concat(n,'". Supported units: ').concat(Object.keys(o).join(", ")));return o[l]}function d(e,t){if(!t)return e;if("bigint"==typeof e){let r=m(t);return new Date(Number(e)*r).toDateString()}return t.match(/(degree|degrees|deg|°)/i)?"".concat(e.toFixed(2),"\xb0"):e.toFixed(2)}function p(e){let{normal:t,uv:r}=e;switch(!0){case 1===t.z:return[null,r.y,r.x];case -1===t.z:return[null,r.y,1-r.x];case 1===t.x:return[r.x,r.y,null];case -1===t.x:return[1-r.x,r.y,null];case 1===t.y:return[1-r.y,null,r.x];default:return[0,0,0]}}function h(e){let t=1/0,r=-1/0;for(let n=0;n<e.length;n++)t=e[n]<t?e[n]:t,r=e[n]>r?e[n]:r;return[t,r]}async function f(e){if(!e)return[{text:"Default",value:"Default"}];try{let t=await e;if(!Array.isArray(t))return[{text:"Default",value:"Default"}];return[{text:"Default",value:"Default"},...t.map(e=>({text:e,value:e}))]}catch(e){return console.error("Error getting variables:",e),[{text:"Default",value:"Default"}]}}function x(e){let t=["bytes","KB","MB","GB","TB","PB"],r=e,n=0;for(;r>=1024&&n<t.length-1;)r/=1024,n++;return"".concat(r.toFixed(2)," ").concat(t[n])}function v(e){return({int8:1,uint8:1,int16:2,uint16:2,int32:4,uint32:4,int64:8,uint64:8,float32:4,float64:8,bool:1})[e]||4}function g(e){return e.reduce((e,t)=>e*t,1)}async function y(e){let t=await e,r="contents"in t.store?t.store.contents():[],n=[];for(let e of r)if(e.path&&e.path.length>1&&"array"===e.kind){let r=await s.h(t.resolve(e.path.substring(1)),{kind:"array"}),a=v(r.dtype),i=g(r.shape),o=function(e,t){return e.reduce((e,r,n)=>e*Math.ceil(r/t[n]),1)}(r.shape,r.chunks),l=g(r.chunks),u=i*a,c=l*a;n.push({name:e.path.substring(1),shape:r.shape,chunks:r.chunks,dtype:r.dtype,totalSize:u,totalSizeFormatted:x(u),chunkCount:o,chunkSize:c,chunkSizeFormatted:x(c)})}return n}let w=["longitude","lat","lon","time","depth","height","altitude","x","y","z","t","level"];async function S(e){return(await e).filter(e=>!function(e){let t=e.toLowerCase();return w.some(e=>t===e)}(e.name)).map(e=>e.name).sort((e,t)=>e.localeCompare(t))}let b={ESDC:"https://s3.bgc-jena.mpg.de:9000/esdl-esdc-v3.0.2/esdc-16d-2.5deg-46x72x1440-3.0.2.zarr",SEASFIRE:"https://s3.bgc-jena.mpg.de:9000/misc/seasfire_rechunked.zarr",ICON_ESM:"https://eerie.cloud.dkrz.de/datasets/icon-esm-er.hist-1950.v20240618.atmos.native.2d_1h_mean/kerchunk",OLCI_CHL:"https://s3.waw3-2.cloudferro.com/wekeo/egu2025/OLCI_L1_CHL_cube.zarr",LOCAL:"http://localhost:5173/GlobalForcingTiny.zarr"};class D extends Error{constructor(e,t){super(e),this.cause=t,this.name="ZarrError"}}async function C(e){try{let t=i.x(new o.A(e));return await t.then(e=>s.h(e,{kind:"group"}))}catch(t){throw new D("Failed to initialize store at ".concat(e),t)}}class j{async GetArray(e){if(this.variable=e,this.cache.has(e))return this.cache.get(e);let t=await this.groupStore,r=await s.h(t.resolve(e),{kind:"array"}),[n,a,i]=function(e){let t=v(e.dtype),r=g(e.shape);return[r*t,g(e.chunks)*t,e.chunks]}(r);if(r.is("number")||r.is("bigint")){let t,o;if(n<1e8)t=await l.Jt(r);else{let e=Math.floor(3e7/a),n=Math.ceil(i[2]/r.shape[2]),o=Math.ceil(i[1]/r.shape[1]),s=i[0]*e/(n*o);t=await l.Jt(r,[u.di(0,s),null,null])}if(t.data instanceof BigInt64Array||t.data instanceof BigUint64Array)throw Error("BigInt arrays are not supported for conversion to Float32Array.");return o=new Float32Array(t.data),this.cache.set(e,t),{data:o,shape:t.shape,dtype:r.dtype}}throw Error("Unsupported data type: Only numeric arrays are supported. Got: ".concat(r.dtype))}async GetAttributes(e){let t="".concat(e,"_meta");if(this.cache.has(t))return this.cache.get(t);let r=await this.groupStore,n=(await s.h(r.resolve(e),{kind:"array"})).attrs;this.cache.set(t,n);let a=[];for(let e of n._ARRAY_DIMENSIONS){if(!this.cache.has(e)){let t=await s.h(r.resolve(e),{kind:"array"}).then(e=>l.Jt(e)),n=await s.h(r.resolve(e),{kind:"array"}).then(e=>e.attrs);this.cache.set(e,t.data),this.cache.set("".concat(e,"_meta"),n)}a.push(e)}return this.dimNames=a,n}GetDimArrays(){let e=[],t=[];for(let r of this.dimNames)e.push(this.cache.get(r)),t.push(this.cache.get("".concat(r,"_meta")));return[e,t,this.dimNames]}async GetTimeSeries(e){let{uv:t,normal:r}=e;if(!this.cache.has(this.variable))return[0];let{data:n,shape:a,stride:i}=this.cache.get(this.variable),o=p({normal:r,uv:t}).map((e,t)=>null===e||null===a[t]?null:Math.round(e*a[t])),s=o.indexOf(null),l=i[s],u=null==o[0]?0:i[0]*o[0],c=null==o[1]?0:i[1]*o[1],m=null==o[2]?0:i[2]*o[2],d=[];for(let e=0;e<a[s];e++){let t=e*l+u+c+m;d.push(n[t])}return d}constructor(e){this.groupStore=C(e),this.variable="Default",this.cache=new c.A({maxSize:2e3}),this.dimNames=["","",""]}}var A=r(6023),M=r(4929),P=r(3861),z=r(7821),V=r(8562);let k=["magma","inferno","plasma","viridis","cividis","twilight","twilight_shifted","turbo","Blues","BrBG","BuGn","BuPu","CMRmap","GnBu","Greens","Greys","OrRd","Oranges","PRGn","PiYG","PuBu","PuBuGn","PuOr","PuRd","Purples","RdBu","RdGy","RdPu","RdYlBu","RdYlGn","Reds","Spectral","Wistia","YlGn","YlGnBu","YlOrBr","YlOrRd","afmhot","autumn","binary","bone","brg","bwr","cool","coolwarm","copper","cubehelix","flag","gist_earth","gist_gray","gist_heat","gist_ncar","gist_rainbow","gist_stern","gist_yarg","gnuplot","gnuplot2","gray","hot","hsv","jet","nipy_spectral","ocean","pink","prism","rainbow","seismic","spring","summer","terrain","winter","Accent","Dark2","Paired","Pastel1","Pastel2","Set1","Set2","Set3","tab10","tab20","tab20b","tab20c"];function F(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Spectral",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#000000",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=Array.from({length:255},(e,t)=>t/254),l=(s=o?s.reverse():s).map(e=>(0,V.md)(e,t,!1)),u=new Uint8Array((l.length+1)*4);for(let e=0;e<l.length;e++){let[t,n,a]=l[e];u[4*e]=t,u[4*e+1]=n,u[4*e+2]=a,u[4*e+3]=r}let c=function(e){let t=parseInt(e=e.replace(/^#/,""),16);return[t>>16&255,t>>8&255,255&t]}(n),m=4*l.length;if(u[m]=c[0],u[m+1]=c[1],u[m+2]=c[2],u[m+3]=i,e)return e.image.data.set(u),e.needsUpdate=!0,e;{let e=new a.GYF(u,l.length+1,1,a.GWd);return e.needsUpdate=!0,e}}let R=(0,z.v)(e=>({shape:new a.Pq0(2,2,2),valueScales:{maxVal:1,minVal:-1},colormap:F(),timeSeries:[0],showLoading:!1,metadata:null,dataArray:null,dimArrays:[[0],[0],[0]],dimNames:["Default"],dimUnits:["Default"],dimCoords:void 0,plotDim:0,flipY:!1,initStore:"https://s3.bgc-jena.mpg.de:9000/esdl-esdc-v3.0.2/esdc-16d-2.5deg-46x72x1440-3.0.2.zarr",variable:"Default",setShape:t=>e({shape:t}),setValueScales:t=>e({valueScales:t}),setColormap:t=>e({colormap:t}),setTimeSeries:t=>e({timeSeries:t}),setShowLoading:t=>e({showLoading:t}),setMetadata:t=>e({metadata:t}),setDataArray:t=>e({dataArray:t}),setDimArrays:t=>e({dimArrays:t}),setDimNames:t=>e({dimNames:t}),setDimUnits:t=>e({dimUnits:t}),setDimCoords:t=>e({dimCoords:t}),setPlotDim:t=>e({plotDim:t}),setFlipY:t=>e({flipY:t}),setInitStore:t=>e({initStore:t}),setVariable:t=>{console.log("✅ setting variable:",t),e({variable:t})}}));a.l2R.enabled=!0;var T=r(7734);let E=e=>{let{volTexture:t}=e,{shape:r,colormap:i,flipY:o}=R((0,T.k)(e=>({shape:e.shape,colormap:e.colormap,flipY:e.flipY}))),s=(0,M.aF)("plot-pane"),l=(0,P.ap)({flip:!1},{title:"Volume",container:null!=s?s:void 0,expanded:!1}),[u]=(0,P.jD)(l,{label:"Clip Values",value:0,min:0,max:1,step:.01,format:e=>e.toFixed(2)}),[c]=(0,P.jD)(l,{label:"Quality",value:200,min:50,max:1e3,step:25}),[m]=(0,P.jD)(l,{label:"xmin",value:-1,min:-1,max:1,step:.01}),[d]=(0,P.jD)(l,{label:"xmax",value:1,min:-1,max:1,step:.01}),[p]=(0,P.jD)(l,{label:"ymin",value:-1,min:-1,max:1,step:.01}),[h]=(0,P.jD)(l,{label:"ymax",value:1,min:-1,max:1,step:.01}),[f]=(0,P.jD)(l,{label:"zmin",value:-1,min:-1,max:1,step:.01}),[x]=(0,P.jD)(l,{label:"zmax",value:1,min:-1,max:1,step:.01}),[v]=(0,P.Kr)(l,"flip",{label:"Invert values",value:!1}),g=new a.BKk({glslVersion:a.Wdf,uniforms:{map:{value:t},cmap:{value:i},cameraPos:{value:new a.Pq0},threshold:{value:u},scale:{value:r},flatBounds:{value:new a.IUQ(m,d,p,h)},vertBounds:{value:new a.I9Y(f,x)},steps:{value:c},flip:{value:v}},vertexShader:" // by Jeran Poehls\r\n\r\nout vec3 vOrigin;\r\nout vec3 vDirection;\r\nvarying vec2 Vuv;\r\n\r\nvoid main() {\r\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\r\n\r\n    vOrigin = vec3( inverse( modelMatrix ) * vec4( cameraPosition, 1.0 ) ).xyz;\r\n    vDirection = position - vOrigin;\r\n    Vuv = uv;\r\n    gl_Position = projectionMatrix * mvPosition;\r\n}",fragmentShader:"// by Jeran Poehls\r\nprecision highp float;\r\nprecision highp sampler3D;\r\n\r\nuniform mat4 modelViewMatrix;\r\nuniform mat4 projectionMatrix;\r\n\r\nin vec3 vOrigin;\r\nin vec3 vDirection;\r\n\r\nout vec4 color;\r\n\r\nuniform sampler3D map;\r\nuniform sampler2D cmap;\r\n\r\nuniform vec3 scale;\r\nuniform float threshold;\r\nuniform float steps;\r\nuniform bool flip;\r\nuniform vec4 flatBounds;\r\nuniform vec2 vertBounds;\r\nuniform float intensity;\r\n\r\nvec2 hitBox(vec3 orig, vec3 dir) {\r\n    vec3 box_min = vec3(-(scale * 0.5));\r\n    vec3 box_max = vec3(scale * 0.5);\r\n    vec3 inv_dir = 1.0 / dir;\r\n    vec3 tmin_tmp = (box_min - orig) * inv_dir;\r\n    vec3 tmax_tmp = (box_max - orig) * inv_dir;\r\n    vec3 tmin = min(tmin_tmp, tmax_tmp);\r\n    vec3 tmax = max(tmin_tmp, tmax_tmp);\r\n    float t0 = max(tmin.x, max(tmin.y, tmin.z));\r\n    float t1 = min(tmax.x, min(tmax.y, tmax.z));\r\n    return vec2(t0, t1);\r\n}\r\n\r\nfloat sample1( vec3 p ) {\r\n    return texture( map, p ).r;\r\n}\r\n\r\n#define epsilon 0.0001\r\n\r\nvoid main() {\r\n    vec3 rayDir = normalize(vDirection);\r\n    vec2 bounds = hitBox(vOrigin, rayDir);\r\n\r\n    if (bounds.x > bounds.y) discard;\r\n\r\n    bounds.x = max(bounds.x, 0.0);\r\n\r\n    vec3 p = vOrigin + bounds.x * rayDir;\r\n    vec3 inc = 1.0 / abs(rayDir);\r\n    float delta = min(inc.x, min(inc.y, inc.z));\r\n    delta /= steps;\r\n\r\n    vec4 accumColor = vec4(0.0);\r\n    float alphaAcc = 0.0;\r\n    for (float t = bounds.x; t < bounds.y; t += delta) {\r\n        if (p.x > -flatBounds.x || p.x < -flatBounds.y) {\r\n            p += rayDir * delta;\r\n            continue;\r\n        }\r\n        if (-p.z > -flatBounds.z || -p.z < -flatBounds.w) {\r\n            p += rayDir * delta;\r\n            continue;\r\n        }\r\n        if (p.y < vertBounds.x || p.y > vertBounds.y) {\r\n            p += rayDir * delta;\r\n            continue;\r\n        }\r\n\r\n        float d = sample1(p / scale + 0.5);\r\n\r\n        bool cond = (d > threshold) || (d == 0.0 && threshold == 0.0);\r\n        cond = flip ? !cond : cond;\r\n\r\n        if (cond) {\r\n            vec4 col = texture(cmap, vec2(d, 0.5));\r\n            // Change this later back to use intensity then delete comment. Or maybe we don't need intensity\r\n            float alpha = float(col.a > 0.);\r\n\r\n            accumColor.rgb += (1.0 - alphaAcc) * alpha * col.rgb;\r\n            alphaAcc += alpha * (1.0 - alphaAcc);\r\n\r\n            if (alphaAcc >= 1.0) break;\r\n        }\r\n\r\n        p += rayDir * delta;\r\n    }\r\n\r\n    accumColor.a = alphaAcc; // Set the final accumulated alpha\r\n    color = accumColor;\r\n    if (color.a == 0.0) discard;\r\n}\r\n",transparent:!0,blending:a.NTi,depthWrite:!1,side:a.hsX}),y=(0,A.useMemo)(()=>new a.WBB(4,8),[]);return(0,A.useEffect)(()=>()=>{y.dispose()},[]),(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("mesh",{geometry:y,scale:[1,o?-1:1,1],children:(0,n.jsx)("primitive",{attach:"material",object:g})})})},Y=e=>{let{ZarrDS:t}=e,[r,i]=(0,A.useState)(null),{setTimeSeries:o,setPlotDim:s,setDimCoords:l}=R((0,T.k)(e=>({setTimeSeries:e.setTimeSeries,setPlotDim:e.setPlotDim,setDimCoords:e.setDimCoords}))),{shape:u,dimArrays:c,dimNames:m,dimUnits:d}=R((0,T.k)(e=>({shape:e.shape,dimArrays:e.dimArrays,dimNames:e.dimNames,dimUnits:e.dimUnits}))),h=(0,A.useMemo)(()=>new a.iNn(1,1,1),[]);return(0,A.useEffect)(()=>()=>{h.dispose()},[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("mesh",{geometry:h,scale:u,onClick:e=>{e.stopPropagation(),e.intersections.length>0&&function(e){let r=e.point,n=e.uv,a=e.normal;if(t){var u,h;t.GetTimeSeries({uv:n,normal:a}).then(e=>o(e));let e=a.toArray().map((e,t)=>Math.abs(e)>0?t:null).filter(e=>null!==e);s(2-e[0]);let r=p({normal:a,uv:n}).map((e,t)=>e?c[t][Math.round(e*c[t].length)]:null),i=m.filter((e,t)=>null!==r[t]),f=d.filter((e,t)=>null!==r[t]);r=r.filter(e=>null!==e),l({first:{name:i[0],loc:null!=(u=r[0])?u:0,units:f[0]},second:{name:i[1],loc:null!=(h=r[1])?h:0,units:f[1]},plot:{units:d[2-e[0]]}})}i(r)}(e.intersections[0])},children:(0,n.jsx)("meshBasicMaterial",{transparent:!0,opacity:0})}),r&&(0,n.jsxs)("mesh",{position:r,scale:.01,children:[(0,n.jsx)("boxGeometry",{}),(0,n.jsx)("meshBasicMaterial",{color:"#ff0000"})]})]})};var _=r(3941);function N(e){let{points:t,pointSize:r,pointColor:i,pointSetters:o}=e,s=(0,A.useRef)(null),l=t.length,[u,c]=(0,A.useState)(!1),{setPointID:m,setPointLoc:d,setShowPointInfo:p}=o,[h,f]=(0,A.useState)(1),x=(0,A.useMemo)(()=>new a.Gu$(r),[r]),v=(0,A.useMemo)(()=>new a.V9B({color:i}),[i]);return(0,A.useEffect)(()=>{if(s.current){let e=new a.B69;for(let r=0;r<l;r++){let n=t[r].toArray();e.position.set(...n),e.scale.set(1/h,1/h,1/h),e.updateMatrix(),s.current.setMatrixAt(r,e.matrix)}s.current.instanceMatrix.needsUpdate=!0}},[t,h,x,v]),(0,_.C)(e=>{let{camera:t}=e;t.zoom!==h&&f(t.zoom)}),(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("mesh",{onPointerEnter:function(e){if(s.current){let t=new a.B69,r=new a.kn4;s.current.getMatrixAt(e.instanceId,r);let n=new a.Pq0;n.setFromMatrixPosition(r),t.scale.set(3/h,3/h,3/h),t.position.copy(n),t.updateMatrix(),s.current.setMatrixAt(e.instanceId,t.matrix),s.current.instanceMatrix.needsUpdate=!0,c(e=>!e),m(e.instanceId),d([e.clientX,e.clientY]),p(!0)}},onPointerLeave:function(){if(s.current){let e=new a.B69,t=new a.kn4,r=new a.Pq0;for(let n=0;n<l;n++)s.current.getMatrixAt(n,t),r.setFromMatrixPosition(t),e.scale.set(1/h,1/h,1/h),e.position.copy(r),e.updateMatrix(),s.current.setMatrixAt(n,e.matrix);s.current.instanceMatrix.needsUpdate=!0,c(e=>!e),p(!1)}},children:(0,n.jsx)("instancedMesh",{ref:s,args:[x,v,l]})})})}let U=e=>{let{height:t,pointSetters:r,yScale:i,xScale:o}=e,[s,l]=(0,A.useState)(!1),u=(0,M.aF)("line-plot-pane"),c=(0,P.ap)({pointColor:"#777777",interpolation:"linear"},{title:"Line",container:null!=u?u:void 0,expanded:!0});(0,P.CZ)(c,{title:"".concat(s?"Hide":"Show"," Points")},()=>l(e=>!e));let[m]=(0,P.Kr)(c,"pointColor",{label:"Point Color",value:"#2d4967"}),[d]=(0,P.jD)(c,{label:"Point Size",value:5,min:1,max:20,step:1}),[p]=(0,P.Kr)(c,"interpolation",{label:"Line Interpolation",options:[{text:"Linear",value:"linear"},{text:"Curved",value:"curved"}]}),[h]=(0,P.jD)(c,{label:"Line Width",value:5,min:1,max:20,step:1}),{valueScales:f,timeSeries:x,colormap:v}=R((0,T.k)(e=>({valueScales:e.valueScales,timeSeries:e.timeSeries,colormap:e.colormap}))),{maxVal:g,minVal:y}=f,[w,S]=(0,A.useMemo)(()=>{if(!x||0===x.length)return[[new a.Pq0(0,0,0)],[0]];let e=window.innerWidth,r=window.innerHeight-t,n=function(e,t,r){let n=(t-e)/(r-1);return Array.from({length:r},(t,r)=>e+n*r)}(-e*o/2,e*o/2,x.length),s=x.map(e=>(e-y)/(g-y));return[s.map((e,t)=>new a.Pq0(n[t],(e-.5)*r*i,5)),s]},[x,p,t,i,o]),b=(0,A.useMemo)(()=>{if(!x||0===x.length)return null;if("curved"===p){let e=new a.B6O(w),t=new a.LoY().setFromPoints(e.getPoints(5*S.length-1));return t.setAttribute("normed",new a.qtW(S.flatMap(e=>[,,,,,].fill(e)),1)),t}{let e=new a.LoY().setFromPoints(w);return e.setAttribute("normed",new a.qtW(S,1)),e}},[w]),D=(0,A.useMemo)(()=>new a.BKk({glslVersion:a.Wdf,uniforms:{cmap:{value:v}},vertexShader:"\n                    varying float vNormed;\n                    attribute float normed;\n\n                    void main() {\n                        vNormed = normed;\n                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                    }\n                    ",fragmentShader:"\n                    out vec4 Color;\n                    uniform sampler2D cmap;\n                    varying float vNormed;\n\n                    void main() {\n                        vec4 texColor = texture(cmap, vec2(vNormed, 0.5));\n                        texColor.a = 2.;\n                        // Color = vec4(1.,0.0,0.,1.);\n                        Color = texColor;\n                    }\n                    ",linewidth:h,depthWrite:!1}),[h]);return x&&0!==x.length?(0,n.jsxs)("group",{children:[b&&(0,n.jsx)("primitive",{object:new a.N1A(b,D)}),s&&(0,n.jsx)(N,{points:w,pointSize:d,pointColor:m,pointSetters:r})]}):null},B=e=>{let{textures:t}=e,{texture:r,colormap:i}=t,o=(0,M.aF)("plot-cloud"),s=R(e=>e.flipY),l=(0,P.ap)({scalePoints:!1},{title:"Point cloud",container:null!=o?o:void 0,expanded:!1}),[u]=(0,P.jD)(l,{label:"Point Size",value:1,min:1,max:100,step:1}),[c]=(0,P.Kr)(l,"scalePoints",{label:"Scale Points By Value",value:!1}),[m]=(0,P.jD)(l,{label:"Scale Intensity",value:2,min:1,max:10,step:.2}),{data:d,width:p,height:h,depth:f}=(0,A.useMemo)(()=>r instanceof a.dYF?{data:r.image.data,width:r.image.width,height:r.image.height,depth:r.image.depth}:(console.warn("Provided texture is not a Data3DTexture"),{data:[],width:0,height:0,depth:0}),[r]),{positions:x,values:v}=(0,A.useMemo)(()=>{let e=[],t=[],r=p/h,n=f/h;n=n>10?10:n;for(let a=0;a<f;a++)for(let i=0;i<h;i++)for(let o=0;o<p;o++){let s=d[o+i*p+a*p*h]||0;if(s>0){let l=(o/(p-1)-.5)*r,u=i/(h-1)-.5,c=(a/(f-1)-.5)*n;e.push(2*l,2*u,2*c),t.push(s)}}return{positions:e,values:t}},[d,p,h,f]),g=(0,A.useMemo)(()=>{let e=new a.LoY;return e.setAttribute("position",new a.qtW(x,3)),e.setAttribute("value",new a.qtW(v,1)),e},[x,v]),y=new a.BKk({glslVersion:a.Wdf,uniforms:{pointSize:{value:u},cmap:{value:i},scalePoints:{value:c},scaleIntensity:{value:m}},vertexShader:"attribute float value;\r\nvarying float vValue;\r\nuniform float pointSize;\r\nuniform bool scalePoints;\r\nuniform float scaleIntensity;\r\n\r\nvoid main() {\r\n    vValue = value/255.;\r\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n    //If it is nan we just yeet it tf out of the screen space. LMAO I love this solution\r\n    float pointScale = pointSize/gl_Position.w;\r\n    pointScale = scalePoints ? pointScale*pow(vValue,scaleIntensity) : pointScale;\r\n    if (value == 255. || (pointScale < 0.75 && scalePoints)){\r\n        gl_Position = vec4(2.0, 2.0, 2.0, 1.0);\r\n    }\r\n\r\n    gl_PointSize = pointScale;\r\n}\r\n",fragmentShader:"out vec4 Color;\r\n\r\nvarying float vValue;\r\nuniform sampler2D cmap;\r\n\r\nvoid main() {\r\n\r\n    vec4 color = texture(cmap, vec2(vValue, 0.5));\r\n    color.a = 1.;\r\n\r\n    Color = color;\r\n    \r\n}\r\n",depthWrite:!0,transparent:!0,blending:a.NTi,side:a.$EB});return(0,n.jsx)("mesh",{scale:[1,s?-1:1,1],children:(0,n.jsx)("points",{geometry:g,material:y})})};var O=r(9880);function G(e){let{pointID:t,pointLoc:r,showPointInfo:a,plotUnits:i}=e,{plotDim:o,dimArrays:s,dimNames:l,dimUnits:u,timeSeries:c}=R((0,T.k)(e=>({plotDim:e.plotDim,dimArrays:e.dimArrays,dimNames:e.dimNames,dimUnits:e.dimUnits,timeSeries:e.timeSeries}))),m=c[t],p=s[o][t],[h,f]=r,[x,v]=(0,A.useState)(!1);return(0,A.useEffect)(()=>{if(!a){let e=setTimeout(()=>{v(!1)},100);return()=>clearTimeout(e)}v(!0)},[a]),(0,n.jsx)(n.Fragment,{children:x&&(0,n.jsxs)("div",{className:"point-info",style:{left:"".concat(h,"px"),top:"".concat(f,"px")},children:["".concat(m.toFixed(2)).concat(i),(0,n.jsx)("br",{}),"".concat(l[o],": ").concat(d(p,u[o]),"       \n        ")]})})}function L(){let e=R(e=>e.dimCoords),[t,r]=(0,A.useState)(!1),a=(0,A.useRef)([0,Math.round(.255*window.innerHeight)]),i=(0,A.useRef)([0,Math.round(.255*window.innerHeight)]),[o,s]=(0,A.useState)([0,Math.round(.255*window.innerHeight)]);function l(e){if(t){let t=a.current[0]-e.clientX,r=a.current[1]-e.clientY,n=Math.max(i.current[0]-t,10),o=Math.max(i.current[1]+r,0);s([Math.min(n,window.innerWidth-100),Math.min(o,window.innerHeight-100)])}}function u(){r(!1)}return(0,A.useEffect)(()=>(t&&(document.addEventListener("mousemove",l),document.addEventListener("mouseup",u)),()=>{document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",u)}),[t]),(0,n.jsx)(n.Fragment,{children:e&&"Default"!==e.first.name&&(0,n.jsxs)("div",{className:"plot-coords",style:{left:"".concat(o[0],"px"),bottom:"".concat(o[1],"px")},onPointerDown:function(e){a.current=[e.clientX,e.clientY],i.current=[...o],r(!0)},onPointerMove:l,onPointerUp:()=>r(!1),children:[(0,n.jsx)("b",{children:"".concat(e.first.name,": ")}),"".concat(d(e.first.loc,e.first.units)),(0,n.jsx)("br",{}),(0,n.jsx)("b",{children:"".concat(e.second.name,": ")}),"".concat(d(e.second.loc,e.second.units))]})})}function I(){let[e,t]=(0,A.useState)(0),[r,a]=(0,A.useState)([0,0]),[i,o]=(0,A.useState)(!1),[s,l]=(0,A.useState)(Math.round(window.innerHeight-.25*window.innerHeight)),u=R(e=>e.metadata),c=u?u.units:"Default",[m,d]=(0,A.useState)(1),[p,h]=(0,A.useState)(1);return(0,A.useEffect)(()=>{let e=()=>{let e=Math.round(window.innerHeight-.25*window.innerHeight);l(e),document.documentElement.style.setProperty("--plot-height","".concat(e,"px"))};return window.addEventListener("orientationchange",e),window.addEventListener("resize",e),()=>{window.removeEventListener("orientationchange",e),window.removeEventListener("resize",e)}},[]),(0,A.useEffect)(()=>{document.documentElement.style.setProperty("--plot-height","".concat(s,"px"))},[s]),(0,n.jsxs)("div",{className:"plot-canvas",children:[(0,n.jsx)(G,{pointID:e,pointLoc:r,showPointInfo:i,plotUnits:c}),(0,n.jsx)(M.A,{height:s,setHeight:l}),(0,n.jsx)(M.gj,{scale:m,setScale:d}),(0,n.jsx)(M.LC,{scale:p,setScale:h}),(0,n.jsxs)(O.Hl,{orthographic:!0,camera:{position:[0,0,40]},frameloop:"demand",children:[(0,n.jsx)(U,{height:s,pointSetters:{setPointID:t,setPointLoc:a,setShowPointInfo:o},yScale:m,xScale:p}),(0,n.jsx)(H,{height:s,yScale:m,xScale:p})]}),(0,n.jsx)(L,{})]})}r(1143);var X=r(130),W=r(6720);function H(e){let{colorTicks:t="grey",tickSize:r=4,fontSize:a=14,showGrid:i=!0,gridOpacity:o=.5,height:s,yScale:l=1,xScale:u=1}=e,{camera:c}=(0,_.A)(),[d,p]=(0,A.useState)({left:0,right:0,top:0,bottom:0}),{dimCoords:h,dimArrays:f,plotDim:x,valueScales:v}=R((0,T.k)(e=>({dimCoords:e.dimCoords,dimArrays:e.dimArrays,plotDim:e.plotDim,valueScales:e.valueScales}))),g=f[x],y=g.length,w=v.maxVal-v.minVal,S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],b=(0,A.useMemo)(()=>{if(g){if(g.every(e=>"bigint"==typeof e)){let e=h?m(h.plot.units):1,t=[];for(let r=0;r<g.length;r++){let n=new Date(Number(g[r])*e),a="".concat(n.getDate().toString().padStart(2,"0")," ").concat(S[n.getMonth()],"\n").concat(n.getFullYear());t.push(a)}return t}return g.map(e=>String(e))}},[g,h]),D=(0,A.useMemo)(()=>{let e=window.innerWidth,t=window.innerHeight-s;return{left:-e/2+c.position.x,right:e/2+c.position.x,top:t/2+c.position.y,bottom:-t/2+c.position.y}},[]),[C,j]=(0,A.useState)(c.zoom),M=(0,A.useMemo)(()=>{let e=1/c.zoom;return{tickSize:r*e,fontSize:a/e,labelOffset:r*e}},[c.zoom,r,a]);(0,_.C)(()=>{c.zoom!==C&&j(c.zoom);let e=window.innerWidth/c.zoom,t=(window.innerHeight-s)/c.zoom,r={left:-e/2+c.position.x,right:e/2+c.position.x,top:t/2+c.position.y,bottom:-t/2+c.position.y};JSON.stringify(d)!=JSON.stringify(r)&&p(r)});let P=(0,A.useRef)(null),z=(0,A.useRef)(null);(0,A.useEffect)(()=>(P.current&&clearTimeout(P.current),z.current&&(P.current=setTimeout(()=>{z.current&&z.current.reset()},100)),()=>{null!==P.current&&clearTimeout(P.current)}),[s]);let V=(d.top+d.bottom)/2,k=(d.left+d.right)/2;return(0,n.jsxs)("group",{children:[i&&(0,n.jsxs)(n.Fragment,{children:[Array.from({length:10},(e,r)=>{var a;if(0===r||9===r)return null;let i=+Math.round(d.left/1)+(Math.round(d.right/1)-Math.round(d.left/1))*(r/9),s=i/u/(D.right-D.left)+.5;return(0,n.jsxs)(A.Fragment,{children:[(0,n.jsx)("group",{position:[i,V,0],children:(0,n.jsxs)("line",{children:[(0,n.jsx)("bufferGeometry",{children:(0,n.jsx)("float32BufferAttribute",{attach:"attributes-position",args:[new Float32Array([0,d.top-V,0,0,d.bottom-V,0]),3]})}),(0,n.jsx)("lineDashedMaterial",{color:t,opacity:o,transparent:!0,dashSize:.5,gapSize:.5})]},"vgrid-".concat(r))}),(0,n.jsxs)("group",{position:[i,d.top,0],children:[(0,n.jsxs)("line",{children:[(0,n.jsx)("bufferGeometry",{children:(0,n.jsx)("float32BufferAttribute",{attach:"attributes-position",args:[new Float32Array([0,0,0,0,-M.tickSize,0]),3]})}),(0,n.jsx)("lineBasicMaterial",{color:t})]}),0!==r&&9!==r&&(0,n.jsx)(X.E,{position:[0,M.tickSize/4-M.labelOffset,0],fontSize:M.fontSize/C**2,color:t,anchorX:"center",anchorY:"top",children:null!=(a=null==b?void 0:b[Math.round(s*y-.5)])?a:""})]},"top-tick-".concat(r))]},"vert-group-".concat(r))}),Array.from({length:8},(e,r)=>{if(0===r||7===r)return null;let a=d.bottom+(d.top-d.bottom)*(r/7),i=a/l/(d.top-d.bottom)/C+.5;return(0,n.jsxs)(A.Fragment,{children:[(0,n.jsx)("group",{position:[k,a,0],children:(0,n.jsxs)("line",{children:[(0,n.jsx)("bufferGeometry",{children:(0,n.jsx)("float32BufferAttribute",{attach:"attributes-position",args:[new Float32Array([d.left-k,0,0,d.right-k,0,0]),3]})}),(0,n.jsx)("lineDashedMaterial",{color:t,opacity:o,transparent:!0,dashSize:0,gapSize:.5,linewidth:1})]})},"hgrid-".concat(r)),(0,n.jsxs)("group",{position:[d.right,a,0],children:[(0,n.jsxs)("line",{children:[(0,n.jsx)("bufferGeometry",{children:(0,n.jsx)("float32BufferAttribute",{attach:"attributes-position",args:[new Float32Array([0,0,0,-M.tickSize,0,0]),3]})}),(0,n.jsx)("lineBasicMaterial",{color:t})]}),0!==r&&7!==r&&(0,n.jsx)(X.E,{position:[-M.tickSize-M.labelOffset,0,0],fontSize:M.fontSize/C**2,color:t,anchorX:"right",anchorY:"middle",children:(v.minVal+i*w).toFixed(1)})]},"right-tick-".concat(r))]},"vert-group-".concat(r))})]}),(0,n.jsx)(W.N,{ref:z,enableRotate:!1,enablePan:!0,enableZoom:!0,zoomSpeed:.85,maxDistance:500,maxZoom:20,minZoom:.5})]})}let K=e=>{let{values:t,setShowLoading:r}=e,{setShape:i,setFlipY:o,setValueScales:s,setMetadata:l,setDimArrays:u,setDimNames:c,setDimUnits:m}=R((0,T.k)(e=>({setShape:e.setShape,setFlipY:e.setFlipY,setValueScales:e.setValueScales,setMetadata:e.setMetadata,setDimArrays:e.setDimArrays,setDimNames:e.setDimNames,setDimUnits:e.setDimUnits}))),d=R(e=>e.colormap),{plotType:p,ZarrDS:f,variable:x,bgcolor:v,canvasWidth:g}=t,[y,w]=(0,A.useState)(null),[S,b]=(0,A.useState)(v||"var(--background)"),[D,C]=(0,A.useState)(0);return(0,A.useEffect)(()=>{C(window.innerWidth);let e=()=>C(window.innerWidth);return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,A.useEffect)(()=>{let e=new MutationObserver(e=>{e.forEach(e=>{"data-theme"===e.attributeName&&b("var(--background)")})});return e.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>e.disconnect()},[]),(0,A.useEffect)(()=>{b(v||"var(--background)")},[v]),(0,A.useEffect)(()=>{"Default"!=x?(r(!0),f.GetArray(x).then(e=>{let[t,n]=function(e){let[t,r]=3==e.shape.length?function(e){let t=e.shape,r=Array.from(e.data),[n,i,o]=t,[s,l]=h(r),u=new Uint8Array(r.map(e=>(e-s)/(l-s)).map(e=>isNaN(e)?255:254*e)),c=new a.dYF(u,o,i,n);return c.format=a.VT0,c.minFilter=a.hxR,c.magFilter=a.hxR,c.needsUpdate=!0,[c,{maxVal:l,minVal:s}]}(e):function(e){let t=e.shape,r=Array.from(e.data),n=t[0],i=t[1],[o,s]=h(r),l=new Uint8Array(r.map(e=>(e-o)/(s-o)).map(e=>255*e)),u=new a.GYF(l,n,i,a.VT0,a.OUM);return u.needsUpdate=!0,[u,{maxVal:s,minVal:o}]}(e);return[t,r]}({data:e.data,shape:e.shape});t instanceof a.GYF||t instanceof a.dYF?w(t):(console.error("Invalid texture type returned from ArrayToTexture"),w(null)),"object"==typeof n&&"maxVal"in n&&"minVal"in n&&s(n);let o=e.shape[1]/e.shape[2]*2;i(new a.Pq0(2,o,2)),r(!1)}),f.GetAttributes(x).then(e=>{l(e);let[t,r,n]=f.GetDimArrays();u(t),t[1][1]<t[1][0]?o(!0):o(!1);let a=[];for(let e of r)a.push(e.units);c(n),m(a)})):(console.log("here?"),l(null))},[x]),(0,n.jsx)("div",{className:"main-canvas",style:{width:D-g},children:(0,n.jsxs)(O.Hl,{camera:{position:[-4.5,3,4.5],fov:50},frameloop:"demand",style:{background:S},children:["volume"==p&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(E,{volTexture:y}),(0,n.jsx)(Y,{ZarrDS:f})]}),"point-cloud"==p&&(0,n.jsx)(B,{textures:{texture:y,colormap:d}}),(0,n.jsx)(W.N,{minPolarAngle:0,maxPolarAngle:Math.PI/2,enablePan:!1,maxDistance:50})]})})};r(5901);let q=e=>{let{loc:t,show:r,info:a,plotDim:i}=e,o=R(e=>e.dimNames),s=(0,A.useMemo)(()=>o.filter((e,t)=>t!=i),[o,i]);return(0,n.jsxs)("div",{className:"analysis-info",style:{left:"".concat(t[0]+10,"px"),top:"".concat(t[1]+10,"px"),display:r?"":"none"},children:["".concat(s[0],": ").concat(a[1]),(0,n.jsx)("br",{}),"".concat(s[1],": ").concat(a[0]),(0,n.jsx)("br",{})]})};var J=r(6439);class Z{initAxis(e){let t=this.shape.filter((t,r)=>r!==e);this.GPUCompute=new J.d(t[1],t[0],this.renderer),this.targetAxis=e,this.renderTarget.texture.dispose(),this.renderTarget=this.GPUCompute.createRenderTarget(t[1],t[0],a.ghU,a.ghU,1006,1006),this.renderTarget.texture.minFilter=a.hxR,this.renderTarget.texture.magFilter=a.hxR,this.renderTarget.texture.needsUpdate=!0}performReduction(e,t){e!=this.targetAxis&&this.initAxis(e);let r=this.GPUCompute.addVariable("reduction",t,this.initTexture);return r.material.uniforms.dataArray={value:this.texture},r.material.uniforms.axisSize={value:this.shape[this.targetAxis]},r.material.uniforms.axis={value:this.targetAxis},this.GPUCompute.doRenderTarget(r.material,this.renderTarget),this.renderTarget.texture}Mean(e){return this.performReduction(e,"uniform sampler3D dataArray;\nuniform int axis;\nuniform int axisSize;\n\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / resolution.xy;\n\n    vec3 sampleCoord;\n    \n    // Initialize sampling coordinates based on reduction axis\n    if (axis == 0) {\n        // Reduce along depth (D0), uv maps to (s,t) = (D2,D1)\n        sampleCoord = vec3(uv.x, uv.y, 0.0);\n    } else if (axis == 1) {\n        // Reduce along height (D1), uv maps to (s,r) = (D2,D0)\n        sampleCoord = vec3(uv.x, 0.0, uv.y);\n    } else if (axis == 2) {\n        // Reduce along width (D2), uv maps to (t,r) = (D1,D0)\n        sampleCoord = vec3(0.0, uv.x, uv.y);\n    }\n\n    float sum = 0.0;\n    for (int m = 0; m < axisSize; m++) { \n        float coord = (float(m) + 0.5) / float(axisSize); //0.5 for center of pixel\n        // Vary the appropriate coordinate\n        if (axis == 0) {\n            sampleCoord.z = coord; // Vary r (depth)\n        } else if (axis == 1) {\n            sampleCoord.y = coord; // Vary t (height)\n        } else if (axis == 2) {\n            sampleCoord.x = coord; // Vary s (width)\n        }\n        float samp = texture(dataArray, sampleCoord).r;\n        sum += samp == 0.0 ? 0.6 : samp; // Assuming data in red channel\n    }\n    \n    float mean = sum / float(axisSize);\n    gl_FragColor = vec4(mean, 0.0, 0.0, 1.0); // Output mean in red channel\n}")}Max(e){return this.performReduction(e,"uniform sampler3D dataArray;\r\nuniform int axis;\r\nuniform int axisSize;\r\n\r\nvoid main() {\r\n    vec2 uv = gl_FragCoord.xy / resolution.xy;\r\n\r\n    vec3 sampleCoord;\r\n    \r\n    // Initialize sampling coordinates based on reduction axis\r\n    if (axis == 0) {\r\n        // Reduce along depth (D0), uv maps to (s,t) = (D2,D1)\r\n        sampleCoord = vec3(uv.x, uv.y, 0.0);\r\n    } else if (axis == 1) {\r\n        // Reduce along height (D1), uv maps to (s,r) = (D2,D0)\r\n        sampleCoord = vec3(uv.x, 0.0, uv.y);\r\n    } else if (axis == 2) {\r\n        // Reduce along width (D2), uv maps to (t,r) = (D1,D0)\r\n        sampleCoord = vec3(0.0, uv.x, uv.y);\r\n    }\r\n\r\n    float maxVal = 0.0;\r\n    for (int m = 0; m < axisSize; m++) { \r\n        float coord = (float(m) + 0.5) / float(axisSize); //0.5 for center of pixel\r\n        \r\n        // Vary the appropriate coordinate\r\n        if (axis == 0) {\r\n            sampleCoord.z = coord; // Vary r (depth)\r\n        } else if (axis == 1) {\r\n            sampleCoord.y = coord; // Vary t (height)\r\n        } else if (axis == 2) {\r\n            sampleCoord.x = coord; // Vary s (width)\r\n        }\r\n        float sampled = texture(dataArray, sampleCoord).r; // Assuming data in red channel\r\n        maxVal = sampled > maxVal ? sampled : maxVal; \r\n    }\r\n    \r\n    gl_FragColor = vec4(maxVal, 0.0, 0.0, 1.0); // Output mean in red channel\r\n}")}Min(e){return this.performReduction(e,"uniform sampler3D dataArray;\r\nuniform int axis;\r\nuniform int axisSize;\r\n\r\nvoid main() {\r\n    vec2 uv = gl_FragCoord.xy / resolution.xy;\r\n\r\n    vec3 sampleCoord;\r\n    \r\n    // Initialize sampling coordinates based on reduction axis\r\n    if (axis == 0) {\r\n        // Reduce along depth (D0), uv maps to (s,t) = (D2,D1)\r\n        sampleCoord = vec3(uv.x, uv.y, 0.0);\r\n    } else if (axis == 1) {\r\n        // Reduce along height (D1), uv maps to (s,r) = (D2,D0)\r\n        sampleCoord = vec3(uv.x, 0.0, uv.y);\r\n    } else if (axis == 2) {\r\n        // Reduce along width (D2), uv maps to (t,r) = (D1,D0)\r\n        sampleCoord = vec3(0.0, uv.x, uv.y);\r\n    }\r\n\r\n    float minVal = 1.0e15; //BigNum\r\n    for (int m = 0; m < axisSize; m++) { \r\n        float coord = (float(m) + 0.5) / float(axisSize); //0.5 for center of pixel\r\n        \r\n        // Vary the appropriate coordinate\r\n        if (axis == 0) {\r\n            sampleCoord.z = coord; // Vary r (depth)\r\n        } else if (axis == 1) {\r\n            sampleCoord.y = coord; // Vary t (height)\r\n        } else if (axis == 2) {\r\n            sampleCoord.x = coord; // Vary s (width)\r\n        }\r\n        float sampled = texture(dataArray, sampleCoord).r; // Assuming data in red channel\r\n        minVal = sampled < minVal ? sampled : minVal; \r\n    }\r\n    \r\n    gl_FragColor = vec4(minVal, 0.0, 0.0, 1.0); // Output mean in red channel\r\n}")}StDev(e){return this.performReduction(e,"uniform sampler3D dataArray;\r\nuniform int axis;\r\nuniform int axisSize;\r\n\r\nvoid main() {\r\n    vec2 uv = gl_FragCoord.xy / resolution.xy;\r\n\r\n    vec3 sampleCoord;\r\n    \r\n    // Initialize sampling coordinates based on reduction axis\r\n    if (axis == 0) {\r\n        // Reduce along depth (D0), uv maps to (s,t) = (D2,D1)\r\n        sampleCoord = vec3(uv.x, uv.y, 0.0);\r\n    } else if (axis == 1) {\r\n        // Reduce along height (D1), uv maps to (s,r) = (D2,D0)\r\n        sampleCoord = vec3(uv.x, 0.0, uv.y);\r\n    } else if (axis == 2) {\r\n        // Reduce along width (D2), uv maps to (t,r) = (D1,D0)\r\n        sampleCoord = vec3(0.0, uv.x, uv.y);\r\n    }\r\n\r\n    float sum = 0.0;\r\n    for (int m = 0; m < axisSize; m++) { \r\n        float coord = (float(m) + 0.5) / float(axisSize); //0.5 for center of pixel\r\n        \r\n        // Vary the appropriate coordinate\r\n        if (axis == 0) {\r\n            sampleCoord.z = coord; // Vary r (depth)\r\n        } else if (axis == 1) {\r\n            sampleCoord.y = coord; // Vary t (height)\r\n        } else if (axis == 2) {\r\n            sampleCoord.x = coord; // Vary s (width)\r\n        }\r\n        \r\n        sum += texture(dataArray, sampleCoord).r; // Assuming data in red channel\r\n    }\r\n    \r\n    float mean = sum / float(axisSize);\r\n\r\n\r\n    float squaredDiffSum = 0.0;\r\n\r\n    for (int m = 0; m < axisSize; m++) { \r\n        float coord = (float(m) + 0.5) / float(axisSize); //0.5 for center of pixel\r\n        \r\n        // Vary the appropriate coordinate\r\n        if (axis == 0) {\r\n            sampleCoord.z = coord; // Vary r (depth)\r\n        } else if (axis == 1) {\r\n            sampleCoord.y = coord; // Vary t (height)\r\n        } else if (axis == 2) {\r\n            sampleCoord.x = coord; // Vary s (width)\r\n        }\r\n\r\n        float diff = mean - texture(dataArray, sampleCoord).r;\r\n\r\n        squaredDiffSum += pow(diff,2.); // Assuming data in red channel\r\n    }\r\n    float stdev = sqrt(squaredDiffSum / float(axisSize));\r\n\r\n    gl_FragColor = vec4(stdev, 0.0, 0.0, 1.0); // Output mean in red channel\r\n}")}dispose(){var e;null==(e=this.texture)||e.dispose(),this.renderTarget.texture.dispose(),this.initTexture.dispose()}constructor(e,t,r){this.shape=e.shape,this.renderer=t,this.GPUCompute=new J.d(10,10,this.renderer),this.initTexture=this.GPUCompute.createTexture(),this.targetAxis=5,this.renderTarget=this.GPUCompute.createRenderTarget(10,10,a.ghU,a.ghU,1006,1006);let n=e.shape[0]*e.shape[1]*e.shape[2],i=new Uint8Array(n),{minVal:o,maxVal:s}=r;for(let t=0;t<n;t++){let r=(e.data[t]-o)/(s-o)*254;i[t]=isNaN(e.data[t])?255:r}this.texture=new a.dYF(i,this.shape[2],this.shape[1],this.shape[0]),this.texture.format=a.VT0,this.texture.minFilter=a.hxR,this.texture.magFilter=a.hxR,this.texture.needsUpdate=!0}}class Q{initAxis(e){let t=this.shape.filter((t,r)=>r!==e);this.GPUCompute=new J.d(t[1],t[0],this.renderer),this.targetAxis=e,this.renderTarget=this.GPUCompute.createRenderTarget(t[1],t[0],a.ghU,a.ghU,1006,1006),this.renderTarget.texture.format=a.VT0,this.renderTarget.texture.minFilter=a.hxR,this.renderTarget.texture.magFilter=a.hxR,this.renderTarget.texture.needsUpdate=!0}performReduction(e,t){e!==this.targetAxis&&this.initAxis(e);let r=this.GPUCompute.addVariable("reduction",t,this.initTexture);return r.material.uniforms.dataArray1={value:this.textureOne},r.material.uniforms.dataArray2={value:this.textureTwo},r.material.uniforms.axisSize={value:this.shape[this.targetAxis]},r.material.uniforms.axis={value:this.targetAxis},this.GPUCompute.doRenderTarget(r.material,this.renderTarget),this.renderTarget.texture}Correlate(e){return this.performReduction(e,"uniform sampler3D dataArray1;\r\nuniform sampler3D dataArray2;\r\nuniform int axis;\r\nuniform int axisSize;\r\n\r\n\r\n\r\nvoid main() {\r\n    vec2 uv = gl_FragCoord.xy / resolution.xy;\r\n    vec3 sampleCoord;\r\n    \r\n    if (axis == 0) {\r\n        sampleCoord = vec3(uv.x, uv.y, 0.0);\r\n    } else if (axis == 1) {\r\n        sampleCoord = vec3(uv.x, 0.0, uv.y);\r\n    } else if (axis == 2) {\r\n        sampleCoord = vec3(0.0, uv.x, uv.y);\r\n    }\r\n\r\n    float sumX = 0.0;\r\n    float sumY = 0.0;\r\n    float sumXX = 0.0;\r\n    float sumYY = 0.0;\r\n    float sumXY = 0.0;\r\n\r\n    for (int m = 0; m < axisSize; m++) {\r\n        float coord = (float(m) + 0.5) / float(axisSize);\r\n        if (axis == 0) {\r\n            sampleCoord.z = coord;\r\n        } else if (axis == 1) {\r\n            sampleCoord.y = coord;\r\n        } else if (axis == 2) {\r\n            sampleCoord.x = coord;\r\n        }\r\n        float X_i = texture(dataArray1, sampleCoord).r;\r\n        float Y_i = texture(dataArray2, sampleCoord).r;\r\n        sumX += X_i;\r\n        sumY += Y_i;\r\n        sumXX += X_i * X_i;\r\n        sumYY += Y_i * Y_i;\r\n        sumXY += X_i * Y_i;\r\n    }\r\n\r\n    float N = float(axisSize);\r\n    float meanX = sumX / N;\r\n    float meanY = sumY / N;\r\n    float varX = (sumXX / N) - (meanX * meanX);\r\n    float varY = (sumYY / N) - (meanY * meanY);\r\n    float covXY = (sumXY / N) - (meanX * meanY);\r\n    float sigmaX = sqrt(max(0.0, varX));\r\n    float sigmaY = sqrt(max(0.0, varY));\r\n    float epsilon = 1e-6;\r\n    float denominator = sigmaX * sigmaY + epsilon;\r\n    float correlation = covXY / denominator;\r\n\r\n    float newCorrelation = (correlation + 1.)/2.;\r\n\r\n    gl_FragColor = vec4(newCorrelation, 0.0, 0.0, 1.0);\r\n    \r\n}")}dispose(){var e,t;null==(e=this.textureOne)||e.dispose(),null==(t=this.textureTwo)||t.dispose(),this.renderTarget.texture.dispose(),this.initTexture.dispose()}constructor(e,t,r){let{firstArray:n,secondArray:i}=e;this.shape=n.shape,this.renderer=t,this.GPUCompute=new J.d(10,10,this.renderer),this.initTexture=this.GPUCompute.createTexture(),this.targetAxis=5,this.renderTarget=this.GPUCompute.createRenderTarget(10,10,a.ghU,a.ghU,1006,1006);let o=n.shape[0]*n.shape[1]*n.shape[2],s=new Uint8Array(o),{minVal:l,maxVal:u}=r.firstArray;for(let e=0;e<o;e++){let t=(n.data[e]-l)/(u-l)*254;s[e]=isNaN(n.data[e])?255:t}this.textureOne=new a.dYF(s,this.shape[2],this.shape[1],this.shape[0]),this.textureOne.format=a.VT0,this.textureOne.minFilter=a.hxR,this.textureOne.magFilter=a.hxR,this.textureOne.needsUpdate=!0;let c=new Uint8Array(o);l=r.secondArray.minVal,u=r.secondArray.maxVal;for(let e=0;e<o;e++){let t=(i.data[e]-l)/(u-l)*254;c[e]=isNaN(i.data[e])?255:t}this.textureTwo=new a.dYF(c,this.shape[2],this.shape[1],this.shape[0]),this.textureTwo.format=a.VT0,this.textureTwo.minFilter=a.hxR,this.textureTwo.magFilter=a.hxR,this.textureTwo.needsUpdate=!0}}let $=e=>{let{arrays:t,values:r,setters:i}=e,{setShowInfo:o,setLoc:s,setUV:l}=i,{colormap:u,flipY:c}=R((0,T.k)(e=>({colormap:e.colormap,flipY:e.flipY}))),{stateVars:m,valueScales:d}=r,{firstArray:p,secondArray:h}=t,{axis:f,operation:x,execute:v}=m,g=p.shape,[y,w]=(0,A.useState)(g.filter((e,t)=>t!==f)),{gl:S}=(0,_.A)(),b=(0,A.useRef)(!1),D=(0,A.useMemo)(()=>h?new Q({firstArray:p,secondArray:h},S,d):new Z(p,S,d.firstArray),[p,h]),[C,j]=(0,A.useState)(null),M=new a.BKk({glslVersion:a.Wdf,uniforms:{data:{value:C},cmap:{value:u}},vertexShader:" // by Jeran Poehls\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n    vUv = uv;\r\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n}",fragmentShader:"uniform sampler2D data;\r\nuniform sampler2D cmap;\r\n\r\nvarying vec2 vUv;\r\nout vec4 Color;\r\n\r\nvoid main() {\r\n    vec4 val = texture(data,vUv);\r\n    vec4 color = texture(cmap, vec2(val.x,0.5));\r\n    // vec4 color = vec4(val.r > .9);\r\n    // color.a = 1.;\r\n    color.a = val.x > 0.999 ? 0. : 1.;\r\n\r\n    Color = color;\r\n}",side:a.$EB});(0,A.useEffect)(()=>{if(p){let e;if(h&&D instanceof Q)e=D.Correlate(f);else switch(x){case"Max":e=D instanceof Z?D.Max(f):null;break;case"Min":e=D instanceof Z?D.Min(f):null;break;case"Mean":e=D instanceof Z?D.Mean(f):null;break;case"StDev":e=D instanceof Z?D.StDev(f):null;break;default:e=C}j(e),w(g.filter((e,t)=>t!==f))}},[v]);let P=(0,A.useMemo)(()=>c?-(y[0]/y[1]*2):y[0]/y[1]*2,[c,y]);(0,A.useEffect)(()=>{D&&D.dispose()},[p,h]);let z=(0,A.useRef)(null),V=(0,A.useRef)(null),k=(0,A.useCallback)(e=>{b.current&&e.uv&&(z.current=e,V.current||(V.current=setTimeout(()=>{z.current&&(s([z.current.clientX,z.current.clientY]),l([z.current.uv.x,z.current.uv.y])),V.current=null},50)))},[s,l]),F=(0,A.useMemo)(()=>new a.bdM(2,P),[P]);return(0,A.useEffect)(()=>{F.dispose()},[F]),(0,n.jsx)("mesh",{material:M,onPointerEnter:()=>{o(!0),b.current=!0},onPointerLeave:()=>{o(!1),b.current=!1},onPointerMove:k,geometry:F})};function ee(e){let{values:t,variables:r}=e,[a,i]=(0,A.useState)(null);return((0,A.useEffect)(()=>{f(r).then(i)},[r]),a)?(0,n.jsx)(et,{values:t,optionsVariables:a}):null}function et(e){let{values:t,optionsVariables:r}=e,{dimNames:a,dimArrays:i,dimUnits:o,setDimNames:s,setDimArrays:l,setDimUnits:u}=R((0,T.k)(e=>({dimNames:e.dimNames,dimArrays:e.dimArrays,dimUnits:e.dimUnits,setDimNames:e.setDimNames,setDimArrays:e.setDimArrays,setDimUnits:e.setDimUnits}))),{ZarrDS:c,canvasWidth:m}=t,d=(0,A.useRef)({}),p=R(e=>e.setFlipY),[f,x]=(0,A.useState)(100),[v,g]=(0,A.useState)(0),[y,w]=(0,A.useState)(100),[S,b]=(0,A.useState)(0),[D,C]=(0,A.useState)(null),[j,z]=(0,A.useState)(null),[V,k]=(0,A.useState)(!1),[F,E]=(0,A.useState)(!1),[Y,_]=(0,A.useState)([0,0]),[N,U]=(0,A.useState)([0,0]),[B,G]=(0,A.useState)(0),[L,I]=(0,A.useState)(0);(0,A.useMemo)(()=>a.map((e,t)=>({text:e,value:t})),[]);let X=(0,M.aF)("analysis"),H=(0,P.ap)({backgroundColor:"#292b32",operation:"Mean",firstVar:"Default",secondVar:"Default",execute:!1,axis:0,active:!1},{title:"Analysis",container:null!=X?X:void 0,expanded:!1}),[K]=(0,P.Kr)(H,"backgroundColor",{label:"bgcolor",value:"#292b32"}),[J]=(0,P.Kr)(H,"firstVar",{label:"Variable 1",options:[...r],value:"Default"}),[Z]=(0,P.Kr)(H,"secondVar",{label:"Variable 2",options:[{text:"Default",value:"Default"},...r],value:"Default"}),[Q]=(0,P.Kr)(H,"operation",{label:"Operation",options:[{text:"Mean",value:"Mean"},{text:"Min",value:"Min"},{text:"Max",value:"Max"},{text:"StDev",value:"StDev"}],value:"Mean"}),[ee]=(0,P.Kr)(H,"axis",{label:"Axis",options:[{text:"0",value:0},{text:"1",value:1},{text:"2",value:2}]});return(0,P.CZ)(H,{title:"Compute"},()=>k(e=>!e)),(0,A.useEffect)(()=>{"Default"!==J&&(c.GetArray(J).then(e=>{if(C(e),J in d.current)g(d.current[J].min),x(d.current[J].max);else{let[t,r]=h(e.data);x(r),g(t),d.current[J]={min:t,max:r}}}),c.GetAttributes(J).then(()=>{let[e,t,r]=c.GetDimArrays();l(e),s(r);let n=[];for(let e of t)n.push(e.units);u(n),e[1][1]<e[1][0]?p(!0):p(!1)})),"Default"!==Z&&c.GetArray(Z).then(e=>{if(z(e),Z in d.current)b(d.current[Z].min),w(d.current[Z].max);else{let[t,r]=h(e.data);w(r),b(t),d.current[Z]={min:t,max:r}}}),"Default"===Z&&z(null)},[J,Z]),(0,A.useEffect)(()=>{if(i){let e=setTimeout(()=>{let e=i[2].length,t=i[1].length,r=Math.round(N[0]*e-.5),n=Math.round(N[1]*t-.5);G(i[2][r]),I(i[1][n])},100);return()=>clearTimeout(e)}},[N]),(0,n.jsxs)("div",{className:"analysis-canvas",style:{width:m,background:K},children:[(0,n.jsx)(q,{loc:Y,show:F,info:[B,L],plotDim:ee}),(0,n.jsxs)(O.Hl,{camera:{position:[0,0,50],zoom:400},orthographic:!0,children:[D&&(0,n.jsx)($,{arrays:{firstArray:D,secondArray:j},values:{stateVars:{operation:Q,axis:ee,execute:V},valueScales:{firstArray:{maxVal:f,minVal:v},secondArray:{maxVal:y,minVal:S}}},setters:{setShowInfo:E,setLoc:_,setUV:U}}),(0,n.jsx)(W.N,{enablePan:!0,enableRotate:!1})]})]})}function er(e){let{variablesPromise:t,onSettingsChange:r}=e,[a,i]=(0,A.useState)(null);return((0,A.useEffect)(()=>{f(t).then(i)},[t]),a)?(0,n.jsx)(en,{optionsVariables:a,onSettingsChange:r}):null}function en(e){let{optionsVariables:t,onSettingsChange:r}=e,[n,a]=(0,A.useState)(!1),i=(0,A.useMemo)(()=>k.map(e=>({text:e,value:e})),[]),o=(0,M.aF)("data-settings-pane"),s=R(e=>e.variable),l=R(e=>e.setVariable),u=(0,P.ap)({varName:"Default",plottype:"volume",cmap:"Spectral"},{title:"Data Plots",container:null!=o?o:void 0,expanded:!1});(0,P.Kr)(u,"varName",{index:0,label:"Variable",options:t,value:s},e=>{l(e.value)}),(0,A.useEffect)(()=>{if(!t.find(e=>e.value===s)){var e;l("Default"),(null==(e=u.current)?void 0:e.instance)&&u.current.instance.refresh()}},[t,s,l,u]);let[c]=(0,P.Kr)(u,"plottype",{label:"Plot type",options:[{text:"volume",value:"volume"},{text:"point-cloud",value:"point-cloud"}],value:"volume"}),[m]=(0,P.Kr)(u,"cmap",{label:"colormap",options:i,value:"Spectral"});return(0,P.CZ)(u,{title:"Flip Colors"},()=>a(e=>!e)),(0,A.useEffect)(()=>{r({plotType:c,cmap:m,flipCmap:n})},[c,m,n,r]),null}var ea=r(7944),ei=r(2595),eo=r(8189),es=r(5619),el=r(3848);function eu(e){let{position:t=[0,0,0],metadata:r,fontSize:a=.15,maxWidth:i=2.85,textColor:o="white",backgroundColor:s="#292b32",hoverColor:l="#1e1e1e",viewHoverColor:u="gold",onViewClick:c=()=>{}}=e,m=(0,A.useRef)(null),[d,p]=(0,A.useState)(!1),[h,f]=(0,A.useState)(!1);(0,eo.o)(h);let x=R(e=>e.setVariable),v=e=>"string"==typeof e?e:Array.isArray(e)?e.join(", "):String(e),g="\nname: ".concat(r.name,"\nshape: [").concat(v(r.shape),"]\nchunks: [").concat(v(r.chunks),"]\ndtype: ").concat(r.dtype,"\ntotal size: ").concat(r.totalSizeFormatted,"\nchunk count: ").concat(r.chunkCount,"\nchunk size: ").concat(r.chunkSizeFormatted,"\n").trim(),y=a*g.split("\n").length*1.4;return(0,n.jsxs)("group",{ref:m,position:t,onPointerDown:e=>e.stopPropagation(),onClick:e=>e.stopPropagation(),onPointerOver:e=>{e.stopPropagation(),p(!0)},onPointerOut:()=>p(!1),children:[(0,n.jsxs)(es.b,{args:[i,y+.2,.01],radius:.025,smoothness:2,position:[i/2,-y/2,-.03],children:[(0,n.jsx)("meshStandardMaterial",{color:d?l:s,metalness:.7,roughness:.3}),d&&(0,n.jsx)(el.l,{scale:1,threshold:20,color:u,lineWidth:0})]}),(0,n.jsx)(X.E,{position:[.1,0,0],fontSize:a,maxWidth:i,lineHeight:1.4,color:o,anchorX:"left",anchorY:"top",children:g}),(0,n.jsxs)("group",{position:[i-.55,-1.2,-0],children:[(0,n.jsx)(es.b,{args:[.9,.35,.02],radius:.025,smoothness:1,onClick:e=>{e.stopPropagation(),c&&c(r.name),x(r.name)},onPointerOver:e=>{e.stopPropagation(),f(!0)},onPointerOut:()=>f(!1),children:(0,n.jsx)("meshStandardMaterial",{color:h?"gold":"white",metalness:0,roughness:.1})}),(0,n.jsx)(X.E,{position:[.2,.02,.011],fontSize:.16,color:"#222831",anchorX:"center",anchorY:"middle",children:"View"})]})]})}function ec(e){let{position:t,text:r,textColor:i,isActive:o,isDimmed:s,isHovered:l,setHoveredWord:u,onClick:c}=e,m=new a.Q1f,d=(0,A.useRef)(null);return(0,_.C)(()=>{if(d.current){let e=d.current.material;(null==e?void 0:e.color)&&(e.color.lerp(m.set(l?"orange":i),.5),e.opacity=s?.65:1,e.transparent=!0)}}),(0,n.jsxs)(ea.Q,{position:t,children:[!o&&(0,n.jsx)(X.E,{ref:d,onPointerOver:()=>u(r),onPointerOut:()=>u(null),onClick:c,...{fontSize:2.5,letterSpacing:-.05,lineHeight:1},children:"string"==typeof r?r:r.name}),o&&"string"!=typeof r&&(0,n.jsx)("group",{scale:[6,6,6],position:[-8,3,3],rotation:[-0,-0,0],children:(0,n.jsx)(eu,{metadata:r})})]})}function em(e){let{variables:t,radius:r=20,textColor:i}=e,[o,s]=(0,A.useState)(null),[l,u]=(0,A.useState)(null),c=(0,A.useMemo)(()=>{let e=[],n=new a.YHV,i=t.length,o=Math.PI/(i+1),s=2*Math.PI/i;for(let l=1;l<=i;l++){let i=t[l-1]||"Word".concat(l),u=new a.Pq0().setFromSpherical(n.set(r,o*l,0*s));e.push([u,i])}return e},[t,r]);return(0,A.useEffect)(()=>{let e=e=>{e.stopPropagation()};return window.addEventListener("pointerdown",e),()=>window.removeEventListener("pointerdown",e)},[]),(0,n.jsx)(n.Fragment,{children:c.map((e,t)=>{let[r,a]=e;return(0,n.jsx)(ec,{position:[r.x,r.y,r.z],text:a,textColor:i,isActive:l===a,isDimmed:null!==l&&l!==a,isHovered:o===a,setHoveredWord:s,onClick:e=>{e.stopPropagation(),u(a)}},t)})})}function ed(e){let{variablesPromise:t,fogColor:r,textColor:a}=e,[i,o]=(0,A.useState)([]);return(0,A.useEffect)(()=>{t.then(o).catch(e=>console.error("Failed to load variables",e))},[t]),(0,n.jsx)("div",{className:"canvas",children:(0,n.jsxs)(O.Hl,{dpr:[1,2],camera:{position:[0,0,100],fov:90},children:[(0,n.jsx)(W.N,{enablePan:!1,enableRotate:!0,enableZoom:!0,minAzimuthAngle:0,maxAzimuthAngle:0,minDistance:85,maxDistance:100}),(0,n.jsx)("fog",{attach:"fog",args:[r,0,150]}),(0,n.jsx)("ambientLight",{intensity:2}),(0,n.jsx)(A.Suspense,{fallback:null,children:(0,n.jsx)(em,{variables:i,radius:60,textColor:a})}),(0,n.jsx)(ei.OH,{preset:"sunset"})]})})}var ep=r(6067);a.l2R.enabled=!0;let eh=function(){let{bgcolor:e,fullmetadata:t,variables:r}=function(){let e=(0,A.useMemo)(()=>Object.entries(b).map(e=>{let[t,r]=e;return{text:t,value:r}}),[]),t=R(e=>e.setTimeSeries),r=(0,M.aF)("data-stores-pane"),n=(0,P.ap)({backgroundcolor:"#292b32",storeURL:b.ESDC,varName:"Default"},{title:"Data Stores",container:null!=r?r:void 0,expanded:!1}),[a]=(0,P.Kr)(n,"backgroundcolor",{label:"bgcolor",value:"#292b32"}),[i]=(0,P.Kr)(n,"storeURL",{label:"Store URL",options:e,value:b.SEASFIRE}),o=y(C(i)),s=S(o),l=R(e=>e.setInitStore);return(0,A.useEffect)(()=>{i&&(l(i),t([0]))},[i]),{bgcolor:a,fullmetadata:o,variables:s}}(),[a,i]=(0,A.useState)({plotType:"volume",cmap:"Spectral",flipCmap:!1}),o=R((0,T.k)(e=>e.initStore)),s=(0,A.useMemo)(()=>new j(o),[o]),l=R(e=>e.variable),u=R(e=>e.setColormap),c=R(e=>e.metadata),{colormap:m,timeSeries:d}=R((0,T.k)(e=>({colormap:e.colormap,timeSeries:e.timeSeries}))),[p,h]=(0,A.useState)(!1),f=(0,ep.default)("--foreground"),x=(0,ep.default)("--background"),[v,g]=(0,A.useState)(0);(0,A.useEffect)(()=>{g(Math.round(0*window.innerWidth))},[]),(0,A.useEffect)(()=>{u(F(m,a.cmap,1,"#000000",0,a.flipCmap))},[a.cmap,m,a.flipCmap,u]);let w={plotType:a.plotType,ZarrDS:s,variable:l,bgcolor:e,canvasWidth:v};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(er,{variablesPromise:r,onSettingsChange:i}),v<10&&(0,n.jsx)(M.kW,{onClick:()=>g(.5*window.innerWidth),canvasWidth:v}),v>10&&(0,n.jsx)(M.t2,{canvasWidth:v,setCanvasWidth:g}),(0,n.jsx)(M.Rh,{showLoading:p}),v>10&&(0,n.jsx)(ee,{values:{ZarrDS:s,canvasWidth:v},variables:r}),"Default"===l?(0,n.jsx)(ed,{variablesPromise:t,fogColor:x,textColor:f}):(0,n.jsx)(K,{values:w,setShowLoading:h}),c&&(0,n.jsx)(M.OS,{data:c}),d.length>2&&(0,n.jsx)(I,{})]})}},5901:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[578,365,230,970,667,195,912,984,269,87,411,929,80,448,358],()=>t(1794)),_N_E=e.O()}]);