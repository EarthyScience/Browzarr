(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{668:()=>{},1663:()=>{},4221:()=>{},6020:(e,t,r)=>{"use strict";r.d(t,{default:()=>G});var n=r(3044),i=r(7086),a=r(9519),o=r(5029),s=r(4088),l=r(1920),c=r(5660);r(1663);let u=e=>"string"==typeof e?e:Array.isArray(e)?e.join(", "):String(e),m=e=>{let{meta:t}=e,[r,i]=(0,s.useState)(!1),a=(0,l.on)((0,c.k)(e=>e.setVariable));return(0,n.jsxs)("div",{className:"meta-container max-w-sm md:max-w-md",style:{background:"var(--background)",border:"1px solid var(--border)",borderRadius:"8px",padding:"10px",marginBottom:"10px"},children:[(0,n.jsxs)("div",{className:"meta-info",children:[(0,n.jsx)("b",{children:"Long Name:"})," ","".concat(t.long_name),(0,n.jsx)("br",{}),(0,n.jsxs)("div",{style:{maxHeight:r?"500px":"0px",overflow:"hidden",transition:"0.3s"},children:[(0,n.jsx)("b",{children:"Shape:"})," ","[".concat(u(t.shape),"]"),(0,n.jsx)("br",{}),(0,n.jsx)("b",{children:"dType: "})," ","".concat(t.dtype),(0,n.jsx)("br",{}),(0,n.jsx)("b",{children:"Total Size: "}),"".concat(t.totalSizeFormatted),(0,n.jsx)("br",{}),(0,n.jsx)("b",{children:"Chunk Shape:"})," ","[".concat(u(t.chunks),"]"),(0,n.jsx)("br",{}),(0,n.jsx)("b",{children:"Chunk Count:"})," ","".concat(t.chunkCount),(0,n.jsx)("br",{}),(0,n.jsx)("b",{children:"Chunk Size:"})," ","".concat(t.chunkSizeFormatted)]}),(0,n.jsx)("div",{className:"meta-hidden",onClick:()=>i(e=>!e),children:r?"less ↑":"more ↓"})]}),(0,n.jsx)("button",{onClick:()=>a(t.name),children:(0,n.jsx)("b",{children:"Plot"})})]})},d=()=>{let{variables:e,zMeta:t,setVariable:r}=(0,l.on)((0,c.k)(e=>({variables:e.variables,zMeta:e.zMeta,setVariable:e.setVariable}))),[i,a]=(0,s.useState)(Math.floor(e.length/2)),[o,u]=(0,s.useState)(null),[d,h]=(0,s.useState)(82),f=(0,s.useRef)(null),p=(0,s.useRef)(0);function x(){let e=window.innerWidth;e<=480?h(42):e<=570?h(54):h(82)}return(0,s.useEffect)(()=>{let e=e=>{e.cancelable&&e.preventDefault()};return document.addEventListener("touchmove",e,{passive:!1}),()=>{document.removeEventListener("touchmove",e)}},[]),(0,s.useEffect)(()=>{if(e&&t){let r=e[i];u(t.find(e=>e.name===r))}},[i,e]),(0,s.useEffect)(()=>{let e=window.innerWidth;return e<=480?h(42):e<=570?h(54):h(82),window.addEventListener("resize",x)},[]),(0,n.jsxs)("div",{className:"scroll-container",onWheel:t=>{let r=i+(t.deltaY>0?1:-1);r>=0&&r<e.length&&a(r)},onTouchMove:t=>{let r=t.touches[0].clientY,n=f.current?f.current:r;if(f.current=r,p.current+=n-r,Math.abs(p.current)>=d){let t=i+(p.current>0?1:-1);t>=0&&t<e.length&&(a(t),p.current=0)}},onTouchEnd:()=>{f.current=null,p.current=0},children:[o&&(0,n.jsx)(m,{meta:o}),(0,n.jsx)("div",{className:"scroll-element",style:{transform:"translateY(calc(50% + ".concat(-i*d,"px))")},children:e.map((e,t)=>{let o=Math.abs(i-t);return(0,n.jsx)("div",{className:"scroll-item",style:{opacity:1-.3*o,fontWeight:i===t?"bold":"normal"},onClick:()=>a(t),onDoubleClick:()=>r(e),children:e},t)})})]})};var h=r(8041);let f=e=>{let{volTexture:t}=e,{shape:r,colormap:a,flipY:o}=(0,l.on)((0,c.k)(e=>({shape:e.shape,colormap:e.colormap,flipY:e.flipY}))),{valueRange:u,xRange:m,yRange:d,zRange:f,quality:p,animate:x,resetAnim:v,cScale:g,cOffset:y}=(0,l.Ws)((0,c.k)(e=>({valueRange:e.valueRange,xRange:e.xRange,yRange:e.yRange,zRange:e.zRange,quality:e.quality,animate:e.animate,resetAnim:e.resetAnim,cScale:e.cScale,cOffset:e.cOffset}))),[w,S]=(0,s.useState)(0),j=new i.BKk({glslVersion:i.Wdf,uniforms:{map:{value:t},cmap:{value:a},cOffset:{value:y},cScale:{value:g},cameraPos:{value:new i.Pq0},threshold:{value:new i.I9Y(u[0],u[1])},scale:{value:r},flatBounds:{value:new i.IUQ(m[0],m[1],f[0],f[1])},vertBounds:{value:new i.I9Y(d[0]/r.x,d[1]/r.x)},steps:{value:p},animateProg:{value:w}},vertexShader:" // by Jeran Poehls\r\n\r\nout vec3 vOrigin;\r\nout vec3 vDirection;\r\nvarying vec2 Vuv;\r\n\r\nvoid main() {\r\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\r\n\r\n    vOrigin = vec3( inverse( modelMatrix ) * vec4( cameraPosition, 1.0 ) ).xyz;\r\n    vDirection = position - vOrigin;\r\n    Vuv = uv;\r\n    gl_Position = projectionMatrix * mvPosition;\r\n}",fragmentShader:"// by Jeran Poehls\r\nprecision highp float;\r\nprecision highp sampler3D;\r\n\r\nin vec3 vOrigin;\r\nin vec3 vDirection;\r\n\r\nout vec4 color;\r\n\r\nuniform sampler3D map;\r\nuniform sampler2D cmap;\r\n\r\nuniform float cOffset;\r\nuniform float cScale;\r\nuniform vec3 scale;\r\nuniform vec2 threshold;\r\nuniform float steps;\r\nuniform vec4 flatBounds;\r\nuniform vec2 vertBounds;\r\nuniform float animateProg;\r\n\r\nvec2 hitBox(vec3 orig, vec3 dir) {\r\n    vec3 box_min = vec3(-(scale * 0.5));\r\n    vec3 box_max = vec3(scale * 0.5);\r\n    vec3 inv_dir = 1.0 / dir;\r\n    vec3 tmin_tmp = (box_min - orig) * inv_dir;\r\n    vec3 tmax_tmp = (box_max - orig) * inv_dir;\r\n    vec3 tmin = min(tmin_tmp, tmax_tmp);\r\n    vec3 tmax = max(tmin_tmp, tmax_tmp);\r\n    float t0 = max(tmin.x, max(tmin.y, tmin.z));\r\n    float t1 = min(tmax.x, min(tmax.y, tmax.z));\r\n    return vec2(t0, t1);\r\n}\r\n\r\nfloat sample1( vec3 p ) {\r\n    return texture( map, p ).r;\r\n}\r\n\r\n#define epsilon 0.0001\r\n\r\nvoid main() {\r\n    vec3 rayDir = normalize(vDirection);\r\n    vec2 bounds = hitBox(vOrigin, rayDir);\r\n\r\n    if (bounds.x > bounds.y) discard;\r\n\r\n    bounds.x = max(bounds.x, 0.0);\r\n\r\n    vec3 p = vOrigin + bounds.x * rayDir;\r\n    vec3 inc = 1.0 / abs(rayDir);\r\n    float delta = min(inc.x, min(inc.y, inc.z));\r\n    delta /= steps;\r\n\r\n    vec4 accumColor = vec4(0.0);\r\n    float alphaAcc = 0.0;\r\n    for (float t = bounds.x; t < bounds.y; t += delta) {\r\n        if (p.x > -flatBounds.x || p.x < -flatBounds.y) { \r\n            p += rayDir * delta;\r\n            continue;\r\n        }\r\n        if (-p.z > -flatBounds.z || -p.z < -flatBounds.w) {\r\n            p += rayDir * delta;\r\n            continue;\r\n        }\r\n        if (p.y < vertBounds.x || p.y > vertBounds.y) {\r\n            p += rayDir * delta;\r\n            continue;\r\n        }\r\n\r\n        vec3 texCoord = p / scale + 0.5;\r\n        texCoord.z = mod(texCoord.z + animateProg, 1.0001);\r\n        float d = sample1(texCoord);\r\n\r\n        bool cond = (d > threshold.x) && (d < threshold.y);\r\n        \r\n\r\n        if (cond) {\r\n            float sampLoc = d == 1. ? d : (d - 0.5)*cScale + 0.5;\r\n            sampLoc = d == 1. ? d : min(sampLoc+cOffset,0.99);\r\n            vec4 col = texture(cmap, vec2(sampLoc, 0.5));\r\n            // Change this later back to use intensity then delete comment. Or maybe we don't need intensity\r\n            float alpha = float(col.a > 0.);\r\n\r\n            accumColor.rgb += (1.0 - alphaAcc) * alpha * col.rgb;\r\n            alphaAcc += alpha * (1.0 - alphaAcc);\r\n\r\n            if (alphaAcc >= 1.0) break;\r\n        }\r\n\r\n        p += rayDir * delta;\r\n    }\r\n\r\n    accumColor.a = alphaAcc; // Set the final accumulated alpha\r\n    color = accumColor;\r\n    if (color.a == 0.0) discard;\r\n}\r\n",transparent:!0,blending:i.NTi,depthWrite:!1,side:i.hsX}),C=(0,s.useMemo)(()=>new i.WBB(4,8),[]);return(0,h.C)(()=>{x&&S((w+.001)%1)}),(0,s.useEffect)(()=>()=>{C.dispose()},[]),(0,s.useEffect)(()=>{S(0)},[v]),(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("mesh",{geometry:C,scale:[1,o?-1:1,1],children:(0,n.jsx)("primitive",{attach:"material",object:j})})})};var p=r(3924);let x=e=>{let{ZarrDS:t}=e,[r,a]=(0,s.useState)(null),{setTimeSeries:o,setPlotDim:u,setDimCoords:m}=(0,l.on)((0,c.k)(e=>({setTimeSeries:e.setTimeSeries,setPlotDim:e.setPlotDim,setDimCoords:e.setDimCoords}))),{shape:d,dimArrays:h,dimNames:f,dimUnits:x}=(0,l.on)((0,c.k)(e=>({shape:e.shape,dimArrays:e.dimArrays,dimNames:e.dimNames,dimUnits:e.dimUnits}))),v=(0,l.Ws)(e=>e.selectTS),g=(0,s.useMemo)(()=>new i.iNn(1,1,1),[]);return(0,s.useEffect)(()=>()=>{g.dispose()},[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("mesh",{geometry:g,scale:d,onClick:e=>{e.stopPropagation(),e.intersections.length>0&&v&&function(e){let r=e.point,n=e.uv,i=e.normal;if(t){var s,l;t.GetTimeSeries({uv:n,normal:i}).then(e=>o(e));let e=i.toArray().map((e,t)=>Math.abs(e)>0?t:null).filter(e=>null!==e);u(2-e[0]);let r=(0,p.jT)({normal:i,uv:n}).map((e,t)=>e?h[t][Math.round(e*h[t].length)]:null),a=f.filter((e,t)=>null!==r[t]),c=x.filter((e,t)=>null!==r[t]);r=r.filter(e=>null!==e),m({first:{name:a[0],loc:null!=(s=r[0])?s:0,units:c[0]},second:{name:a[1],loc:null!=(l=r[1])?l:0,units:c[1]},plot:{units:x[2-e[0]]}})}a(r)}(e.intersections[0])},children:(0,n.jsx)("meshBasicMaterial",{transparent:!0,opacity:0})}),r&&(0,n.jsxs)("mesh",{position:r,scale:.01,children:[(0,n.jsx)("boxGeometry",{}),(0,n.jsx)("meshBasicMaterial",{color:"#ff0000"})]})]})};var v=r(7535);let g=e=>{let{textures:t}=e,{texture:r,colormap:a}=t;(0,v.aF)("plot-cloud");let o=(0,l.on)(e=>e.flipY),{scalePoints:u,scaleIntensity:m,pointSize:d,cScale:h,cOffset:f}=(0,l.Ws)((0,c.k)(e=>({scalePoints:e.scalePoints,scaleIntensity:e.scaleIntensity,pointSize:e.pointSize,cScale:e.cScale,cOffset:e.cOffset}))),{data:p,width:x,height:g,depth:y}=(0,s.useMemo)(()=>r instanceof i.dYF?{data:r.image.data,width:r.image.width,height:r.image.height,depth:r.image.depth}:(console.warn("Provided texture is not a Data3DTexture"),{data:[],width:0,height:0,depth:0}),[r]),{positions:w,values:S}=(0,s.useMemo)(()=>{let e=[],t=[],r=x/g,n=y/g;n=n>10?10:n;for(let i=0;i<y;i++)for(let a=0;a<g;a++)for(let o=0;o<x;o++){let s=p[o+a*x+i*x*g]||0;if(s>0){let l=(o/(x-1)-.5)*r,c=a/(g-1)-.5,u=(i/(y-1)-.5)*n;e.push(2*l,2*c,2*u),t.push(s)}}return{positions:e,values:t}},[p,x,g,y]),j=(0,s.useMemo)(()=>{let e=new i.LoY;return e.setAttribute("position",new i.qtW(w,3)),e.setAttribute("value",new i.qtW(S,1)),e},[w,S]),C=new i.BKk({glslVersion:i.Wdf,uniforms:{pointSize:{value:d},cmap:{value:a},cOffset:{value:f},cScale:{value:h},scalePoints:{value:u},scaleIntensity:{value:m}},vertexShader:"attribute float value;\r\nvarying float vValue;\r\nuniform float pointSize;\r\nuniform bool scalePoints;\r\nuniform float scaleIntensity;\r\n\r\nvoid main() {\r\n    vValue = value/255.;\r\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n    //If it is nan we just yeet it tf out of the screen space. LMAO I love this solution\r\n    float pointScale = pointSize/gl_Position.w;\r\n    pointScale = scalePoints ? pointScale*pow(vValue,scaleIntensity) : pointScale;\r\n\r\n    if (value == 255. || (pointScale*gl_Position.w < 0.75 && scalePoints)){\r\n        gl_Position = vec4(2.0, 2.0, 2.0, 1.0);\r\n    }\r\n\r\n    gl_PointSize = pointScale;\r\n}\r\n",fragmentShader:"out vec4 Color;\r\n\r\nvarying float vValue;\r\nuniform sampler2D cmap;\r\nuniform float cScale;\r\nuniform float cOffset;\r\n\r\nvoid main() {\r\n\r\n    float sampLoc = vValue == 1. ? vValue : (vValue - 0.5)*cScale + 0.5;\r\n    sampLoc = vValue == 1. ? vValue : min(sampLoc+cOffset,0.99);\r\n    vec4 color = texture(cmap, vec2(sampLoc, 0.5));\r\n    color.a = 1.;\r\n\r\n    Color = color;\r\n    \r\n}\r\n",depthWrite:!0,transparent:!0,blending:i.NTi,side:i.$EB});return(0,n.jsx)("mesh",{scale:[1,o?-1:1,1],children:(0,n.jsx)("points",{geometry:j,material:C})})};var y=r(7028);r(6375);var w=r(3455);r(668);var S=r(5696);let j=s.memo(function(){let{showPoints:e,linePointSize:t,pointColor:r,setLinePointSize:i,setPointColor:a}=(0,l.Ws)((0,c.k)(e=>({showPoints:e.showPoints,linePointSize:e.linePointSize,pointColor:e.pointColor,setLinePointSize:e.setLinePointSize,setPointColor:e.setPointColor})));return e?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"w-full flex items-center",children:[(0,n.jsx)("div",{className:"w-[40%]",children:(0,n.jsx)("b",{children:"Point Size"})}),(0,n.jsx)("input",{type:"range",min:1,max:20,step:.5,value:t,onChange:e=>i(parseFloat(e.target.value))})]}),(0,n.jsxs)("div",{className:"w-full flex items-center",children:[(0,n.jsx)("div",{className:"w-[40%]",children:(0,n.jsx)("b",{children:"Point Color"})}),(0,n.jsx)("input",{type:"color",title:"Point Color",value:r,onChange:e=>a(e.target.value)})]})]}):null}),C=s.memo(function(){let{lineWidth:e,lineColor:t,useLineColor:r,lineResolution:i,setLineWidth:a,setLineColor:o,setUseLineColor:s,setLineResolution:u}=(0,l.Ws)((0,c.k)(e=>({lineWidth:e.lineWidth,lineColor:e.lineColor,useLineColor:e.useLineColor,lineResolution:e.lineResolution,setLineWidth:e.setLineWidth,setLineColor:e.setLineColor,setUseLineColor:e.setUseLineColor,setLineResolution:e.setLineResolution})));return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"w-full flex items-center",children:[(0,n.jsx)("div",{className:"w-[40%]",children:(0,n.jsx)("b",{children:"Line Width"})}),(0,n.jsx)("input",{type:"range",min:1,max:10,step:.2,value:e,onChange:e=>a(parseFloat(e.target.value))})]}),(0,n.jsxs)("div",{className:"w-full flex items-center",children:[(0,n.jsx)("div",{className:"w-[40%]",children:(0,n.jsx)("b",{children:"Line Resolution"})}),(0,n.jsx)("input",{type:"range",min:1,max:10,step:1,value:i,onChange:e=>u(parseFloat(e.target.value))})]}),(0,n.jsxs)("div",{className:"w-full flex items-center",children:[(0,n.jsx)("div",{className:"w-[40%]",children:(0,n.jsx)("b",{children:"Line Color"})}),r&&(0,n.jsx)("input",{type:"color",title:"Line Color",value:t,onChange:e=>o(e.target.value)}),(0,n.jsx)(w.$,{className:"h-8 px-2 py-1",variant:"outline",onClick:()=>s(!r),children:r?"Use Plot Color":"Use Single Color"})]})]})}),b=s.memo(function(){let{showPoints:e,setShowPoints:t}=(0,l.Ws)((0,c.k)(e=>({showPoints:e.showPoints,setShowPoints:e.setShowPoints})));return(0,n.jsx)("div",{className:"plotline-options",children:(0,n.jsxs)(S.rI,{children:[(0,n.jsx)(S.ty,{asChild:!0,children:(0,n.jsx)(w.$,{className:"cursor-pointer",variant:"outline",children:"Line Options"})}),(0,n.jsxs)(S.SQ,{className:"w-60 items-center",align:"center",children:[(0,n.jsx)(S.I,{onClick:e=>e.preventDefault(),children:(0,n.jsx)(S._2,{children:(0,n.jsx)(w.$,{variant:"outline",onClick:r=>{r.preventDefault(),t(!e)},children:e?"Hide Points":"Show Points"})})}),(0,n.jsx)(j,{}),(0,n.jsx)(S.mB,{}),(0,n.jsx)(C,{})]})]})})});function A(e){let{pointID:t,pointLoc:r,showPointInfo:i,plotUnits:a}=e,{plotDim:o,dimArrays:u,dimNames:m,dimUnits:d,timeSeries:h}=(0,l.on)((0,c.k)(e=>({plotDim:e.plotDim,dimArrays:e.dimArrays,dimNames:e.dimNames,dimUnits:e.dimUnits,timeSeries:e.timeSeries}))),f=h[t],x=u[o][t],[v,g]=r,[y,w]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{if(!i){let e=setTimeout(()=>{w(!1)},100);return()=>clearTimeout(e)}w(!0)},[i]),(0,n.jsx)(n.Fragment,{children:y&&(0,n.jsxs)("div",{className:"point-info",style:{left:"".concat(v,"px"),top:"".concat(g,"px")},children:["".concat(f.toFixed(2)).concat(a),(0,n.jsx)("br",{}),"".concat(m[o],": ").concat((0,p.SB)(x,d[o]),"       \n        ")]})})}function M(){let e=(0,l.on)(e=>e.dimCoords),[t,r]=(0,s.useState)(!1),i=(0,s.useRef)([0,Math.round(.255*window.innerHeight)]),a=(0,s.useRef)([0,Math.round(.255*window.innerHeight)]),[o,c]=(0,s.useState)([0,Math.round(.255*window.innerHeight)]);function u(e){if(t){let t=i.current[0]-e.clientX,r=i.current[1]-e.clientY,n=Math.max(a.current[0]-t,10),o=Math.max(a.current[1]+r,0);c([Math.min(n,window.innerWidth-100),Math.min(o,window.innerHeight-100)])}}function m(){r(!1)}return(0,s.useEffect)(()=>(t&&(document.addEventListener("mousemove",u),document.addEventListener("mouseup",m)),()=>{document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",m)}),[t]),(0,n.jsx)(n.Fragment,{children:e&&"Default"!==e.first.name&&(0,n.jsxs)("div",{className:"plot-coords",style:{left:"".concat(o[0],"px"),bottom:"".concat(o[1],"px")},onPointerDown:function(e){i.current=[e.clientX,e.clientY],a.current=[...o],r(!0)},onPointerMove:u,onPointerUp:()=>r(!1),children:[(0,n.jsx)("b",{children:"".concat(e.first.name,": ")}),"".concat((0,p.SB)(e.first.loc,e.first.units)),(0,n.jsx)("br",{}),(0,n.jsx)("b",{children:"".concat(e.second.name,": ")}),"".concat((0,p.SB)(e.second.loc,e.second.units))]})})}function z(){let[e,t]=(0,s.useState)(0),[r,i]=(0,s.useState)([0,0]),[a,o]=(0,s.useState)(!1),[c,u]=(0,s.useState)(Math.round(window.innerHeight-.25*window.innerHeight)),m=(0,l.on)(e=>e.metadata),d=m?m.units:"Default",[h,f]=(0,s.useState)(1),[p,x]=(0,s.useState)(1);(0,s.useEffect)(()=>{let e=()=>{let e=Math.round(window.innerHeight-.25*window.innerHeight);u(e),document.documentElement.style.setProperty("--plot-height","".concat(e,"px"))};return window.addEventListener("orientationchange",e),window.addEventListener("resize",e),()=>{window.removeEventListener("orientationchange",e),window.removeEventListener("resize",e)}},[]),(0,s.useEffect)(()=>{document.documentElement.style.setProperty("--plot-height","".concat(c,"px"))},[c]);let g=window.innerHeight-c>=10;return(0,n.jsxs)(n.Fragment,{children:[!g&&(0,n.jsx)(v.de,{onClick:()=>{u(window.innerHeight-60)}}),g&&(0,n.jsxs)("div",{className:"plot-canvas",children:[(0,n.jsx)(b,{}),(0,n.jsx)(A,{pointID:e,pointLoc:r,showPointInfo:a,plotUnits:d}),(0,n.jsx)(v.A,{height:c,setHeight:u}),(0,n.jsx)(v.gj,{scale:h,setScale:f}),(0,n.jsx)(v.LC,{scale:p,setScale:x}),(0,n.jsxs)(y.Hl,{orthographic:!0,camera:{position:[0,0,40]},frameloop:"demand",children:[(0,n.jsx)(_,{height:c,yScale:h,pointSetters:{setPointID:t,setPointLoc:i,setShowPointInfo:o},xScale:p}),(0,n.jsx)(V,{height:c,yScale:h,xScale:p})]}),(0,n.jsx)(M,{})]})]})}var D=r(1023),P=r(710);function V(e){let{colorTicks:t="grey",tickSize:r=4,fontSize:i=14,showGrid:a=!0,gridOpacity:o=.5,height:u,yScale:m=1,xScale:d=1}=e,{camera:f}=(0,h.A)(),[x,v]=(0,s.useState)({left:0,right:0,top:0,bottom:0}),{dimCoords:g,dimArrays:y,plotDim:w,valueScales:S}=(0,l.on)((0,c.k)(e=>({dimCoords:e.dimCoords,dimArrays:e.dimArrays,plotDim:e.plotDim,valueScales:e.valueScales}))),j=y[w],C=j.length,b=S.maxVal-S.minVal,A=(0,s.useMemo)(()=>{let e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(j){if(j.every(e=>"bigint"==typeof e)){let t=g?(0,p.lt)(g.plot.units):1,r=[];for(let n=0;n<j.length;n++){let i=new Date(Number(j[n])*t),a="".concat(i.getDate().toString().padStart(2,"0")," ").concat(e[i.getMonth()],"\n").concat(i.getFullYear());r.push(a)}return r}return j.map(e=>String(e))}},[j,g]),M=(0,s.useMemo)(()=>{let e=window.innerWidth,t=window.innerHeight-u;return{left:-e/2+f.position.x,right:e/2+f.position.x,top:t/2+f.position.y,bottom:-t/2+f.position.y}},[]),[z,V]=(0,s.useState)(f.zoom),T=(0,s.useMemo)(()=>{let e=1/f.zoom;return{tickSize:r*e,fontSize:i/e,labelOffset:r*e}},[f.zoom,r,i]);(0,h.C)(()=>{f.zoom!==z&&V(f.zoom);let e=window.innerWidth/f.zoom,t=(window.innerHeight-u)/f.zoom,r={left:-e/2+f.position.x,right:e/2+f.position.x,top:t/2+f.position.y,bottom:-t/2+f.position.y};JSON.stringify(x)!=JSON.stringify(r)&&v(r)});let k=(0,s.useRef)(null),R=(0,s.useRef)(null);(0,s.useEffect)(()=>(k.current&&clearTimeout(k.current),R.current&&(k.current=setTimeout(()=>{R.current&&R.current.reset()},100)),()=>{null!==k.current&&clearTimeout(k.current)}),[u]);let F=(x.top+x.bottom)/2,N=(x.left+x.right)/2;return(0,n.jsxs)("group",{children:[a&&(0,n.jsxs)(n.Fragment,{children:[Array.from({length:10},(e,r)=>{var i;if(0===r||9===r)return null;let a=+Math.round(x.left/1)+(Math.round(x.right/1)-Math.round(x.left/1))*(r/9),l=a/d/(M.right-M.left)+.5;return(0,n.jsxs)(s.Fragment,{children:[(0,n.jsx)("group",{position:[a,F,0],children:(0,n.jsxs)("line",{children:[(0,n.jsx)("bufferGeometry",{children:(0,n.jsx)("float32BufferAttribute",{attach:"attributes-position",args:[new Float32Array([0,x.top-F,0,0,x.bottom-F,0]),3]})}),(0,n.jsx)("lineDashedMaterial",{color:t,opacity:o,transparent:!0,dashSize:.5,gapSize:.5})]},"vgrid-".concat(r))}),(0,n.jsxs)("group",{position:[a,x.top,0],children:[(0,n.jsxs)("line",{children:[(0,n.jsx)("bufferGeometry",{children:(0,n.jsx)("float32BufferAttribute",{attach:"attributes-position",args:[new Float32Array([0,0,0,0,-T.tickSize,0]),3]})}),(0,n.jsx)("lineBasicMaterial",{color:t})]}),0!==r&&9!==r&&(0,n.jsx)(D.E,{position:[0,T.tickSize/4-T.labelOffset,0],fontSize:T.fontSize/z**2,color:t,anchorX:"center",anchorY:"top",children:null!=(i=null==A?void 0:A[Math.round(l*C-.5)])?i:""})]},"top-tick-".concat(r))]},"vert-group-".concat(r))}),Array.from({length:8},(e,r)=>{if(0===r||7===r)return null;let i=x.bottom+(x.top-x.bottom)*(r/7),a=i/m/(x.top-x.bottom)/z+.5;return(0,n.jsxs)(s.Fragment,{children:[(0,n.jsx)("group",{position:[N,i,0],children:(0,n.jsxs)("line",{children:[(0,n.jsx)("bufferGeometry",{children:(0,n.jsx)("float32BufferAttribute",{attach:"attributes-position",args:[new Float32Array([x.left-N,0,0,x.right-N,0,0]),3]})}),(0,n.jsx)("lineDashedMaterial",{color:t,opacity:o,transparent:!0,dashSize:0,gapSize:.5,linewidth:1})]})},"hgrid-".concat(r)),(0,n.jsxs)("group",{position:[x.right,i,0],children:[(0,n.jsxs)("line",{children:[(0,n.jsx)("bufferGeometry",{children:(0,n.jsx)("float32BufferAttribute",{attach:"attributes-position",args:[new Float32Array([0,0,0,-T.tickSize,0,0]),3]})}),(0,n.jsx)("lineBasicMaterial",{color:t})]}),0!==r&&7!==r&&(0,n.jsx)(D.E,{position:[-T.tickSize-T.labelOffset,0,0],fontSize:T.fontSize/z**2,color:t,anchorX:"right",anchorY:"middle",children:(S.minVal+a*b).toFixed(1)})]},"right-tick-".concat(r))]},"vert-group-".concat(r))})]}),(0,n.jsx)(P.N,{ref:R,enableRotate:!1,enablePan:!0,enableZoom:!0,zoomSpeed:.85,maxDistance:500,maxZoom:20,minZoom:.5})]})}var T=r(6802);r(4221);let k=e=>{let{loc:t,show:r,info:i}=e,{dimNames:a,dimUnits:o}=(0,l.on)((0,c.k)(e=>({dimNames:e.dimNames,dimUnits:e.dimUnits}))),u=(0,l.r2)(e=>e.axis),m=(0,s.useMemo)(()=>a.length<3?[a[0],a[1]]:a.filter((e,t)=>t!=u),[a,u]),d=(0,s.useMemo)(()=>a.length<3?[o[0],o[1]]:o.filter((e,t)=>t!=u),[o,u]);return(0,n.jsxs)("div",{className:"analysis-info",style:{left:"".concat(t[0]+10,"px"),top:"".concat(t[1]+10,"px"),display:r?"":"none"},children:["".concat(m[0],": ").concat(r&&(0,p.SB)(i[0],d[0])),(0,n.jsx)("br",{}),"".concat(m[1],": ").concat(r&&(0,p.SB)(i[1],d[1])),(0,n.jsx)("br",{}),"Value: ".concat(Math.round(100*i[2])/100)]})},R=e=>{let{values:t,setShowLoading:r}=e,{setShape:a,setFlipY:o,setValueScales:u,setMetadata:m,setDimArrays:d,setDimNames:h,setDimUnits:p,setPlotOn:w}=(0,l.on)((0,c.k)(e=>({setShape:e.setShape,setFlipY:e.setFlipY,setValueScales:e.setValueScales,setMetadata:e.setMetadata,setDimArrays:e.setDimArrays,setDimNames:e.setDimNames,setDimUnits:e.setDimUnits,setPlotOn:e.setPlotOn}))),{colormap:S,variable:j,isFlat:C,metadata:b,valueScales:A,setIsFlat:M,setDataArray:z}=(0,l.on)((0,c.k)(e=>({colormap:e.colormap,variable:e.variable,isFlat:e.isFlat,metadata:e.metadata,valueScales:e.valueScales,setIsFlat:e.setIsFlat,setDataArray:e.setDataArray}))),{ZarrDS:D,canvasWidth:V}=t,R=(0,l.Ws)(e=>e.plotType),[F,N]=(0,s.useState)(!1),[L,Y]=(0,s.useState)([0,0]),O=(0,s.useRef)([0,0]),E=(0,s.useRef)(0),[U,W]=(0,s.useState)(!1),[_,X]=(0,s.useState)([0,0]),[G,I]=(0,s.useState)(null),[H,q]=(0,s.useState)(!0),[Z,J]=(0,s.useState)(0);(0,s.useEffect)(()=>{J(window.innerWidth);let e=()=>J(window.innerWidth);return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,s.useEffect)(()=>{let e=new MutationObserver(e=>{e.forEach(e=>{e.attributeName})});return e.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>e.disconnect()},[]),(0,s.useEffect)(()=>{"Default"!=j?(r(!0),q(!1),D.GetArray(j).then(e=>{let[t,n]=(0,T.oW)({data:e.data,shape:e.shape});t instanceof i.GYF||t instanceof i.dYF?I(t):(console.error("Invalid texture type returned from ArrayToTexture"),I(null)),"object"==typeof n&&"maxVal"in n&&"minVal"in n&&u(n),2==e.shape.length?(M(!0),z(e.data)):M(!1);let o=e.shape[1]/e.shape[2]*2;a(new i.Pq0(2,o,2)),r(!1),q(!0),w(!0)}),D.GetAttributes(j).then(e=>{m(e);let[t,r,n]=D.GetDimArrays();d(t),h(n),t.length>2?t[1][1]<t[1][0]?o(!0):o(!1):t[0][1]<t[0][0]?o(!0):o(!1);let i=[];for(let e of r)i.push(e.units);p(i)})):m(null)},[j]);let $=(0,s.useMemo)(()=>({setLoc:X,setShowInfo:W,coords:O,val:E}),[]),K=(0,s.useMemo)(()=>v.Fp,[]);return(0,n.jsxs)("div",{className:"main-canvas",style:{width:Z-V},onContextMenu:function(e){C||(Y([e.pageX,e.pageY]),N(!0))},children:[H&&(0,n.jsx)(v.PL,{units:null==b?void 0:b.units,valueScales:A}),F&&(0,n.jsx)(v.zs,{loc:L}),(0,n.jsx)(K,{}),C&&(0,n.jsx)(k,{loc:_,show:U,info:[...O.current,E.current]}),!C&&(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(y.Hl,{camera:{position:C?[0,0,5]:[-4.5,3,4.5],fov:50},frameloop:"demand",children:["volume"==R&&H&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f,{volTexture:G}),(0,n.jsx)(x,{ZarrDS:D})]}),"point-cloud"==R&&H&&(0,n.jsx)(g,{textures:{texture:G,colormap:S}}),(0,n.jsx)(P.N,{minPolarAngle:0,maxPolarAngle:Math.PI/2,enablePan:!1,maxDistance:50})]})}),C&&(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(y.Hl,{camera:{position:[0,0,5],zoom:1e3},frameloop:"demand",orthographic:!0,children:[(0,n.jsx)(B,{texture:G,infoSetters:$}),(0,n.jsx)(P.N,{enableRotate:!1,enablePan:!0,maxDistance:50,minZoom:50,maxZoom:3e3})]})})]})};var F=r(2088);let N=" // by Jeran Poehls\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n    vUv = uv;\r\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n}",L="uniform sampler2D data;\r\nuniform sampler2D cmap;\r\n\r\nuniform float cOffset;\r\nuniform float cScale;\r\n\r\nvarying vec2 vUv;\r\nout vec4 Color;\r\n\r\nvoid main() {\r\n    vec4 val = texture(data,vUv);\r\n    float d = val.x;\r\n    float sampLoc = d == 1. ? d : (d - 0.5)*cScale + 0.5;\r\n    sampLoc = d == 1. ? d : min(sampLoc+cOffset,0.99);\r\n    vec4 color = texture(cmap, vec2(sampLoc,0.5));\r\n    color.a = val.x > 0.999 ? 0. : 1.;\r\n\r\n    Color = color;\r\n}";class Y{initAxis(e){let t=this.shape.filter((t,r)=>r!==e);this.GPUCompute=new F.d(t[1],t[0],this.renderer),this.targetAxis=e,this.renderTarget.texture.dispose(),this.renderTarget=this.GPUCompute.createRenderTarget(t[1],t[0],i.ghU,i.ghU,1006,1006),this.renderTarget.texture.format=i.VT0,this.renderTarget.texture.minFilter=i.hxR,this.renderTarget.texture.magFilter=i.hxR,this.renderTarget.texture.needsUpdate=!0}performReduction(e,t){e!=this.targetAxis&&this.initAxis(e);let r=this.GPUCompute.addVariable("reduction",t,this.initTexture);r.material.uniforms.dataArray={value:this.texture},r.material.uniforms.axisSize={value:this.shape[this.targetAxis]},r.material.uniforms.axis={value:this.targetAxis},this.GPUCompute.doRenderTarget(r.material,this.renderTarget);let n=new Float32Array(this.renderTarget.width*this.renderTarget.height);return this.renderer.readRenderTargetPixels(this.renderTarget,0,0,this.renderTarget.width,this.renderTarget.height,n),[this.renderTarget.texture,n]}Mean(e){return this.performReduction(e,"uniform sampler3D dataArray;\nuniform int axis;\nuniform int axisSize;\n\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / resolution.xy;\n\n    vec3 sampleCoord;\n    \n    // Initialize sampling coordinates based on reduction axis\n    if (axis == 0) {\n        // Reduce along depth (D0), uv maps to (s,t) = (D2,D1)\n        sampleCoord = vec3(uv.x, uv.y, 0.0);\n    } else if (axis == 1) {\n        // Reduce along height (D1), uv maps to (s,r) = (D2,D0)\n        sampleCoord = vec3(uv.x, 0.0, uv.y);\n    } else if (axis == 2) {\n        // Reduce along width (D2), uv maps to (t,r) = (D1,D0)\n        sampleCoord = vec3(0.0, uv.x, uv.y);\n    }\n\n    float sum = 0.0;\n    for (int m = 0; m < axisSize; m++) { \n        float coord = (float(m) + 0.5) / float(axisSize); //0.5 for center of pixel\n        // Vary the appropriate coordinate\n        if (axis == 0) {\n            sampleCoord.z = coord; // Vary r (depth)\n        } else if (axis == 1) {\n            sampleCoord.y = coord; // Vary t (height)\n        } else if (axis == 2) {\n            sampleCoord.x = coord; // Vary s (width)\n        }\n        float samp = texture(dataArray, sampleCoord).r;\n        sum += samp == 0.0 ? 0.6 : samp; // Assuming data in red channel\n    }\n    \n    float mean = sum / float(axisSize);\n    gl_FragColor = vec4(mean, 0.0, 0.0, 1.0); // Output mean in red channel\n}")}Max(e){return this.performReduction(e,"uniform sampler3D dataArray;\r\nuniform int axis;\r\nuniform int axisSize;\r\n\r\nvoid main() {\r\n    vec2 uv = gl_FragCoord.xy / resolution.xy;\r\n\r\n    vec3 sampleCoord;\r\n    \r\n    // Initialize sampling coordinates based on reduction axis\r\n    if (axis == 0) {\r\n        // Reduce along depth (D0), uv maps to (s,t) = (D2,D1)\r\n        sampleCoord = vec3(uv.x, uv.y, 0.0);\r\n    } else if (axis == 1) {\r\n        // Reduce along height (D1), uv maps to (s,r) = (D2,D0)\r\n        sampleCoord = vec3(uv.x, 0.0, uv.y);\r\n    } else if (axis == 2) {\r\n        // Reduce along width (D2), uv maps to (t,r) = (D1,D0)\r\n        sampleCoord = vec3(0.0, uv.x, uv.y);\r\n    }\r\n\r\n    float maxVal = 0.0;\r\n    for (int m = 0; m < axisSize; m++) { \r\n        float coord = (float(m) + 0.5) / float(axisSize); //0.5 for center of pixel\r\n        \r\n        // Vary the appropriate coordinate\r\n        if (axis == 0) {\r\n            sampleCoord.z = coord; // Vary r (depth)\r\n        } else if (axis == 1) {\r\n            sampleCoord.y = coord; // Vary t (height)\r\n        } else if (axis == 2) {\r\n            sampleCoord.x = coord; // Vary s (width)\r\n        }\r\n        float sampled = texture(dataArray, sampleCoord).r; // Assuming data in red channel\r\n        maxVal = sampled > maxVal ? sampled : maxVal; \r\n    }\r\n    \r\n    gl_FragColor = vec4(maxVal, 0.0, 0.0, 1.0); // Output mean in red channel\r\n}")}Min(e){return this.performReduction(e,"uniform sampler3D dataArray;\r\nuniform int axis;\r\nuniform int axisSize;\r\n\r\nvoid main() {\r\n    vec2 uv = gl_FragCoord.xy / resolution.xy;\r\n\r\n    vec3 sampleCoord;\r\n    \r\n    // Initialize sampling coordinates based on reduction axis\r\n    if (axis == 0) {\r\n        // Reduce along depth (D0), uv maps to (s,t) = (D2,D1)\r\n        sampleCoord = vec3(uv.x, uv.y, 0.0);\r\n    } else if (axis == 1) {\r\n        // Reduce along height (D1), uv maps to (s,r) = (D2,D0)\r\n        sampleCoord = vec3(uv.x, 0.0, uv.y);\r\n    } else if (axis == 2) {\r\n        // Reduce along width (D2), uv maps to (t,r) = (D1,D0)\r\n        sampleCoord = vec3(0.0, uv.x, uv.y);\r\n    }\r\n\r\n    float minVal = 1.0e15; //BigNum\r\n    for (int m = 0; m < axisSize; m++) { \r\n        float coord = (float(m) + 0.5) / float(axisSize); //0.5 for center of pixel\r\n        \r\n        // Vary the appropriate coordinate\r\n        if (axis == 0) {\r\n            sampleCoord.z = coord; // Vary r (depth)\r\n        } else if (axis == 1) {\r\n            sampleCoord.y = coord; // Vary t (height)\r\n        } else if (axis == 2) {\r\n            sampleCoord.x = coord; // Vary s (width)\r\n        }\r\n        float sampled = texture(dataArray, sampleCoord).r; // Assuming data in red channel\r\n        minVal = sampled < minVal ? sampled : minVal; \r\n    }\r\n    \r\n    gl_FragColor = vec4(minVal, 0.0, 0.0, 1.0); // Output mean in red channel\r\n}")}StDev(e){return this.performReduction(e,"uniform sampler3D dataArray;\r\nuniform int axis;\r\nuniform int axisSize;\r\n\r\nvoid main() {\r\n    vec2 uv = gl_FragCoord.xy / resolution.xy;\r\n\r\n    vec3 sampleCoord;\r\n    \r\n    // Initialize sampling coordinates based on reduction axis\r\n    if (axis == 0) {\r\n        // Reduce along depth (D0), uv maps to (s,t) = (D2,D1)\r\n        sampleCoord = vec3(uv.x, uv.y, 0.0);\r\n    } else if (axis == 1) {\r\n        // Reduce along height (D1), uv maps to (s,r) = (D2,D0)\r\n        sampleCoord = vec3(uv.x, 0.0, uv.y);\r\n    } else if (axis == 2) {\r\n        // Reduce along width (D2), uv maps to (t,r) = (D1,D0)\r\n        sampleCoord = vec3(0.0, uv.x, uv.y);\r\n    }\r\n\r\n    float sum = 0.0;\r\n    for (int m = 0; m < axisSize; m++) { \r\n        float coord = (float(m) + 0.5) / float(axisSize); //0.5 for center of pixel\r\n        \r\n        // Vary the appropriate coordinate\r\n        if (axis == 0) {\r\n            sampleCoord.z = coord; // Vary r (depth)\r\n        } else if (axis == 1) {\r\n            sampleCoord.y = coord; // Vary t (height)\r\n        } else if (axis == 2) {\r\n            sampleCoord.x = coord; // Vary s (width)\r\n        }\r\n        \r\n        sum += texture(dataArray, sampleCoord).r; // Assuming data in red channel\r\n    }\r\n    \r\n    float mean = sum / float(axisSize);\r\n\r\n\r\n    float squaredDiffSum = 0.0;\r\n\r\n    for (int m = 0; m < axisSize; m++) { \r\n        float coord = (float(m) + 0.5) / float(axisSize); //0.5 for center of pixel\r\n        \r\n        // Vary the appropriate coordinate\r\n        if (axis == 0) {\r\n            sampleCoord.z = coord; // Vary r (depth)\r\n        } else if (axis == 1) {\r\n            sampleCoord.y = coord; // Vary t (height)\r\n        } else if (axis == 2) {\r\n            sampleCoord.x = coord; // Vary s (width)\r\n        }\r\n\r\n        float diff = mean - texture(dataArray, sampleCoord).r;\r\n\r\n        squaredDiffSum += pow(diff,2.); // Assuming data in red channel\r\n    }\r\n    float stdev = sqrt(squaredDiffSum / float(axisSize));\r\n\r\n    gl_FragColor = vec4(stdev, 0.0, 0.0, 1.0); // Output mean in red channel\r\n}")}dispose(){var e;null==(e=this.texture)||e.dispose(),this.renderTarget.texture.dispose(),this.initTexture.dispose()}constructor(e,t,r){this.shape=e.shape,this.renderer=t,this.GPUCompute=new F.d(10,10,this.renderer),this.initTexture=this.GPUCompute.createTexture(),this.targetAxis=5,this.renderTarget=this.GPUCompute.createRenderTarget(10,10,i.ghU,i.ghU,1006,1006);let n=e.shape[0]*e.shape[1]*e.shape[2],a=new Uint8Array(n),{minVal:o,maxVal:s}=r;for(let t=0;t<n;t++){let r=(e.data[t]-o)/(s-o)*254;a[t]=isNaN(e.data[t])?255:r}this.texture=new i.dYF(a,this.shape[2],this.shape[1],this.shape[0]),this.texture.format=i.VT0,this.texture.minFilter=i.hxR,this.texture.magFilter=i.hxR,this.texture.needsUpdate=!0}}class O{initAxis(e){let t=this.shape.filter((t,r)=>r!==e);this.GPUCompute=new F.d(t[1],t[0],this.renderer),this.targetAxis=e,this.renderTarget=this.GPUCompute.createRenderTarget(t[1],t[0],i.ghU,i.ghU,1006,1006),this.renderTarget.texture.format=i.VT0,this.renderTarget.texture.minFilter=i.hxR,this.renderTarget.texture.magFilter=i.hxR,this.renderTarget.texture.needsUpdate=!0}performReduction(e,t){e!==this.targetAxis&&this.initAxis(e);let r=this.GPUCompute.addVariable("reduction",t,this.initTexture);r.material.uniforms.dataArray1={value:this.textureOne},r.material.uniforms.dataArray2={value:this.textureTwo},r.material.uniforms.axisSize={value:this.shape[this.targetAxis]},r.material.uniforms.axis={value:this.targetAxis},this.GPUCompute.doRenderTarget(r.material,this.renderTarget);let n=new Float32Array(this.renderTarget.width*this.renderTarget.height*4);return this.renderer.readRenderTargetPixels(this.renderTarget,0,0,this.renderTarget.width,this.renderTarget.height,n),[this.renderTarget.texture,n]}Correlate(e){return this.performReduction(e,"uniform sampler3D dataArray1;\r\nuniform sampler3D dataArray2;\r\nuniform int axis;\r\nuniform int axisSize;\r\n\r\n\r\n\r\nvoid main() {\r\n    vec2 uv = gl_FragCoord.xy / resolution.xy;\r\n    vec3 sampleCoord;\r\n    \r\n    if (axis == 0) {\r\n        sampleCoord = vec3(uv.x, uv.y, 0.0);\r\n    } else if (axis == 1) {\r\n        sampleCoord = vec3(uv.x, 0.0, uv.y);\r\n    } else if (axis == 2) {\r\n        sampleCoord = vec3(0.0, uv.x, uv.y);\r\n    }\r\n\r\n    float sumX = 0.0;\r\n    float sumY = 0.0;\r\n    float sumXX = 0.0;\r\n    float sumYY = 0.0;\r\n    float sumXY = 0.0;\r\n\r\n    for (int m = 0; m < axisSize; m++) {\r\n        float coord = (float(m) + 0.5) / float(axisSize);\r\n        if (axis == 0) {\r\n            sampleCoord.z = coord;\r\n        } else if (axis == 1) {\r\n            sampleCoord.y = coord;\r\n        } else if (axis == 2) {\r\n            sampleCoord.x = coord;\r\n        }\r\n        float X_i = texture(dataArray1, sampleCoord).r;\r\n        float Y_i = texture(dataArray2, sampleCoord).r;\r\n        sumX += X_i;\r\n        sumY += Y_i;\r\n        sumXX += X_i * X_i;\r\n        sumYY += Y_i * Y_i;\r\n        sumXY += X_i * Y_i;\r\n    }\r\n\r\n    float N = float(axisSize);\r\n    float meanX = sumX / N;\r\n    float meanY = sumY / N;\r\n    float varX = (sumXX / N) - (meanX * meanX);\r\n    float varY = (sumYY / N) - (meanY * meanY);\r\n    float covXY = (sumXY / N) - (meanX * meanY);\r\n    float sigmaX = sqrt(max(0.0, varX));\r\n    float sigmaY = sqrt(max(0.0, varY));\r\n    float epsilon = 1e-6;\r\n    float denominator = sigmaX * sigmaY + epsilon;\r\n    float correlation = covXY / denominator;\r\n\r\n    float newCorrelation = (correlation + 1.)/2.;\r\n\r\n    gl_FragColor = vec4(newCorrelation, 0.0, 0.0, 1.0);\r\n    \r\n}")}dispose(){var e,t;null==(e=this.textureOne)||e.dispose(),null==(t=this.textureTwo)||t.dispose(),this.renderTarget.texture.dispose(),this.initTexture.dispose()}constructor(e,t,r){let{firstArray:n,secondArray:a}=e;this.shape=n.shape,this.renderer=t,this.GPUCompute=new F.d(10,10,this.renderer),this.initTexture=this.GPUCompute.createTexture(),this.targetAxis=5,this.renderTarget=this.GPUCompute.createRenderTarget(10,10,i.ghU,i.ghU,1006,1006);let o=n.shape[0]*n.shape[1]*n.shape[2],s=new Uint8Array(o),{minVal:l,maxVal:c}=r.firstArray;for(let e=0;e<o;e++){let t=(n.data[e]-l)/(c-l)*254;s[e]=isNaN(n.data[e])?255:t}this.textureOne=new i.dYF(s,this.shape[2],this.shape[1],this.shape[0]),this.textureOne.format=i.VT0,this.textureOne.minFilter=i.hxR,this.textureOne.magFilter=i.hxR,this.textureOne.needsUpdate=!0;let u=new Uint8Array(o);l=r.secondArray.minVal,c=r.secondArray.maxVal;for(let e=0;e<o;e++){let t=(a.data[e]-l)/(c-l)*254;u[e]=isNaN(a.data[e])?255:t}this.textureTwo=new i.dYF(u,this.shape[2],this.shape[1],this.shape[0]),this.textureTwo.format=i.VT0,this.textureTwo.minFilter=i.hxR,this.textureTwo.magFilter=i.hxR,this.textureTwo.needsUpdate=!0}}let E=e=>{let{arrays:t,values:r,setters:a}=e,{setShowInfo:o,setLoc:u,uv:m,setVal:d}=a,{colormap:f,flipY:p}=(0,l.on)((0,c.k)(e=>({colormap:e.colormap,flipY:e.flipY}))),{stateVars:x,valueScales:v}=r,{firstArray:g,secondArray:y}=t,{axis:w,operation:S,execute:j}=x,C=g.shape,[b,A]=(0,s.useState)(C.filter((e,t)=>t!==w)),{gl:M}=(0,h.A)(),z=(0,s.useRef)(!1),D=(0,s.useRef)(new Float32Array(0)),{cScale:P,cOffset:V}=(0,l.Ws)((0,c.k)(e=>({cScale:e.cScale,cOffset:e.cOffset}))),T=(0,s.useMemo)(()=>y?new O({firstArray:g,secondArray:y},M,v):new Y(g,M,v.firstArray),[g,y]),[k,R]=(0,s.useState)(null),F=new i.BKk({glslVersion:i.Wdf,uniforms:{cScale:{value:P},cOffset:{value:V},data:{value:k},cmap:{value:f}},vertexShader:N,fragmentShader:L,side:i.$EB});(0,s.useEffect)(()=>{if(g){let e=null;if(y&&T instanceof O)[e,D.current]=T.Correlate(w);else switch(S){case"Max":[e,D.current]=T instanceof Y?T.Max(w):[null,D.current];break;case"Min":[e,D.current]=T instanceof Y?T.Min(w):[null,D.current];break;case"Mean":[e,D.current]=T instanceof Y?T.Mean(w):[null,D.current];break;case"StDev":[e,D.current]=T instanceof Y?T.StDev(w):[null,D.current];break;default:e=k}R(e),A(C.filter((e,t)=>t!==w))}},[j,w,y,g,S]);let E=(0,s.useMemo)(()=>p?-(b[0]/b[1]*2):b[0]/b[1]*2,[p,b]);(0,s.useEffect)(()=>{T&&T.dispose()},[g,y]);let U=(0,s.useRef)(null),W=(0,s.useCallback)(e=>{if(z.current&&e.uv){U.current=e,u([e.clientX,e.clientY]);let{x:t,y:r}=e.uv;m.current=[t,r];let n=Math.round(b[0]*r-.5),i=Math.round(b[1]*t-.5),a=b[1]*n+i,o=D.current[a];y||"StDev"===S?d(o):d(function(e,t){return e*(t.maxVal-t.minVal)+t.minVal}(o,v.firstArray))}},[g,y,w,S]),_=(0,s.useMemo)(()=>new i.bdM(2,E),[E]);return(0,s.useEffect)(()=>{_.dispose()},[_]),(0,n.jsx)("mesh",{material:F,onPointerEnter:()=>{o(!0),z.current=!0},onPointerLeave:()=>{o(!1),z.current=!1},onPointerMove:W,geometry:_,rotation:[0,0,2==w?Math.PI/2:0]})};function U(e){let{values:t}=e,{dimNames:r,dimArrays:i,dimUnits:a,variables:o,setDimNames:u,setDimArrays:m,setDimUnits:d}=(0,l.on)((0,c.k)(e=>({dimNames:e.dimNames,dimArrays:e.dimArrays,dimUnits:e.dimUnits,variables:e.variables,setDimNames:e.setDimNames,setDimArrays:e.setDimArrays,setDimUnits:e.setDimUnits}))),{axis:h,operation:f,variable1:x,variable2:g,execute:w}=(0,l.r2)((0,c.k)(e=>({axis:e.axis,operation:e.operation,variable1:e.variable1,variable2:e.variable2,execute:e.execute}))),{ZarrDS:S,canvasWidth:j}=t,C=(0,s.useRef)({}),b=(0,l.on)(e=>e.setFlipY),[A,M]=(0,s.useState)([0,100]),[z,D]=(0,s.useState)([0,100]),[V,T]=(0,s.useState)(null),[R,F]=(0,s.useState)(null),[N,L]=(0,s.useState)(!1),[Y,O]=(0,s.useState)([0,0]),U=(0,s.useRef)([0,0]),[W,_]=(0,s.useState)(0),B=(0,s.useRef)([0,0]),[X,G]=(0,s.useState)("Default");(0,s.useMemo)(()=>r.map((e,t)=>({text:e,value:t})),[]);let I=(0,s.useMemo)(()=>({operation:f,axis:h,execute:w}),[f,h,w]);(0,s.useEffect)(()=>{"Default"!==x&&(S.GetArray(x).then(e=>{if(T(e),x in C.current)M([C.current[x].min,C.current[x].max]);else{let[t,r]=(0,p.Qt)(e.data);M([r,t]),C.current[x]={min:t,max:r}}}),S.GetAttributes(x).then(e=>{G(e.units);let[t,r,n]=S.GetDimArrays();m(t),u(n);let i=[];for(let e of r)i.push(e.units);d(i),t[1][1]<t[1][0]?b(!0):b(!1)})),"Default"!==g&&S.GetArray(g).then(e=>{if(F(e),g in C.current)D([C.current[g].min,C.current[g].max]);else{let[t,r]=(0,p.Qt)(e.data);D([t,r]),C.current[g]={min:t,max:r}}}),"Default"===g&&F(null)},[x,g,h]);let H=(0,s.useMemo)(()=>3===i.length?i.filter((e,t)=>t!=h):i,[h,i]);(0,s.useEffect)(()=>{if(i){let e=H[1].length,t=H[0].length,r=Math.round(U.current[0]*e-.5),n=Math.round(U.current[1]*t-.5);B.current=[H[0][n],H[1][r]]}},[U,Y,H]);let q=(0,s.useMemo)(()=>({firstArray:{maxVal:A[1],minVal:A[0]},secondArray:{maxVal:z[1],minVal:z[0]}}),[A,z]),Z=(0,s.useMemo)(()=>({stateVars:I,valueScales:q}),[I,q]),J=(0,s.useMemo)(()=>v.pH,[]);return(0,n.jsxs)("div",{className:"analysis-canvas",style:{width:j},children:[V&&(0,n.jsx)(v.PL,{units:X,valueScales:R?{maxVal:1,minVal:0}:{maxVal:A[0],minVal:A[1]}}),(0,n.jsx)(J,{}),(0,n.jsx)(k,{loc:Y,show:N,info:[...B.current,W]}),(0,n.jsxs)(y.Hl,{camera:{position:[0,0,50],zoom:400},orthographic:!0,children:[V&&(0,n.jsx)(E,{arrays:{firstArray:V,secondArray:R},values:Z,setters:{setShowInfo:L,setLoc:O,uv:U,setVal:_}}),(0,n.jsx)(P.N,{enablePan:!0,enableRotate:!1})]})]})}function W(e){let{points:t,pointSetters:r}=e,a=(0,s.useRef)(null),o=t.length,[u,m]=(0,s.useState)(!1),{setPointID:d,setPointLoc:f,setShowPointInfo:p}=r,[x,v]=(0,s.useState)(1),{pointColor:g,pointSize:y}=(0,l.Ws)((0,c.k)(e=>({pointColor:e.pointColor,pointSize:e.linePointSize}))),w=(0,s.useMemo)(()=>new i.Gu$(y),[y]),S=(0,s.useMemo)(()=>new i.V9B({color:g}),[g]);return(0,s.useEffect)(()=>{if(a.current){let e=new i.B69;for(let r=0;r<o;r++){let n=t[r].toArray();e.position.set(...n),e.scale.set(1/x,1/x,1/x),e.updateMatrix(),a.current.setMatrixAt(r,e.matrix)}a.current.instanceMatrix.needsUpdate=!0}},[t,x,w,S]),(0,h.C)(e=>{let{camera:t}=e;t.zoom!==x&&v(t.zoom)}),(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("mesh",{onPointerEnter:function(e){if(a.current){let t=new i.B69,r=new i.kn4;a.current.getMatrixAt(e.instanceId,r);let n=new i.Pq0;n.setFromMatrixPosition(r),t.scale.set(3/x,3/x,3/x),t.position.copy(n),t.updateMatrix(),a.current.setMatrixAt(e.instanceId,t.matrix),a.current.instanceMatrix.needsUpdate=!0,m(e=>!e),d(e.instanceId),f([e.clientX,e.clientY]),p(!0)}},onPointerLeave:function(){if(a.current){let e=new i.B69,t=new i.kn4,r=new i.Pq0;for(let n=0;n<o;n++)a.current.getMatrixAt(n,t),r.setFromMatrixPosition(t),e.scale.set(1/x,1/x,1/x),e.position.copy(r),e.updateMatrix(),a.current.setMatrixAt(n,e.matrix);a.current.instanceMatrix.needsUpdate=!0,m(e=>!e),p(!1)}},children:(0,n.jsx)("instancedMesh",{ref:a,args:[w,S,o]})})})}let _=e=>{let{height:t,xScale:r,yScale:a,pointSetters:o}=e,{valueScales:u,timeSeries:m,colormap:d}=(0,l.on)((0,c.k)(e=>({valueScales:e.valueScales,timeSeries:e.timeSeries,colormap:e.colormap}))),{lineWidth:f,useLineColor:p,lineColor:x,showPoints:v,lineResolution:g}=(0,l.Ws)((0,c.k)(e=>({lineWidth:e.lineWidth,linePointSize:e.linePointSize,showPoints:e.showPoints,useLineColor:e.useLineColor,lineColor:e.lineColor,lineResolution:e.lineResolution}))),{camera:y}=(0,h.A)(),w=(0,s.useMemo)(()=>new i.Q1f(x),[x]),{maxVal:S,minVal:j}=u,C=new i.BKk({glslVersion:i.Wdf,uniforms:{cmap:{value:d},width:{value:f},aspect:{value:window.innerWidth/window.innerHeight},thickness:{value:f},miter:{value:1},useLineColor:{value:p},lineColor:{value:w},zoom:{value:y.zoom}},vertexShader:"attribute float direction; \r\nattribute vec3 next;\r\nattribute vec3 previous;\r\nattribute float normed;\r\n\r\n\r\nvarying float vNormed;\r\n\r\nuniform float zoom;\r\nuniform float thickness;\r\nuniform int miter;\r\nuniform float aspect; // Pass the viewport aspect ratio as a uniform\r\n\r\nfloat getOrthographicZoom(mat4 projectionMatrix, float referenceWidth) {\r\n    float m0 = projectionMatrix[0][0]; // Scaling factor: 2/(right-left)\r\n    float viewWidth = 2.0 / m0; // Viewable width\r\n    return referenceWidth / viewWidth; // Zoom level\r\n}\r\n\r\nvoid main() {\r\n    // Transform positions to view space (before projection)\r\n    float zoom = getOrthographicZoom(projectionMatrix, 2.);\r\n    float zoomLevel = 2. / projectionMatrix[0][0]; // Extract vertical scale\r\n    vec4 currentView = modelViewMatrix * vec4(position, 1.0);\r\n    vec4 prevView = modelViewMatrix * vec4(previous, 1.0);\r\n    vec4 nextView = modelViewMatrix * vec4(next, 1.0);\r\n\r\n    // Compute directions in view space\r\n    vec3 dir = vec3(0.0);\r\n    if (currentView.xyz == prevView.xyz) {\r\n        dir = normalize(nextView.xyz - currentView.xyz);\r\n    } else if (currentView.xyz == nextView.xyz) {\r\n        dir = normalize(currentView.xyz - prevView.xyz);\r\n    } else {\r\n        vec3 dirA = normalize(currentView.xyz - prevView.xyz);\r\n        if (miter == 1) {\r\n            vec3 dirB = normalize(nextView.xyz - currentView.xyz);\r\n            vec3 tangent = normalize(dirA + dirB);\r\n            vec3 perp = vec3(-dirA.y, dirA.x, 0.0); // Perpendicular in view space\r\n            vec3 miterVec = vec3(-tangent.y, tangent.x, 0.0);\r\n            float miterLen = dot(miterVec, perp);\r\n            miterLen = max(miterLen, 0.5); // Avoid division by zero\r\n            dir = tangent;\r\n        } else {\r\n            dir = dirA;\r\n        }\r\n    }\r\n\r\n    // Compute normal in view space\r\n    vec3 normal = vec3(-dir.y, dir.x, 0.0); // Perpendicular to direction\r\n    float len = thickness / zoom/500.; // Thickness in world/view space units\r\n    normal *= 0.5 * len * direction; // Apply thickness and direction\r\n\r\n    // Apply offset in view space\r\n    currentView.xyz += normal;\r\n\r\n    // Project to clip space\r\n    gl_Position = projectionMatrix * currentView;\r\n\r\n\r\n    vNormed = normed;\r\n    gl_PointSize = 1.0;\r\n}",fragmentShader:"\n                out vec4 Color;\n                uniform sampler2D cmap;\n								uniform bool useLineColor;\n        				uniform vec3 lineColor;\n                varying float vNormed;\n\n                void main() {\n                    vec4 texColor = texture(cmap, vec2(vNormed, 0.1));\n                    texColor.a = 1.;\n                    Color = useLineColor ? vec4(lineColor, 1.0) : texColor;\n                }\n                ",depthWrite:!1}),b=(0,s.useMemo)(()=>m.map(e=>(e-j)/(S-j)),[m]),A=(0,s.useMemo)(()=>{let e=window.innerWidth,n=window.innerHeight-t,o=function(e,t,r){let n=(t-e)/(r-1);return Array.from({length:r},(t,r)=>e+n*r)}(-e*r/2,e*r/2,m.length);return b.map((e,t)=>new i.Pq0(o[t],(e-.5)*n*a,5))},[m,r,a,t]),M=(0,s.useMemo)(()=>new i.B6O(A).getPoints(A.length*g-1),[A,g]),z=(0,s.useMemo)(()=>{if(b.length<2)return[];let e=[];for(let t=0;t<M.length;t++){let r=t/(M.length-1)*(b.length-1),n=Math.floor(r),i=Math.min(b.length-1,Math.ceil(r)),a=r-n;e.push(b[n]*(1-a)+b[i]*a)}return e},[b,M.length]),D=(0,s.useMemo)(()=>{if(M.length<2)return new i.LoY;let e=M.length,t=[],r=[],n=[],a=[],o=[],s=[];for(let i=0;i<e;i++){let s=M[i],l=M[Math.max(0,i-1)],c=M[Math.min(e-1,i+1)];t.push(...s,...s),r.push(1,-1),n.push(...l,...l),a.push(...c,...c),o.push(z[i],z[i])}for(let t=0;t<e-1;t++){let e=2*t,r=e+1,n=e+2,i=e+3;s.push(e,r,n),s.push(r,i,n)}let l=new i.LoY;return l.setAttribute("position",new i.qtW(t,3)),l.setAttribute("direction",new i.qtW(r,1)),l.setAttribute("previous",new i.qtW(n,3)),l.setAttribute("next",new i.qtW(a,3)),l.setAttribute("normed",new i.qtW(o,1)),l.setIndex(new i.A$4(s,1)),l},[M]);return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("group",{children:[D&&(0,n.jsx)("mesh",{geometry:D,material:C}),v&&(0,n.jsx)(W,{points:A,pointSetters:o})]})})},B=e=>{let{texture:t,infoSetters:r}=e,{setLoc:a,setShowInfo:o,val:u,coords:m}=r,{shape:d,flipY:h,colormap:f,dataArray:p,valueScales:x,dimArrays:v}=(0,l.on)((0,c.k)(e=>({shape:e.shape,flipY:e.flipY,colormap:e.colormap,dataArray:e.dataArray,valueScales:e.valueScales,dimArrays:e.dimArrays}))),{cScale:g,cOffset:y}=(0,l.Ws)((0,c.k)(e=>({cOffset:e.cOffset,cScale:e.cScale}))),w=(0,s.useMemo)(()=>d.x/d.z,[d]),S=(0,s.useMemo)(()=>new i.bdM(2,w),[w]),j=(0,s.useRef)(!1),C=new i.BKk({glslVersion:i.Wdf,uniforms:{cScale:{value:g},cOffset:{value:y},data:{value:t},cmap:{value:f}},vertexShader:N,fragmentShader:L,side:i.$EB});(0,s.useEffect)(()=>{S.dispose()},[S]);let b=(0,s.useRef)(null),A=(0,s.useCallback)(e=>{if(j.current&&e.uv){b.current=e,a([e.clientX,e.clientY]);let{x:t,y:r}=e.uv,n=v[1].length,i=v[0].length,o=Math.round(t*n-.5),s=Math.round(r*i-.5);u.current=function(e,t){return e*(t.maxVal-t.minVal)+t.minVal}(p?p[n*s+o]:0,x),m.current=[v[0][s],v[1][o]]}},[p,d,v]);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("mesh",{material:C,geometry:S,scale:[1,h?-1:1,1],onPointerEnter:()=>{o(!0),j.current=!0},onPointerLeave:()=>{o(!1),j.current=!1},onPointerMove:A})})};var X=r(6769);i.l2R.enabled=!0;let G=function(){let{initStore:e,setZMeta:t}=(0,l.on)((0,c.k)(e=>({initStore:e.initStore,setZMeta:e.setZMeta}))),r=(0,s.useMemo)(()=>new o.Y5(e),[e]),[i,u]=(0,s.useState)({});(0,s.useEffect)(()=>{let r=!0;(0,a.tz)((0,o.Oe)(e)).then(e=>{r&&u(e)});let n=(0,o.Oe)(e),i=(0,a.Tk)(n),s=(0,a.Bi)(i);return i.then(e=>t(e)),s.then(e=>{p(e)}),()=>{r=!1}},[e]);let{title:m,description:h}=i,{setColormap:f,setVariables:p,setPlotOn:x,colormap:g,timeSeries:y,variable:w,metadata:S,plotOn:j}=(0,l.on)((0,c.k)(e=>({setColormap:e.setColormap,setVariables:e.setVariables,setPlotOn:e.setPlotOn,colormap:e.colormap,timeSeries:e.timeSeries,variable:e.variable,metadata:e.metadata,plotOn:e.plotOn}))),[C,b]=(0,s.useState)(!1);(0,X.default)("--foreground"),(0,X.default)("--background");let[A,M]=(0,s.useState)(window.innerWidth);(0,s.useEffect)(()=>{let e=()=>M(window.innerWidth);return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let[D,P]=(0,s.useState)(0);(0,s.useEffect)(()=>{P(Math.round(0*window.innerWidth))},[]);let V=(0,s.useMemo)(()=>({ZarrDS:r,canvasWidth:D}),[r,D]),T=(0,s.useMemo)(()=>({values:{ZarrDS:r,canvasWidth:D}}),[r,D]);return(0,s.useEffect)(()=>{"Default"===w&&(P(0),x(!1))},[w]),(0,n.jsxs)(n.Fragment,{children:[!j&&(0,n.jsx)(v.Fp,{}),D<15&&"Default"!=w&&(0,n.jsx)(v.kW,{onClick:()=>P(.5*A)}),D>A-15&&"Default"!=w&&(0,n.jsx)(v.h7,{onClick:()=>P(.5*A)}),D>15&&D<A-15&&(0,n.jsx)(v.t2,{canvasWidth:D,setCanvasWidth:P}),(0,n.jsx)(v.Rh,{showLoading:C}),D>10&&"Default"!=w&&(0,n.jsx)(U,{values:T.values}),"Default"===w&&(0,n.jsx)(d,{}),"Default"!=w&&D<A-15&&(0,n.jsx)(R,{values:V,setShowLoading:b}),S&&(0,n.jsx)(v.OS,{data:S}),y.length>2&&(0,n.jsx)(z,{})]})}},6145:(e,t,r)=>{Promise.resolve().then(r.bind(r,6020))},6375:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[318,993,185,383,458,667,217,935,587,195,970,984,269,378,225,535,398,23,358],()=>t(6145)),_N_E=e.O()}]);